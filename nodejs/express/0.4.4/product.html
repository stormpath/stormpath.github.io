

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Product Guide &mdash; Express-Stormpath 0.4.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Express-Stormpath 0.4.4 documentation" href="index.html"/>
        <link rel="next" title="Getting Help" href="help.html"/>
        <link rel="prev" title="Quickstart" href="quickstart.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Express-Stormpath</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-stormpath">What is Stormpath?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#who-should-use-stormpath">Who Should Use Stormpath</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="setup.html#create-a-stormpath-account">Create a Stormpath Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#create-an-api-key-pair">Create an API Key Pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#create-a-stormpath-application">Create a Stormpath Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#bonus-create-a-directory">Bonus: Create a Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html#install-the-package">Install the Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#initialize-express-stormpath">Initialize Express-Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#testing-it-out">Testing It Out</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Product Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enforce-user-authentication">Enforce User Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enforce-user-authorization">Enforce User Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#session-management">Session Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#restrict-session-duration-expiration">Restrict Session Duration / Expiration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enable-caching">Enable Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-user-data">Access User Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-events">Handling Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-custom-user-data">Working With Custom User Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#automatic-expansion">Automatic Expansion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-authentication">API Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-redirect-logic">Customize Redirect Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-user-registration-fields">Customize User Registration Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-user-login-fields">Customize User Login Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-user-registration-login-and-logout-routes">Customize User Registration, Login, and Logout Routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-the-views">Customize the Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disable-the-built-in-views">Disable the Built-in Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-account-verification">Use Account Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-password-reset">Use Password Reset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-facebook-login">Use Facebook Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-google-login">Use Google Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-hosted-login">Use Hosted Login</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Getting Help</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-4-4">Version 0.4.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-4-3">Version 0.4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-4-2">Version 0.4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-4-1">Version 0.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-4-0">Version 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-3-4">Version 0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-3-3">Version 0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-3-2">Version 0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-3-1">Version 0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-3-0">Version 0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-9">Version 0.2.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-8">Version 0.2.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-7">Version 0.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-6">Version 0.2.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-5">Version 0.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-4">Version 0.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-3">Version 0.2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-2">Version 0.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-1">Version 0.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-0">Version 0.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-9">Version 0.1.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-8">Version 0.1.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-7">Version 0.1.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-6">Version 0.1.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-5">Version 0.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-4">Version 0.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-3">Version 0.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-2">Version 0.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-0">Version 0.1.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrade Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-4-3-version-0-4-4">Version 0.4.3 -&gt; Version 0.4.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-4-2-version-0-4-3">Version 0.4.2 -&gt; Version 0.4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-4-1-version-0-4-2">Version 0.4.1 -&gt; Version 0.4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-4-0-version-0-4-1">Version 0.4.0 -&gt; Version 0.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-3-4-version-0-4-0">Version 0.3.4 -&gt; Version 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-3-3-version-0-3-4">Version 0.3.3 -&gt; Version 0.3.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-3-2-version-0-3-3">Version 0.3.2 -&gt; Version 0.3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-3-1-version-0-3-2">Version 0.3.1 -&gt; Version 0.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-3-0-version-0-3-1">Version 0.3.0 -&gt; Version 0.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-9-version-0-3-0">Version 0.2.9 -&gt; Version 0.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-8-version-0-2-9">Version 0.2.8 -&gt; Version 0.2.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-7-version-0-2-8">Version 0.2.7 -&gt; Version 0.2.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-6-version-0-2-7">Version 0.2.6 -&gt; Version 0.2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-5-version-0-2-6">Version 0.2.5 -&gt; Version 0.2.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-4-version-0-2-5">Version 0.2.4 -&gt; Version 0.2.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-3-version-0-2-4">Version 0.2.3 -&gt; Version 0.2.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-2-version-0-2-3">Version 0.2.2 -&gt; Version 0.2.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-1-version-0-2-2">Version 0.2.1 -&gt; Version 0.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-2-0-version-0-2-1">Version 0.2.0 -&gt; Version 0.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-9-version-0-2-0">Version 0.1.9 -&gt; Version 0.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-8-version-0-1-9">Version 0.1.8 -&gt; Version 0.1.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-7-version-0-1-8">Version 0.1.7 -&gt; Version 0.1.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-6-version-0-1-7">Version 0.1.6 -&gt; Version 0.1.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-5-version-0-1-6">Version 0.1.5 -&gt; Version 0.1.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-4-version-0-1-5">Version 0.1.4 -&gt; Version 0.1.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-3-version-0-1-4">Version 0.1.3 -&gt; Version 0.1.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-2-version-0-1-3">Version 0.1.2 -&gt; Version 0.1.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-1-0-version-0-1-2">Version 0.1.0 -&gt; Version 0.1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#version-0-0-0-version-0-1-0">Version 0.0.0 -&gt; Version 0.1.0</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Express-Stormpath</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Product Guide</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/product.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="product-guide">
<h1>Product Guide<a class="headerlink" href="#product-guide" title="Permalink to this headline">¶</a></h1>
<p>This product guide covers more advanced Express-Stormpath usage.  You can
selectively jump around from topic-to-topic to discover all the neat features
that Express-Stormpath provides!</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to configure Express-Stormpath &#8211; you can list all of your
settings manually when initializing the Stormpath middleware, or you can specify
your settings via environment variables.</p>
<p>If you want to specify settings via middleware, you can do so by specifying
their names like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">secretKey</span><span class="o">:</span> <span class="s1">&#39;blah&#39;</span><span class="p">,</span>
  <span class="nx">enableHttps</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>As an alternative, you could specify these settings via environment variables,
by using the same names, with a twist: each name must be in all caps, start with
&#8216;stormpath&#8217;, and use underscores instead of spaces.</p>
<p>For instance, if I wanted to reproduce the above with environment variables, I
could define the following variables:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="kr">export</span> <span class="nx">STORMPATH_SECRET_KEY</span><span class="o">=</span><span class="nx">blah</span>
<span class="nx">$</span> <span class="kr">export</span> <span class="nx">STORMPATH_ENABLE_HTTPS</span><span class="o">=</span><span class="kc">false</span>
</pre></div>
</div>
<p>Then, when defining my middleware, I could simply write:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="enforce-user-authentication">
<h2>Enforce User Authentication<a class="headerlink" href="#enforce-user-authentication" title="Permalink to this headline">¶</a></h2>
<p>Now that we&#8217;ve seen how easy it is to register, login, and logout users in your
Express app, let&#8217;s see how simple it is to restrict views to logged-in users only.</p>
<p>Let&#8217;s say you have a simple view which should only be accessible to users who
have logged in.  Below is a code sample which shows how easy it is to restrict
access to your view:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/secret&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;If you&#39;re seeing this page, you must be logged in!&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">loginRequired</span></code> middleware makes enforcing user authentication extremely
simple.</p>
<p>If you try to visit the <code class="docutils literal"><span class="pre">/secret</span></code> URL and you&#8217;re not logged in, you&#8217;ll be
redirected to: <code class="docutils literal"><span class="pre">/login?next=%2Fsecret</span></code>.  If you then enter your credentials
and log in &#8211; you&#8217;ll be immediately redirected back to the page you were trying
to access: <code class="docutils literal"><span class="pre">/secret</span></code>.</p>
</div>
<div class="section" id="enforce-user-authorization">
<h2>Enforce User Authorization<a class="headerlink" href="#enforce-user-authorization" title="Permalink to this headline">¶</a></h2>
<p>Stormpath supports extremely complex authorization rules.  This section aims to
provide a basic introduction to Express-Stormpath&#8217;s authorization enforcement
(<em>this topic is covered in-depth later on</em>).</p>
<p>The main authorization resource in Stormpath is the <code class="docutils literal"><span class="pre">Group</span></code>.  A Stormpath
Group is a named resource (<em>admins, developers, paid users, free users, etc.</em>)
which can be assigned to any number of user accounts.</p>
<p>Let&#8217;s say you&#8217;re building a site that has three tiers of users: free users, paid
users, and admins.  In this case, you&#8217;d want to create three Stormpath Groups:
<code class="docutils literal"><span class="pre">free</span> <span class="pre">users</span></code>, <code class="docutils literal"><span class="pre">paid</span> <span class="pre">users</span></code>, and <code class="docutils literal"><span class="pre">admins</span></code>.</p>
<p>If you visit your Stormpath Directory in the <a class="reference external" href="https://api.stormpath.com/v#!directories">Directory Dashboard</a>, then
click the &#8220;Groups&#8221; tab, you can create your groups here, as well as assign users
to groups.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;d like to learn how to create groups pragmatically, you can look at
our Node library&#8217;s <a class="reference external" href="http://docs.stormpath.com/nodejs/api/application#createGroup">createGroup</a> documentation.</p>
</div>
<p>Now that we&#8217;ve created our groups, and also added our user to the &#8220;free users&#8221;
group &#8211; let&#8217;s see how we can enforce different types of authorization on
our user using the <code class="docutils literal"><span class="pre">groupsRequired</span></code> middleware:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/admins&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">groupsRequired</span><span class="p">([</span><span class="s1">&#39;admins&#39;</span><span class="p">]),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;If you can see this page, you must be in the `admins` group!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If a user tries to visit <code class="docutils literal"><span class="pre">/admins</span></code>, they&#8217;ll get redirected to the login page
and won&#8217;t be able to access the view.</p>
<p>What if we wanted to build a view only accessible to users who are both free
users and admins?  In this case we could just list both required groups:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/free_users_and_admins&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">groupsRequired</span><span class="p">([</span><span class="s1">&#39;free users&#39;</span><span class="p">,</span> <span class="s1">&#39;admins&#39;</span><span class="p">]),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;If you can see this page, you must be in the `free users` and `admins` group!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Now that you&#8217;ve seen how you can require a user to be a member of multiple
groups, let&#8217;s take a look at how you can enforce selective group membership:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/any_user&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">groupsRequired</span><span class="p">([</span><span class="s1">&#39;free users&#39;</span><span class="p">,</span> <span class="s1">&#39;paid users&#39;</span><span class="p">,</span> <span class="s1">&#39;admins&#39;</span><span class="p">],</span> <span class="kc">false</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;If you can see this page, you must be in at least one of the specified groups!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The view above lists three groups, and sets the <code class="docutils literal"><span class="pre">all</span></code> parameter to <code class="docutils literal"><span class="pre">false</span></code>
&#8211; signifying that a user must be a member of <strong>at least one</strong> of the listed
groups in order to gain access.</p>
</div>
<div class="section" id="session-management">
<h2>Session Management<a class="headerlink" href="#session-management" title="Permalink to this headline">¶</a></h2>
<p>Express-Stormpath ships with a default, pre-configured session middleware by
default.  This middleware library, <a class="reference external" href="https://github.com/mozilla/node-client-sessions">client-sessions</a>, is preconfigured for
security and statelessness.</p>
<p>If, for some reason, you&#8217;d like to store your session state in a database or
server of some kind, you can swap out the built-in session management middleware
with your own.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Express-Stormpath&#8217;s session management will not interfere with any existing
session middleware you might have.  The sessions that Stormpath uses are
exclusively used for Stormpath purposes, so it&#8217;s safe you create your own
separate sessions.</p>
<p class="last">This works by utilizing the Express <a class="reference external" href="http://expressjs.com/api#router">router</a>.</p>
</div>
<p>If you&#8217;d like to use your own session middleware, you can set it up during the
Stormpath middleware initialization.  The only requirement is that your request
key for the session is <code class="docutils literal"><span class="pre">session</span></code>.</p>
<p>You can do it this way:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-session&#39;</span><span class="p">);</span>

<span class="c1">// In this example we&#39;ll store our session state in a Redis server.</span>
<span class="kd">var</span> <span class="nx">RedisStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect-redis&#39;</span><span class="p">)(</span><span class="nx">session</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">sessionMiddleware</span> <span class="o">=</span> <span class="nx">session</span><span class="p">({</span>
  <span class="nx">store</span><span class="o">:</span> <span class="k">new</span> <span class="nx">RedisStore</span><span class="p">(</span><span class="nx">options</span><span class="p">),</span>
  <span class="nx">secret</span><span class="o">:</span> <span class="s1">&#39;this is very secret&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Enable your session middleware for your app.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">sessionMiddleware</span><span class="p">);</span>

<span class="c1">// Initialize Stormpath, and have it use your session middleware instead of</span>
<span class="c1">// it&#39;s own.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">sessionMiddleware</span><span class="o">:</span> <span class="nx">sessionMiddleware</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substituting your own session middleware in for the default is most likely a
security concern &#8211; please only do this if you absolutely know what you&#8217;re
doing and are sure you need to do it!  If you&#8217;re not sure, please contact us
directly to figure it out: <a class="reference external" href="mailto:support&#37;&#52;&#48;stormpath&#46;com">support<span>&#64;</span>stormpath<span>&#46;</span>com</a></p>
</div>
</div>
<div class="section" id="restrict-session-duration-expiration">
<h2>Restrict Session Duration / Expiration<a class="headerlink" href="#restrict-session-duration-expiration" title="Permalink to this headline">¶</a></h2>
<p>Another thing people commonly want to do is restrict how long a user can be
logged in without activity before being forced to log into their account again.</p>
<p>You can easily change the default session / cookie expiration by modifying the
<code class="docutils literal"><span class="pre">sessionDuration</span></code> setting:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">sessionDuration</span><span class="o">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">,</span> <span class="c1">// Make sessions expire after 15 minutes.</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>By default, sessions will not expire for one month (<em>out of convenience</em>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">sessionDuration</span></code> setting expects an integer, which must be the number
of <strong>milliseconds</strong> before the session will expire &#8211; if you miscalculate
this number, your sessions will expire very quickly!</p>
</div>
</div>
<div class="section" id="enable-caching">
<h2>Enable Caching<a class="headerlink" href="#enable-caching" title="Permalink to this headline">¶</a></h2>
<p>The best kind of websites are fast websites.  As of version <strong>0.1.5</strong>,
Express-Stormpath includes built-in support for caching.  You can currently use
either:</p>
<ul class="simple">
<li>A local memory cache (<em>default</em>).</li>
<li>A <a class="reference external" href="http://memcached.org/">memcached</a> cache.</li>
<li>A <a class="reference external" href="http://redis.io/">redis</a> cache.</li>
</ul>
<p>All can be easily configured using configuration variables.</p>
<p>There are several configuration settings you can specify when initializing the
Stormpath middleware:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cache</span></code> - The type of cache to use: <code class="docutils literal"><span class="pre">'memory'</span></code>, <code class="docutils literal"><span class="pre">'memcached'</span></code>, or
<code class="docutils literal"><span class="pre">'redis'</span></code>).  Defaults to <code class="docutils literal"><span class="pre">'memory'</span></code>.  If you want to use local memory as a
cache, just set memory here and leave all other fields blank!</li>
<li><code class="docutils literal"><span class="pre">cacheHost</span></code> - The hostname of the cache (<em>ex: &#8216;127.0.0.1&#8217;</em>).</li>
<li><code class="docutils literal"><span class="pre">cachePort</span></code> - The port of the cache (<em>ex: 11211</em>).</li>
<li><code class="docutils literal"><span class="pre">cacheTTL</span></code> - The amount of time (<em>in seconds</em>) to cache resources before
expiring them.  Defaults to <code class="docutils literal"><span class="pre">300</span></code>.</li>
<li><code class="docutils literal"><span class="pre">cacheTTI</span></code> - If this amount of time has passed (<em>in seconds</em>) since a
resource was last accessed, it will be expired.  Defaults to <code class="docutils literal"><span class="pre">300</span></code>.</li>
<li><code class="docutils literal"><span class="pre">cacheOptions</span></code> - An object which holds additional configuration options for
the cache (<em>like username, password, etc.</em>).</li>
</ul>
<p>Here&#8217;s an example showing how to enable caching for a memcached server that is
running locally with no username / password:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">cache</span><span class="o">:</span> <span class="s1">&#39;memcached&#39;</span><span class="p">,</span>
  <span class="nx">cacheHost</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
  <span class="nx">cachePort</span><span class="o">:</span> <span class="mi">11211</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>Here&#8217;s an example which shows how to enable caching for a redis server that is
running locally with a required password:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">cache</span><span class="o">:</span> <span class="s1">&#39;redis&#39;</span><span class="p">,</span>
  <span class="nx">cacheHost</span><span class="o">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
  <span class="nx">cachePort</span><span class="o">:</span> <span class="mi">6379</span><span class="p">,</span>
  <span class="nx">cacheOptions</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">auth_pass</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></div>
</div>
</div>
<div class="section" id="access-user-data">
<h2>Access User Data<a class="headerlink" href="#access-user-data" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s take a quick look at how we can access user data from a custom view.</p>
<p>Let&#8217;s say we&#8217;ve defined a simple view that should simply display a user&#8217;s email
address.  We can make use of the magical <code class="docutils literal"><span class="pre">res.locals.user</span></code> context variable to
do this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">stormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/email&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Your email address is:&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">res.locals.user</span></code> context allows you to directly interact with the current
<code class="docutils literal"><span class="pre">user</span></code> object.  This means you can perform <em>any</em> action on the <code class="docutils literal"><span class="pre">user</span></code> object
directly.</p>
<p>For more information on what you can do with a <code class="docutils literal"><span class="pre">user</span></code> object, please see
the Node library documentation: <a class="reference external" href="http://docs.stormpath.com/nodejs/api/account">http://docs.stormpath.com/nodejs/api/account</a></p>
<p>Let&#8217;s say you want to change a user&#8217;s <code class="docutils literal"><span class="pre">givenName</span></code> (<em>first name</em>).  You could
easily accomplish this with the following code:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// assuming we&#39;re inside of a request</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">givenName</span> <span class="o">=</span> <span class="s1">&#39;Randall&#39;</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User change saved successfully.&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>As you can see above, you can directly modify <code class="docutils literal"><span class="pre">user</span></code> attributes, then
persist any changes by running <code class="docutils literal"><span class="pre">res.locals.user.save()</span></code>.</p>
</div>
<div class="section" id="handling-events">
<h2>Handling Events<a class="headerlink" href="#handling-events" title="Permalink to this headline">¶</a></h2>
<p>As of Express-Stormpath <strong>0.2.8</strong>, it is now possible to handle specific events!
This means you can run your own custom code when a specific event happens.</p>
<p>All supported events are listed below.</p>
<div class="section" id="post-registration">
<h3>Post Registration<a class="headerlink" href="#post-registration" title="Permalink to this headline">¶</a></h3>
<p>Want to run some custom code after a user registers for your site?  If so, this
is the event you want to handle!</p>
<p>By defining a <code class="docutils literal"><span class="pre">postRegistrationHandler</span></code> you&#8217;re able to do stuff like:</p>
<ul class="simple">
<li>Send a new user a welcome email.</li>
<li>Generate API keys for all new users.</li>
<li>Setup Stripe billing.</li>
<li>etc.</li>
</ul>
<p>To use a <code class="docutils literal"><span class="pre">postRegistrationHandler</span></code>, you need to define your handler function
in the Stormpath middleware setup:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">postRegistrationHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;User:&#39;</span><span class="p">,</span> <span class="nx">account</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="s1">&#39;just registered!&#39;</span><span class="p">);</span>
    <span class="nx">next</span><span class="p">();</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>As you can see in the example above, the <code class="docutils literal"><span class="pre">postRegistrationHandler</span></code> function
takes in three parameters:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">account</span></code>: The new, successfully created, user account.</li>
<li><code class="docutils literal"><span class="pre">res</span></code>: The Express response object.  This can be used to modify the HTTP
response directly.</li>
<li><code class="docutils literal"><span class="pre">next</span></code>: The callback to call when you&#8217;re done doing whatever it is you want
to do.  If you call this, execution will continue on normally.  If you don&#8217;t
call this, you&#8217;re responsible for handling the response.</li>
</ul>
<p>In the example below, we&#8217;ll use the <code class="docutils literal"><span class="pre">postRegistrationHandler</span></code> to redirect the
user to a special page (<em>instead of the normal registration flow</em>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">postRegistrationHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="s1">&#39;/secretpage&#39;</span><span class="p">).</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-custom-user-data">
<h2>Working With Custom User Data<a class="headerlink" href="#working-with-custom-user-data" title="Permalink to this headline">¶</a></h2>
<p>In addition to managing basic user fields, Stomrpath also allows you to store
up to 10MB of JSON information with each user account!</p>
<p>Instead of defining a database table for users, and another database table for
user profile information &#8211; with Stormpath, you don&#8217;t need either!</p>
<p>Let&#8217;s take a look at how easy it is to store custom data on a <code class="docutils literal"><span class="pre">user</span></code>
model:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// assuming we&#39;re inside of a request</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">.</span><span class="nx">somefield</span> <span class="o">=</span> <span class="s1">&#39;somevalue&#39;</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">[</span><span class="s1">&#39;anotherfield&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;json&#39;</span><span class="o">:</span> <span class="s1">&#39;data&#39;</span><span class="p">};</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">[</span><span class="s1">&#39;woot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.202223</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">[</span><span class="s1">&#39;woot&#39;</span><span class="p">];</span>
<span class="c1">// 10.202223</span>

<span class="k">delete</span> <span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">[</span><span class="s1">&#39;woot&#39;</span><span class="p">];</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedUser</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">updatedUser</span><span class="p">.</span><span class="nx">customData</span><span class="p">.</span><span class="nx">woot</span><span class="p">;</span>
    <span class="c1">// undefined</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>As you can see above &#8211; storing custom information on a <code class="docutils literal"><span class="pre">user</span></code> account is
extremely simple!</p>
</div>
<div class="section" id="automatic-expansion">
<h2>Automatic Expansion<a class="headerlink" href="#automatic-expansion" title="Permalink to this headline">¶</a></h2>
<p>As of Express-Stormpath <strong>0.4.3</strong>, you can now take advantage of automatic
expansion.  Automatic expansion allows you to more easily work with user data.</p>
<p>Let&#8217;s say you&#8217;re working on an app which makes use of the <code class="docutils literal"><span class="pre">customData</span></code>
property.  As mentioned in the previous section, you could always work with this
data in each route by requesting it like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">getCustomData</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>However &#8211; this is a bit nasty, right?  If you know that you always want to use
<code class="docutils literal"><span class="pre">customData</span></code> &#8211; then having to repeatedly call <code class="docutils literal"><span class="pre">req.user.getCustomData</span></code> over
and over again is going to get boring!</p>
<p>With automatic expansion, you can pass in a configuration option when setting up
your middleware, and tell it you want a particular property to be expanded
automatically &#8211; for instance:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">expandCustomData</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Now, inside of <em>any</em> route, you could do the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">customData</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>As you can see above, by automatically expanding the <code class="docutils literal"><span class="pre">customData</span></code> property, it
means you don&#8217;t have to make any additional Stormpath calls &#8211; it will happen
automatically on each request!</p>
<p>You can expand any of the <em>&#8220;linked resources&#8221;</em> below:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">apiKeys</span></code> - A user&#8217;s API keys.</li>
<li><code class="docutils literal"><span class="pre">customData</span></code> - A user&#8217;s custom data.</li>
<li><code class="docutils literal"><span class="pre">directory</span></code> - A user&#8217;s directory data.</li>
<li><code class="docutils literal"><span class="pre">groups</span></code> - A user&#8217;s group data.</li>
<li><code class="docutils literal"><span class="pre">groupMemberships</span></code> - A user&#8217;s group membership data.</li>
<li><code class="docutils literal"><span class="pre">providerData</span></code> - A user&#8217;s provider data (<em>for social login providers</em>).</li>
<li><code class="docutils literal"><span class="pre">tenant</span></code> - A user&#8217;s tenant data.</li>
</ul>
<p>Now, some of the linked resources above are simple JSON objects:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">customData</span></code></li>
<li><code class="docutils literal"><span class="pre">directory</span></code></li>
<li><code class="docutils literal"><span class="pre">providerData</span></code></li>
<li><code class="docutils literal"><span class="pre">tenant</span></code></li>
</ul>
<p>Each of the above objects contains some fields, and can be referenced like a
normal JSON object.</p>
<p>The other fields, however:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">apiKeys</span></code></li>
<li><code class="docutils literal"><span class="pre">groups</span></code></li>
<li><code class="docutils literal"><span class="pre">groupMemberships</span></code></li>
</ul>
<p>Are collections &#8211; and they can&#8217;t be queried in a single request.</p>
<p>Take <code class="docutils literal"><span class="pre">groups</span></code>, for instance, if your account is a member of 1,000 groups, you
won&#8217;t be able to squeeze all 1,000 groups into a single object (<em>it&#8217;s just not
efficient</em>) &#8211; so instead, you have to iterate over the collection.</p>
<p>Below is an example which shows how you can iterate over a collection resource
(<em>groups, in this case</em>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">group</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;group:&#39;</span><span class="p">,</span> <span class="nx">group</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">();</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Finished logging all groups to the console!&#39;</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Each collection resource has an <code class="docutils literal"><span class="pre">each</span></code> method which takes in two functions
with signature: <code class="docutils literal"><span class="pre">function(data,</span> <span class="pre">callback),</span> <span class="pre">function()</span></code>.  The first function
will be called for each resource in the collection.  The second function will be
called when you&#8217;ve finished iterating through all of the available resources.</p>
<p>So, given the example above, we could just as easily iterate over all of a
user&#8217;s <code class="docutils literal"><span class="pre">apiKeys</span></code>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">apiKeys</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;apiKey:&#39;</span><span class="p">,</span> <span class="nx">apiKey</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">();</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Finished logging all apiKeys to the console!&#39;</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Below is a full list of the available expansion options that you&#8217;ll need to
enable in your middleware if you&#8217;d like to turn expansion on (<em>each field can be
enabled by setting its value to true</em>):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">expandApiKeys</span></code></li>
<li><code class="docutils literal"><span class="pre">expandCustomData</span></code></li>
<li><code class="docutils literal"><span class="pre">expandDirectory</span></code></li>
<li><code class="docutils literal"><span class="pre">expandGroups</span></code></li>
<li><code class="docutils literal"><span class="pre">expandGroupMemberships</span></code></li>
<li><code class="docutils literal"><span class="pre">expandProviderData</span></code></li>
<li><code class="docutils literal"><span class="pre">expandTenant</span></code></li>
</ul>
</div>
<div class="section" id="api-authentication">
<h2>API Authentication<a class="headerlink" href="#api-authentication" title="Permalink to this headline">¶</a></h2>
<p>In addition to handling user login, registration, etc. for web users &#8211; you can
also use Stormpath to secure your REST API.</p>
<p>Typically, securing REST APIs is a lot of work:</p>
<ul class="simple">
<li>You need to assign users API keys.</li>
<li>You need to cache the API keys for validation when users make requests
(<em>nobody likes a slow API!</em>).</li>
<li>You need to allow users to exchange their API keys for Oauth tokens (<em>if you
want to support Oauth</em>).</li>
</ul>
<p>With Stormpath, however, this process is greatly simplified.  Stormpath can
create API keys for your users, store them securely, and completely handle API
authentication / caching.</p>
<div class="section" id="create-api-keys">
<h3>Create API Keys<a class="headerlink" href="#create-api-keys" title="Permalink to this headline">¶</a></h3>
<p>Before you can secure your REST API, you&#8217;ll need to provision an API key pair
for one of your Stormpath users.</p>
<p>To do this (<em>assuming you&#8217;re inside of an Express route</em>), you can call the
<code class="docutils literal"><span class="pre">createApiKey</span></code> method on your user object like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// Create an API key pair for the current user.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/create&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">createApiKey</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">apiKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="mi">503</span><span class="p">,</span> <span class="p">{</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;Something went wrong. Please try again.&#39;</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">apiKey</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">secret</span><span class="o">:</span> <span class="nx">apiKey</span><span class="p">.</span><span class="nx">secret</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The above route will create a new API key for the logged in user, then return it
as JSON.  Each API key pair has two parts:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">id</span></code> - An API key ID &#8211; this is similar to a username.</li>
<li><code class="docutils literal"><span class="pre">secret</span></code> - An API key secret &#8211; this is similar to a password.</li>
</ul>
<p>Both the id and secret <em>must</em> be given to your user, as both will be needed for
API authentication.</p>
<p>Once you&#8217;ve created at least one API key pair for your user, you can then allow
this user to authenticate using their API keys against your API service.</p>
</div>
<div class="section" id="authenticating-via-basic-auth">
<h3>Authenticating via Basic Auth<a class="headerlink" href="#authenticating-via-basic-auth" title="Permalink to this headline">¶</a></h3>
<p>If you&#8217;re building a REST API, the simplest way to secure your API is using HTTP
basic authentication.</p>
<p>Essentially what this means is that a developer will be able to access your API
by specifying their API key ID and secret when making requests to your API.</p>
<p>To allow a user to authenticate via basic authentication, all you need to use is
the <code class="docutils literal"><span class="pre">apiAuthenticationRequired</span></code> middleware in your route:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// This API endpoint is *only* accessible to users with valid API keys.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/me&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">apiAuthenticationRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
    <span class="nx">givenName</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">givenName</span><span class="p">,</span>
    <span class="nx">surname</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">surname</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Now, let&#8217;s see how a developer can successfully use this API endpoint defined
above.</p>
<p>First, we&#8217;ll use the <a class="reference external" href="http://curl.haxx.se/">curl</a> command to make an API request to this endpoint
<em>without specifying our API credentials</em>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/me</span>
<span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;Invalid API credentials.&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>As you can see above, by hitting the API endpoint with no credentials, a JSON
error is returned automatically (<em>along with an HTTP 401 UNAUTHORIZED status
code</em>).</p>
<p>Now, let&#8217;s try this again by specifying our user&#8217;s API credentials (<em>that we
generated in the previous section</em>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="o">--</span><span class="nx">user</span> <span class="nx">id</span><span class="o">:</span><span class="nx">secret</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/me</span>
<span class="p">{</span><span class="s2">&quot;givenName&quot;</span><span class="o">:</span><span class="s2">&quot;Randall&quot;</span><span class="p">,</span><span class="s2">&quot;surname&quot;</span><span class="o">:</span><span class="s2">&quot;Degges&quot;</span><span class="p">,</span><span class="s2">&quot;email&quot;</span><span class="o">:</span><span class="s2">&quot;r@rdegges.com&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>As you can see, by specifying my developer API credentials, I was able to
successfully authenticate against the REST API!</p>
<p>Using basic authentication, along with SSL, is an <em>excellent</em> way to secure
your REST API.</p>
</div>
<div class="section" id="authenticating-via-oauth">
<h3>Authenticating via OAuth<a class="headerlink" href="#authenticating-via-oauth" title="Permalink to this headline">¶</a></h3>
<p>OAuth is another popular way to secure REST APIs.</p>
<p>The way OAuth works is as follows:</p>
<ul class="simple">
<li>You&#8217;ve built a REST API that you want to secure.</li>
<li>You&#8217;ve got developer accounts, and each developer account has an API key
pair.</li>
<li>A developer makes an HTTP POST request to your API service at the URL
<code class="docutils literal"><span class="pre">/oauth</span></code>, and authenticates via HTTP basic authentication.</li>
<li>If the request to <code class="docutils literal"><span class="pre">/oauth</span></code> was successful, an OAuth token will be returned
to the developer.  This token is a long string that expires in a given amount
of time (<em>by default, OAuth tokens expire after one hour</em>).</li>
<li>After the developer has this OAuth token, they can use this to authenticate
future API requests instead of using their API key directly.</li>
</ul>
<p>OAuth serves to provide additional security over basic authentication if you&#8217;d
like to give out more advanced / restricted access to your developers.</p>
<p>Typically, if you&#8217;re building a REST API, and aren&#8217;t sure which form of
authentication to offer &#8211; it&#8217;s a much better idea to simply use basic
authentication (<em>covered in the previous section</em>).</p>
<p>If you&#8217;d still like to use OAuth, continue reading!</p>
<div class="section" id="configuring-oauth-token-settings">
<h4>Configuring OAuth Token Settings<a class="headerlink" href="#configuring-oauth-token-settings" title="Permalink to this headline">¶</a></h4>
<p>This library comes with OAuth support out-of-the box.  There are two
configuration options you can specify when initializing the Stormpath middleware
which control your OAuth flow:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">getOauthTokenUrl</span></code> - The URL at which OAuth tokens can be retrieved.
Defaults to <code class="docutils literal"><span class="pre">/oauth</span></code>.</li>
<li><code class="docutils literal"><span class="pre">oauthTTL</span></code> - The amount of time (<em>in seconds</em>) that OAuth tokens last.
Defaults to <code class="docutils literal"><span class="pre">3600</span></code> (<em>one hour</em>).</li>
</ul>
<p>Here&#8217;s an example of how to set both of these attributes:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">getOauthTokenUrl</span><span class="o">:</span> <span class="s1">&#39;/oauth&#39;</span><span class="p">,</span>
  <span class="nx">oauthTTL</span><span class="o">:</span> <span class="mi">3600</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-an-oauth-token">
<h4>Getting an OAuth Token<a class="headerlink" href="#getting-an-oauth-token" title="Permalink to this headline">¶</a></h4>
<p>Now that you&#8217;ve configured your OAuth settings, developers will be able to
retrieve OAuth tokens by hitting your OAuth URL (<em>/oauth by default</em>) with
their API credentials.</p>
<p>Below is an example request using curl, which demonstrates the proper way to
request an OAuth token:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="o">--</span><span class="nx">user</span> <span class="nx">id</span><span class="o">:</span><span class="nx">secret</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/oauth?grant_type=client_credentials</span>
<span class="p">{</span><span class="s2">&quot;access_token&quot;</span><span class="o">:</span><span class="s2">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJEUExSSTVUTEVNMjFTQzNER0xHUjBJOFpYIiwiaXNzIjoiaHR0cHM6Ly9hcGkuc3Rvcm1wYXRoLmNvbS92MS9hcHBsaWNhdGlvbnMvNWpvQVVKdFZONHNkT3dUVVJEc0VDNSIsImlhdCI6MTQwNjY1OTkxMCwiZXhwIjoxNDA2NjYzNTEwLCJzY29wZSI6IiJ9.ypDMDMMCRCtDhWPMMc9l_Q-O-rj5LATalHYa3droYkY&quot;</span><span class="p">,</span><span class="s2">&quot;token_type&quot;</span><span class="o">:</span><span class="s2">&quot;bearer&quot;</span><span class="p">,</span><span class="s2">&quot;expires_in&quot;</span><span class="o">:</span><span class="mi">3600</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;re wondering why the <code class="docutils literal"><span class="pre">?grant_type=client_credentials</span></code> querystring
exists &#8211; it&#8217;s part of the OAuth spec: <a class="reference external" href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a></p>
</div>
<p>The response is a JSON object which contains:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">access_token</span></code> - Your OAuth access token.  This can be used to authenticate
via subsequent requests.</li>
<li><code class="docutils literal"><span class="pre">token_type</span></code> - This will always be <code class="docutils literal"><span class="pre">'bearer'</span></code>.</li>
<li><code class="docutils literal"><span class="pre">expires_in</span></code> - This is the amount of seconds (<em>as an integer</em>) for which
this token is valid.</li>
</ul>
</div>
<div class="section" id="making-oauth-requests">
<h4>Making OAuth Requests<a class="headerlink" href="#making-oauth-requests" title="Permalink to this headline">¶</a></h4>
<p>Now that you&#8217;ve got an OAuth access token, you can use this to make API requests
securely to you REST API.</p>
<p>Let&#8217;s say you&#8217;ve defined the following API endpoint:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// This API endpoint is *only* accessible to users with a valid OAuth token.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/me&#39;</span><span class="p">,</span> <span class="nx">stormpath</span><span class="p">.</span><span class="nx">apiAuthenticationRequired</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
    <span class="nx">givenName</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">givenName</span><span class="p">,</span>
    <span class="nx">surname</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">surname</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
  <span class="p">});</span>
</pre></div>
</div>
<p>By using the <code class="docutils literal"><span class="pre">stormpath.apiAuthenticationRequired</span></code> middleware, users will be
authenticated automatically on your behalf.</p>
<p>Here&#8217;s a sample curl request to this endpoint without any credentials:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/me</span>
<span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;Invalid API credentials.&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>And here&#8217;s a sample curl request to this endpoint with the Bearer token
included:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">v</span> <span class="o">-</span><span class="nx">H</span> <span class="s1">&#39;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJEUExSSTVUTEVNMjFTQzNER0xHUjBJOFpYIiwiaXNzIjoiaHR0cHM6Ly9hcGkuc3Rvcm1wYXRoLmNvbS92MS9hcHBsaWNhdGlvbnMvNWpvQVVKdFZONHNkT3dUVVJEc0VDNSIsImlhdCI6MTQwNjY1OTkxMCwiZXhwIjoxNDA2NjYzNTEwLCJzY29wZSI6IiJ9.ypDMDMMCRCtDhWPMMc9l_Q-O-rj5LATalHYa3droYkY&#39;</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:3000/me</span>
<span class="p">{</span><span class="s2">&quot;givenName&quot;</span><span class="o">:</span><span class="s2">&quot;Randall&quot;</span><span class="p">,</span><span class="s2">&quot;surname&quot;</span><span class="o">:</span><span class="s2">&quot;Degges&quot;</span><span class="p">,</span><span class="s2">&quot;email&quot;</span><span class="o">:</span><span class="s2">&quot;r@rdegges.com&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>As you can see, by correctly specifying your OAuth token, you&#8217;re able to
authenticate against the API endpoint easily!</p>
</div>
</div>
</div>
<div class="section" id="customize-redirect-logic">
<h2>Customize Redirect Logic<a class="headerlink" href="#customize-redirect-logic" title="Permalink to this headline">¶</a></h2>
<p>As you might have already noticed by playing around with the registration and
login pages &#8211; when you first register or log into an account, you&#8217;ll be
immediately redirected to the URL <code class="docutils literal"><span class="pre">/</span></code>.</p>
<p>This is actually a configurable setting &#8211; you can easily modify this default
redirect URL by adding the following config setting:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">redirectUrl</span><span class="o">:</span> <span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>This allows you to build nicer apps as you can do stuff like redirect newly
registered users to a tutorial, dashboard, or something similar.</p>
<p>What if someone visits the login route when they are logged in?  By default
they will see the login screen again, but, but enabling the <code class="docutils literal"><span class="pre">enableAutoLogin</span></code>
feature, users who are already logged in will be automatically redirected to
your <code class="docutils literal"><span class="pre">redirectUrl</span></code> &#8211; skipping the login page all together:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableAutoLogin</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a user visits a page which has restricted access, they&#8217;ll be redirected
to the login page.  Once the user logs in, they&#8217;ll be immediately redirected
back to whatever page they were initially trying to access (<em>this behavior
overrides the ``redirectUrl`` setting</em>).</p>
</div>
</div>
<div class="section" id="customize-user-registration-fields">
<h2>Customize User Registration Fields<a class="headerlink" href="#customize-user-registration-fields" title="Permalink to this headline">¶</a></h2>
<p>In many cases you might want to change the fields you collect when a user
registers.  Let&#8217;s customize the fields we ask for when a user registers!</p>
<p>Every user you register ends up getting stored in Stormpath as an <a class="reference external" href="http://docs.stormpath.com/rest/product-guide/#accounts">Account</a>
object.  Accounts in Stormpath have several fields you can set:</p>
<ul class="simple">
<li>username</li>
<li>email (<strong>required</strong>)</li>
<li>password (<strong>required</strong>)</li>
<li>givenName (<strong>required</strong>) also known as &#8220;first name&#8221;</li>
<li>middleName</li>
<li>surname (<strong>required</strong>) also known as &#8220;last name&#8221;</li>
</ul>
<p>By default, the built-in registration view that Express-Stormpath ships with gets
you a registration page that looks like this:</p>
<img alt="_images/registration-page.png" src="_images/registration-page.png" />
<p>As you can see, it includes the <code class="docutils literal"><span class="pre">givenName</span></code>, <code class="docutils literal"><span class="pre">middleName</span></code>, <code class="docutils literal"><span class="pre">surname</span></code>,
<code class="docutils literal"><span class="pre">email</span></code>, and <code class="docutils literal"><span class="pre">password</span></code> fields by default.  All of these fields are
required, with the exception of <code class="docutils literal"><span class="pre">middleName</span></code>.</p>
<p>What happens if a user enters an invalid value &#8211; or leaves a required field
blank?  They&#8217;ll see something like this:</p>
<img alt="_images/registration-page-error.png" src="_images/registration-page-error.png" />
<p>But what if you want to force the user to enter a value for middle name?  Doing
so is easy!  Express-Stormpath is <strong>highly customizable</strong>, and allows you to
easily control which fields are accepted, and which fields are required.</p>
<p>To require a user to enter a middle name field, set the following value in your
Express app config:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableMiddleName</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">requireMiddleName</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>Now go ahead and give it a try &#8211; if you attempt to create a new user and don&#8217;t
specify a middle name, you&#8217;ll see an error!</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each Stormpath field allows you to specify two config values:
<code class="docutils literal"><span class="pre">enableFieldName</span></code> and <code class="docutils literal"><span class="pre">requireFieldName</span></code>.  The <code class="docutils literal"><span class="pre">enableXXX</span></code> setting
controls whether or not the specified field is displayed on the registration
page &#8211; the <code class="docutils literal"><span class="pre">requireXXX</span></code> field controls whether or not the specified field
is required by the user to successfully complete the registration process.</p>
</div>
<p>Lastly, it&#8217;s also simple to add in a <code class="docutils literal"><span class="pre">username</span></code> field (<em>either required or
optional</em>).  Just like the examples above, you can use the <code class="docutils literal"><span class="pre">enable</span></code> and
<code class="docutils literal"><span class="pre">require</span></code> settings to control the registration behavior:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableUsername</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">requireUsername</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>And that&#8217;s it!</p>
</div>
<div class="section" id="customize-user-login-fields">
<h2>Customize User Login Fields<a class="headerlink" href="#customize-user-login-fields" title="Permalink to this headline">¶</a></h2>
<p>If you visit your login page (<code class="docutils literal"><span class="pre">/login</span></code>), you will see (<em>by default</em>), two
input boxes: one for <code class="docutils literal"><span class="pre">email</span></code> and one for <code class="docutils literal"><span class="pre">password</span></code>.</p>
<p>While this is fine for most purposes, sometimes you might want to let users log
in with a <code class="docutils literal"><span class="pre">username</span></code> <strong>or</strong> <code class="docutils literal"><span class="pre">email</span></code> (especially if your site collects
<code class="docutils literal"><span class="pre">username</span></code> during registration).</p>
<p>Doing this is simple: by enabling the <code class="docutils literal"><span class="pre">enableUsername</span></code> setting you&#8217;ll not
only make the <code class="docutils literal"><span class="pre">username</span></code> field available on the registration page,
but also on the login page (<em>so users can log in by entering either their
``username`` or ``email`` and ``password``</em>).</p>
<p>To enable <code class="docutils literal"><span class="pre">username</span></code> support, just set the following config variable:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableUsername</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>You should now see the following on your login page:</p>
<img alt="_images/login-page.png" src="_images/login-page.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the example above we didn&#8217;t set the <code class="docutils literal"><span class="pre">requireUsername</span></code> field
to <code class="docutils literal"><span class="pre">true</span></code> &#8211; if we did, this would ensure that when a new user registers
for the site, they <strong>must</strong> pick a <code class="docutils literal"><span class="pre">username</span></code>.</p>
<p class="last">The <code class="docutils literal"><span class="pre">requireUsername</span></code> field has no effect on the login page.</p>
</div>
</div>
<div class="section" id="customize-user-registration-login-and-logout-routes">
<h2>Customize User Registration, Login, and Logout Routes<a class="headerlink" href="#customize-user-registration-login-and-logout-routes" title="Permalink to this headline">¶</a></h2>
<p>By default, Express-Stormpath automatically enables three separate views and
routes:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/register</span></code> - the registration view</li>
<li><code class="docutils literal"><span class="pre">/login</span></code> - the login view</li>
<li><code class="docutils literal"><span class="pre">/logout</span></code> - the logout view</li>
</ul>
<p>Customizing the built-in URL routes is quite simple.  There are several config
variables you can change to control these URL mappings.  To change them, just
modify your app&#8217;s config.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">registrationUrl</span></code> &#8211; default: <code class="docutils literal"><span class="pre">/register</span></code></li>
<li><code class="docutils literal"><span class="pre">loginUrl</span></code> &#8211; default: <code class="docutils literal"><span class="pre">/login</span></code></li>
<li><code class="docutils literal"><span class="pre">logoutUrl</span></code> &#8211; default: <code class="docutils literal"><span class="pre">/logout</span></code></li>
</ul>
<p>If you were to modify your config such that:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">registrationUrl</span><span class="o">:</span> <span class="s1">&#39;/welcome&#39;</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>Then visit <code class="docutils literal"><span class="pre">/welcome</span></code>, you&#8217;d see your registration page there, instead!</p>
</div>
<div class="section" id="customize-the-views">
<h2>Customize the Views<a class="headerlink" href="#customize-the-views" title="Permalink to this headline">¶</a></h2>
<p>Although I personally find our registration and login pages to be incredibly
good looking &#8211; I realize that you might not share my same design passion!</p>
<p>Express-Stormpath was built with customizability in mind, and makes it very easy
to build your own custom registration and login views.</p>
<p>Let&#8217;s start by looking at the built-in views:
<a class="reference external" href="https://github.com/stormpath/stormpath-express/tree/master/lib/views">https://github.com/stormpath/stormpath-express/tree/master/lib/views</a></p>
<p>Here&#8217;s a quick rundown of what each template is for:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">base.jade</span></code> is the base template that the registration and login templates
extend.  It provides a basic <a class="reference external" href="http://getbootstrap.com/">bootstrap</a> based layout, with a couple of
blocks for customizing the child templates.</li>
<li><code class="docutils literal"><span class="pre">login.jade</span></code> is the login page.  It has some logic to flash error messages
to the user if something fails, and also dynamically determines which input
boxes to display based on the app&#8217;s settings.</li>
<li><code class="docutils literal"><span class="pre">register.jade</span></code> is the registration page.  It has some logic to flash error
messages to the user if something fails, and also dynamically determines
which input boxes to display based on the app&#8217;s settings.</li>
</ul>
<p>If you&#8217;re comfortable with <a class="reference external" href="http://jade-lang.com/">Jade</a>, you can copy these templates to your
project directly, and customize them yourself.  If you&#8217;re not already a super
Express guru, continue reading!</p>
<div class="section" id="the-most-basic-view">
<h3>The Most Basic View<a class="headerlink" href="#the-most-basic-view" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say you want to build your own, fully customized registration and login
views &#8211; no problem!</p>
<p>The first thing you need to do is create two views in the <code class="docutils literal"><span class="pre">views</span></code>
directory of your project.</p>
<p>First, copy the following code into <code class="docutils literal"><span class="pre">views/register.jade</span></code>:</p>
<div class="highlight-javascript"><div class="highlight"><pre>// Display an error if there is any.
if error
  p #{error}

form(method=&#39;post&#39;)
  input(name=&#39;_csrf&#39;, type=&#39;hidden&#39;, value=csrfToken)

  // This block of code renders the desired input boxes for registering users.
  if app.get(&#39;stormpathEnableUsername&#39;)
    input(placeholder=&#39;Username&#39;, name=&#39;username&#39;, required=app.get(&#39;stormpathRequireUsername&#39;) ? true : false, type=&#39;text&#39;)

  if app.get(&#39;stormpathEnableGivenName&#39;)
    input(placeholder=&#39;First Name&#39;, name=&#39;givenName&#39;, required=app.get(&#39;stormpathRequireGivenName&#39;) ? true : false, type=&#39;text&#39;)

  if app.get(&#39;stormpathEnableMiddleName&#39;)
    input(placeholder=&#39;Middle Name&#39;, name=&#39;middleName&#39;, required=app.get(&#39;stormpathRequireMiddleName&#39;) ? true : false, type=&#39;text&#39;)

  if app.get(&#39;stormpathEnableSurname&#39;)
    input(placeholder=&#39;Last Name&#39;, name=&#39;surname&#39;, required=app.get(&#39;stormpathRequireSurname&#39;) ? true : false, type=&#39;text&#39;)

  input(placeholder=&#39;Email&#39;, name=&#39;email&#39;, required=&#39;true&#39;, type=&#39;text&#39;)
  input(placeholder=&#39;Password&#39;, name=&#39;password&#39;, required=&#39;true&#39;, type=&#39;password&#39;)

  button(type=&#39;submit&#39;) Create Account
</pre></div>
</div>
<p>The simple template you see above is the most basic possible registration page.
It renders all of the appropriate input forms, based on your settings.</p>
<p>Next, copy the following code into <code class="docutils literal"><span class="pre">views/login.jade</span></code>:</p>
<div class="highlight-javascript"><div class="highlight"><pre>// Display an error if there is any.
if error
  p #{error}

form(method=&#39;post&#39;)
  input(name=&#39;_csrf&#39;, type=&#39;hidden&#39;, value=csrfToken)

  if app.get(&#39;stormpathEnableUsername&#39;)
    input(placeholder=&#39;Username or Email&#39;, required=true, name=&#39;login&#39;, type=&#39;text&#39;)
  else
    input(placeholder=&#39;Email&#39;, required=true, name=&#39;login&#39;, type=&#39;text&#39;)

  input(placeholder=&#39;Password&#39;, required=true, type=&#39;password&#39;, name=&#39;password&#39;)
  button(type=&#39;submit&#39;) Log In
</pre></div>
</div>
<p>This is the most basic login template possible.</p>
</div>
<div class="section" id="update-template-paths">
<h3>Update Template Paths<a class="headerlink" href="#update-template-paths" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve got the simplest possible templates ready to go, let&#8217;s activate
them!  In your app&#8217;s config, you&#8217;ll need to specify the path to your new
templates like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">registrationView</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views/register.jade&#39;</span><span class="p">,</span>
  <span class="nx">loginView</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views/login.jade&#39;</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>That will tell Express-Stormpath to render the templates you created above instead
of the built-in ones!</p>
<p>Now, if you open your browser and checkout <code class="docutils literal"><span class="pre">/register</span></code> and <code class="docutils literal"><span class="pre">/login</span></code>, you
should see something like the following:</p>
<img alt="_images/registration-page-basic.png" src="_images/registration-page-basic.png" />
<img alt="_images/login-page-basic.png" src="_images/login-page-basic.png" />
<p><strong>BAM!</strong>  That wasn&#8217;t so bad, was it?  You now have your own customized
registration and login templates &#8211; all you need to do now is design them the
way you want!</p>
</div>
</div>
<div class="section" id="disable-the-built-in-views">
<h2>Disable the Built-in Views<a class="headerlink" href="#disable-the-built-in-views" title="Permalink to this headline">¶</a></h2>
<p>If for some reason you want to write your own registration, login, and logout
views (<em>not recommended</em>), you can easily disable all of the automatic
functionality described above by modifying your app config and adding the
following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableRegistration</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">enableLogin</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">enableLogout</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
</div>
<div class="section" id="use-account-verification">
<h2>Use Account Verification<a class="headerlink" href="#use-account-verification" title="Permalink to this headline">¶</a></h2>
<p>As of Express-Stormpath <strong>0.1.8</strong>, it is now possible to easily enable an
&#8220;Account Verification Workflow&#8221;, which makes newly registered users click a link
in in their email inbox before completing user the user registration process.</p>
<p>If you&#8217;d like to ensure your users are registering with legitimate email
addresses, this feature makes the process as painless as possible =)</p>
<div class="section" id="configure-the-workflow">
<h3>Configure the Workflow<a class="headerlink" href="#configure-the-workflow" title="Permalink to this headline">¶</a></h3>
<p>The first thing you need to do to enable &#8220;Account Verification&#8221; functionality
in your Express app is visit the <a class="reference external" href="https://api.stormpath.com/v#!directories">Directory Dashboard</a> and select your default
user directory.</p>
<p>Next, you should see several options in a tab.  You will want to click the
&#8220;Workflows&#8221; button.  Once you&#8217;ve landed on this page, you&#8217;ll then want to click
the &#8220;show&#8221; link to the right of the &#8220;Account Registration and Verification&#8221;
header.  This section allows you to configure your &#8220;Account Verification&#8221;
settings.</p>
<p>On this page, the only thing you <strong>need</strong> to change is the &#8220;Account Verification
Base URL&#8221; setting at the top.  You need to set this to be:
<code class="docutils literal"><span class="pre">https://mysite.com/verified</span></code>, substituting in your own website address.</p>
<p>For instance, if your site lives at <code class="docutils literal"><span class="pre">https://www.mysite.com</span></code>, you&#8217;ll want to
set &#8220;Account Verification Base URL&#8221; to <code class="docutils literal"><span class="pre">https://www.mysite.com/verified</span></code>.</p>
<p>This URL determines where a user will be redirected after clicking the
verification link in the email we send them.  If you&#8217;re testing things out
locally, you can also set this to a local URL (eg:
<code class="docutils literal"><span class="pre">http://localhost:3000/verified</span></code>).</p>
<p>After setting &#8220;Account Verification Base URL&#8221;, you can also adjust any of the
other settings below &#8211; you can customize the email templates that are used to
email the user, and a variety of other options.</p>
<p>When you&#8217;re finished customizing the &#8220;Account Verification Workflow&#8221;, be sure
to hit the &#8220;Update&#8221; button at the bottom of the page.</p>
</div>
<div class="section" id="enable-account-verification-in-your-app">
<h3>Enable Account Verification in Your App<a class="headerlink" href="#enable-account-verification-in-your-app" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve configured the &#8220;Account Verification&#8221; settings on Stormpath&#8217;s
side, you need to configure your Express application to enable account
verification.</p>
<p>You can do this easily by modifying your application config like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableAccountVerification</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>And...  That&#8217;s all you have to do!</p>
</div>
<div class="section" id="test-it-out">
<h3>Test it Out<a class="headerlink" href="#test-it-out" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve fully enabled account verification functionality in your app,
open up the registration page in your Express app and check it out!  After
creating a new user account, you&#8217;ll be greeted by a message informing you that
before you can continue you need to click the verification link in your inbox.
This page looks like this:</p>
<img alt="_images/verification.png" src="_images/verification.png" />
<p>Then, depending on your &#8220;Account Verification Workflow&#8221; configuration, the user
will see an email that looks like the following:</p>
<img alt="_images/verification-email.png" src="_images/verification-email.png" />
<p>When a user clicks the link in their email, they&#8217;ll reach a success page that
looks like this:</p>
<img alt="_images/verification-complete.png" src="_images/verification-complete.png" />
<p>And lastly, once a user clicks the verification link, they&#8217;ll be automatically
logged into their account, then redirected to the main page of your site
(whatever URL is set as <code class="docutils literal"><span class="pre">redirectUrl</span></code> in your configuration).  They&#8217;ll also
be shown this page for a few seconds to let them know the change was successful.</p>
<p>Not bad, right?</p>
</div>
<div class="section" id="customization">
<h3>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h3>
<p>Much like all other Express-Stormpath features, the account verification feature is
completely customizable.</p>
<p>You can easily change the account verification templates by modifying the following
configuration variables, respectively:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">stormpathAccountVerificationEmailSentView</span></code> - The view which is shown after
a new user creates an account.</li>
<li><code class="docutils literal"><span class="pre">stormpathAccountVerificationCompleteView</span></code> - The view which is shown after
a user clicks the verification link in their email.</li>
</ul>
<p>If you&#8217;d like to override the default views, you should take a look at the
ones included with Express-Stormpath here:
<a class="reference external" href="https://github.com/stormpath/stormpath-express/tree/master/lib/views">https://github.com/stormpath/stormpath-express/tree/master/lib/views</a>
and use these as a base for your own views.</p>
</div>
</div>
<div class="section" id="use-password-reset">
<h2>Use Password Reset<a class="headerlink" href="#use-password-reset" title="Permalink to this headline">¶</a></h2>
<p>As of Express-Stormpath <strong>0.1.6</strong>, it is now possible to easily enable a &#8220;Password
Reset Workflow&#8221;, which allows your users to reset their passwords automatically.</p>
<p>We highly encourage you to use this feature, as it provides a simple and secure
way to allow your users to reset their passwords without hassle.</p>
<div class="section" id="id1">
<h3>Configure the Workflow<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The first thing you need to do to enable &#8220;Password Reset&#8221; functionality in your
Express app is visit the <a class="reference external" href="https://api.stormpath.com/v#!directories">Directory Dashboard</a> and select your default user
directory.</p>
<p>Next, you should see several options in a tab.  You will want to click the
&#8220;Workflows&#8221; button.  Once you&#8217;ve landed on this page, you&#8217;ll then want to click
the &#8220;show&#8221; link to the right of the &#8220;Password Reset&#8221; header.  This section
allows you to configure your &#8220;Password Reset&#8221; settings.</p>
<p>On this page, the only thing you <strong>need</strong> to change is the &#8220;Base URL&#8221; setting at
the top.  You need to set this to be: <code class="docutils literal"><span class="pre">https://mysite.com/forgot/change</span></code>,
substituting in your own website address.</p>
<p>For instance, if your site lives at <code class="docutils literal"><span class="pre">https://www.mysite.com</span></code>, you&#8217;ll want to
set &#8220;Base URL&#8221; to <code class="docutils literal"><span class="pre">https://www.mysite.com/forgot/change</span></code>.</p>
<p>This URL determines where a user will be redirected after attempting to reset
their password on your website.  If you&#8217;re testing things out locally, you can
also set this to a local URL (eg: <code class="docutils literal"><span class="pre">http://localhost:3000/forgot/change</span></code>).</p>
<p>After setting &#8220;Base URL&#8221;, you can also adjust any of the other settings below &#8211;
you can customize the email templates that are used to email the user, and a
variety of other options.</p>
<p>When you&#8217;re finished customizing the &#8220;Password Reset Workflow&#8221;, be sure to hit
the &#8220;Update&#8221; button at the bottom of the page.</p>
</div>
<div class="section" id="enable-password-reset-in-your-app">
<h3>Enable Password Reset in Your App<a class="headerlink" href="#enable-password-reset-in-your-app" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve configured the &#8220;Password Reset&#8221; settings on Stormpath&#8217;s side,
you need to configure your Express application to enable password reset.</p>
<p>You can do this easily by modifying your application config like so:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableForgotPassword</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>And...  That&#8217;s all you have to do!</p>
</div>
<div class="section" id="id2">
<h3>Test it Out<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve fully enabled password reset functionality in your app, open up
the login page in your Express app and check it out!  You should see a &#8220;Forgot
Password?&#8221; link below the login form which looks like this:</p>
<img alt="_images/forgot.png" src="_images/forgot.png" />
<p>If you click the &#8220;Forgot Password?&#8221; link, you&#8217;ll be brought to a password reset
page that looks like this:</p>
<img alt="_images/forgot-init.png" src="_images/forgot-init.png" />
<p>After filling in their email address, a user will see the following page:</p>
<img alt="_images/forgot-email-sent.png" src="_images/forgot-email-sent.png" />
<p>Then, depending on your &#8220;Password Reset Workflow&#8221; configuration, the user will
see an email that looks like the following:</p>
<img alt="_images/forgot-email.png" src="_images/forgot-email.png" />
<p>When a user clicks the link in their email, they&#8217;ll reach a password change page
that looks like this:</p>
<img alt="_images/forgot-change.png" src="_images/forgot-change.png" />
<p>And lastly, once a user changes their password successfully, they&#8217;ll be
automatically logged into their account, then redirected to the main page of
your site (whatever URL is set as <code class="docutils literal"><span class="pre">redirectUrl</span></code> in your configuration).
They&#8217;ll also be shown this page for a few seconds to let them know the change
was successful:</p>
<img alt="_images/forgot-complete.png" src="_images/forgot-complete.png" />
<p>Not bad, right?</p>
</div>
<div class="section" id="id3">
<h3>Customization<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Much like all other Express-Stormpath features, the password reset feature is
completely customizable.</p>
<p>You can easily change the password reset templates by modifying the following
configuration variables, respectively:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">forgotPasswordView</span></code> - The view which is shown when a user clicks the
&#8220;Forgot Password?&#8221; link on the login page.</li>
<li><code class="docutils literal"><span class="pre">forgotPasswordEmailSentView</span></code> - The view which is shown after a user
has successfully requested a password reset.</li>
<li><code class="docutils literal"><span class="pre">forgotPasswordChangeView</span></code> - The view which is shown to a user after
they&#8217;ve clicked the link in their email.  This view allows the user to
change their password.</li>
<li><code class="docutils literal"><span class="pre">forgotPasswordCompleteView</span></code> - The view which is shown after the user has
successfully reset their account password.</li>
</ul>
<p>If you&#8217;d like to override the default views, you should take a look at the
ones included with Express-Stormpath here:
<a class="reference external" href="https://github.com/stormpath/stormpath-express/tree/master/lib/views">https://github.com/stormpath/stormpath-express/tree/master/lib/views</a>
and use these as a base for your own views.</p>
</div>
</div>
<div class="section" id="use-facebook-login">
<h2>Use Facebook Login<a class="headerlink" href="#use-facebook-login" title="Permalink to this headline">¶</a></h2>
<p>Now that we&#8217;ve covered the basics: let&#8217;s add Facebook Login support to your app!
Stormpath makes it very easy to support social login with Facebook.</p>
<p>In the next few minutes I&#8217;ll walk you through <em>everything</em> you need to know to
support Facebook login with your app.</p>
<div class="section" id="create-a-facebook-app">
<h3>Create a Facebook App<a class="headerlink" href="#create-a-facebook-app" title="Permalink to this headline">¶</a></h3>
<p>The first thing you need to do is log into the <a class="reference external" href="https://developers.facebook.com/">Facebook Developer Site</a> and
create a new Facebook App.</p>
<p>You can do this by visiting the <a class="reference external" href="https://developers.facebook.com/">Facebook Developer Site</a> and click the &#8220;Apps&#8221;
menu at the top of the screen, then select the &#8220;Create a New App&#8221; button.  You
should see something like the following:</p>
<img alt="_images/facebook-new-project.png" src="_images/facebook-new-project.png" />
<p>Go ahead and pick a &#8220;Display Name&#8221; (usually the name of your app), and choose a
category for your app.  Once you&#8217;ve done this, click the &#8220;Create App&#8221; button.</p>
</div>
<div class="section" id="specify-allowed-urls">
<h3>Specify Allowed URLs<a class="headerlink" href="#specify-allowed-urls" title="Permalink to this headline">¶</a></h3>
<p>The next thing we need to do is tell Facebook what URLs we&#8217;ll be using Facebook
Login from.</p>
<p>From the app dashboard page you&#8217;re on, click the &#8220;Settings&#8221; tab in the left
menu, then click the &#8220;Add Platform&#8221; button near the bottom of the page.  When
prompted, select &#8220;Website&#8221; as your platform type.</p>
<p>In the &#8220;Site URL&#8221; box, enter your private and public root URLs.  This should be
something like <code class="docutils literal"><span class="pre">&quot;http://localhost:3000&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;http://mysite.com&quot;</span></code>.  <em>If you
want to allow Facebook Login from multiple URLs (local development, production,
etc.) you can just click the &#8220;Add Platform&#8221; button again and enter another URL.</em></p>
<p>Lastly, click the &#8220;Save Changes&#8221; button to save the changes.</p>
<p>Your settings should now look something like this:</p>
<img alt="_images/facebook-url-settings.png" src="_images/facebook-url-settings.png" />
</div>
<div class="section" id="create-a-facebook-directory">
<h3>Create a Facebook Directory<a class="headerlink" href="#create-a-facebook-directory" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to input the Facebook app credentials into Stormpath.  This allows
Stormpath to interact with the Facebook API on your behalf, which automates all
OAuth flows.</p>
<p>To do this, you need to visit the <a class="reference external" href="https://api.stormpath.com/v#!directories">Directory dashboard</a> and create a new
directory.  When you click the &#8220;Create Directory&#8221; button, click the &#8220;Facebook&#8221;
button, then on the following screen enter your Facebook app information:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; field, you can insert whatever name you want.</li>
<li>For the &#8220;Facebook Client ID&#8221; field, insert your Facebook App ID which you got
in the previous steps.</li>
<li>For the &#8220;Facebook Client Secret&#8221; field, insert your Facebook Client Secret
which you got in the previous steps.</li>
</ul>
<p>Lastly, be sure to click the &#8220;Save&#8221; button at the bottom of the page.</p>
<p>Next, you need to hook your new Facebook Directory up to your Stormpath
Application.  To do this, visit the <a class="reference external" href="https://api.stormpath.com/v#!applications">Application dashboard</a> and select your
Application from the list.</p>
<p>On your Application page, click the &#8220;Account Stores&#8221; tab, then click the &#8220;Add
Account Store&#8221; button.  From the drop down list, select your newly created
Facebook Directory, then save your changes.</p>
<p>That&#8217;s it!</p>
</div>
<div class="section" id="configure-your-express-app">
<h3>Configure Your Express App<a class="headerlink" href="#configure-your-express-app" title="Permalink to this headline">¶</a></h3>
<p>Now that we&#8217;ve created a new Facebook App and configured our URLs &#8211; we need to
enter our Facebook App secrets into our Express app so that express-stormpath
knows about them.</p>
<p>You can find your Facebook App ID and Secret on your App dashboard page, at the
top of the screen.</p>
<p>In your app&#8217;s config, you&#8217;ll want to add the following settings (<em>don&#8217;t forget
to substitute in the proper credentials!</em>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableFacebook</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">social</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">facebook</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">appId</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
      <span class="nx">appSecret</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>These two settings: <code class="docutils literal"><span class="pre">enableFacebook</span></code> and <code class="docutils literal"><span class="pre">social</span></code> work together to tell
express-stormpath to enable social login support for Facebook, as well as
provide the proper credentials so things work as expected.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We recommend storing your credentials in environment variables.  Please
don&#8217;t hard code secret credentials into your source code!</p>
</div>
</div>
<div class="section" id="id4">
<h3>Test it Out<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve plugged your Facebook credentials into express-stormpath, social
login should already be working!</p>
<p>Open your express app in a browser, and try logging in by visiting the login page
(<code class="docutils literal"><span class="pre">/login</span></code>).  If you&#8217;re using the default login page included with this
library, you should see the following:</p>
<img alt="_images/login-page-facebook.png" src="_images/login-page-facebook.png" />
<p>You now have a fancy new Facebook enabled login button!  Try logging in!  When
you click the new Facebook button you&#8217;ll be redirected to Facebook, and
prompted to accept the permissions requested:</p>
<img alt="_images/login-page-facebook-permissions.png" src="_images/login-page-facebook-permissions.png" />
<p>After accepting permissions, you&#8217;ll be immediately redirected back to your
website at the URL specified by <code class="docutils literal"><span class="pre">redirectUrl</span></code> in your app&#8217;s config.</p>
<p>Simple, right?!</p>
</div>
</div>
<div class="section" id="use-google-login">
<h2>Use Google Login<a class="headerlink" href="#use-google-login" title="Permalink to this headline">¶</a></h2>
<p>Google Login is incredibly popular &#8211; let&#8217;s enable it!</p>
<p>In the next few minutes I&#8217;ll walk you through <em>everything</em> you need to know to
support Google login with your app.</p>
<div class="section" id="create-a-google-project">
<h3>Create a Google Project<a class="headerlink" href="#create-a-google-project" title="Permalink to this headline">¶</a></h3>
<p>The first thing you need to do is log into the <a class="reference external" href="https://console.developers.google.com/project">Google Developer Console</a> and
create a new Google Project.</p>
<p>You can do this by visiting the <a class="reference external" href="https://console.developers.google.com/project">Developer Console</a> and clicking the &#8220;Create
Project&#8221; button.  You should see something like the following:</p>
<img alt="_images/google-new-project.png" src="_images/google-new-project.png" />
<p>Go ahead and pick a &#8220;Project Name&#8221; (usually the name of your app), and
(<em>optionally</em>) a &#8220;Project ID&#8221;.</p>
</div>
<div class="section" id="enable-google-login">
<h3>Enable Google Login<a class="headerlink" href="#enable-google-login" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve got a Google Project &#8211; let&#8217;s enable Google Login.  The way
Google Projects work is that you have to selectively enable what functionality
each Project needs.</p>
<p>From your <a class="reference external" href="https://console.developers.google.com/project">Console Dashboard</a> click on your new Project, then in the side panel
click on the &#8220;APIs &amp; auth&#8221; menu option.</p>
<p>Now, scroll through the API list until you see &#8220;Google+ API&#8221;, then click the
&#8220;OFF&#8221; button next to it to enable it.  You should now see the &#8220;Google+ API&#8221; as
&#8220;ON&#8221; in your API list:</p>
<img alt="_images/google-enable-login.png" src="_images/google-enable-login.png" />
</div>
<div class="section" id="create-oauth-credentials">
<h3>Create OAuth Credentials<a class="headerlink" href="#create-oauth-credentials" title="Permalink to this headline">¶</a></h3>
<p>The next thing we need to do is create a new OAuth client ID.  This is what
we&#8217;ll use to handle user login with Google.</p>
<p>From your <a class="reference external" href="https://console.developers.google.com/project">Console Dashboard</a> click the &#8220;APIs &amp; auth&#8221; menu, then click on the
&#8220;Credentials&#8221; sub-menu.</p>
<p>You should see a big red button labeled &#8220;Create New Client ID&#8221; near the top of
the page &#8211; click that.</p>
<p>You&#8217;ll want to do several things here:</p>
<ol class="arabic simple">
<li>Select &#8220;Web application&#8221; for your &#8220;Application Type&#8221;.</li>
<li>Remove everything from the &#8220;Authorized Javascript Origins&#8221; box.</li>
<li>Add the URL of your site (both publicly and locally) into the &#8220;Authorized
Redirect URI&#8221; box, with the <code class="docutils literal"><span class="pre">/google</span></code> suffix.  This tells Google where to
redirect users after they&#8217;ve logged in with Google.</li>
</ol>
<p>In the end, your settings should look like this:</p>
<img alt="_images/google-oauth-settings.png" src="_images/google-oauth-settings.png" />
<p>Once you&#8217;ve specified your settings, go ahead and click the &#8220;Create Client ID&#8221;
button.</p>
<p>Lastly, you&#8217;ll want to take note of your &#8220;Client ID&#8221; and &#8220;Client Secret&#8221;
variables that should now be displayed on-screen.  We&#8217;ll need these in the next
step.</p>
</div>
<div class="section" id="create-a-google-directory">
<h3>Create a Google Directory<a class="headerlink" href="#create-a-google-directory" title="Permalink to this headline">¶</a></h3>
<p>Next, we need to input the Google app credentials into Stormpath.  This allows
Stormpath to interact with the Google API on your behalf, which automates all
OAuth flows.</p>
<p>To do this, you need to visit the <a class="reference external" href="https://api.stormpath.com/v#!directories">Directory dashboard</a> and create a new
directory.  When you click the &#8220;Create Directory&#8221; button, click the &#8220;Google&#8221;
button, then on the following screen enter your Google app information:</p>
<ul class="simple">
<li>For the &#8220;Name&#8221; field, you can insert whatever name you want.</li>
<li>For the &#8220;Google Client ID&#8221; field, insert your Google Client ID which you got
in the previous steps.</li>
<li>For the &#8220;Google Client Secret&#8221; field, insert your Google Client Secret
which you got in the previous steps.</li>
</ul>
<p>Lastly, be sure to click the &#8220;Save&#8221; button at the bottom of the page.</p>
<p>Next, you need to hook your new Google Directory up to your Stormpath
Application.  To do this, visit the <a class="reference external" href="https://api.stormpath.com/v#!applications">Application dashboard</a> and select your
Application from the list.</p>
<p>On your Application page, click the &#8220;Account Stores&#8221; tab, then click the &#8220;Add
Account Store&#8221; button.  From the drop down list, select your newly created
Google Directory, then save your changes.</p>
<p>That&#8217;s it!</p>
</div>
<div class="section" id="id5">
<h3>Configure Your Express App<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Now that we&#8217;ve created a new Google Project and generated OAuth secrets &#8211; we
can now enter these secrets into our Express app so that express-stormpath
knows about them.</p>
<p>In your app&#8217;s config, you&#8217;ll want to add the following settings (<em>don&#8217;t forget
to substitute in the proper credentials!</em>):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableGoogle</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">social</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">google</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">clientId</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
      <span class="nx">clientSecret</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>These two settings: <code class="docutils literal"><span class="pre">enableGoogle</span></code> and <code class="docutils literal"><span class="pre">social</span></code> work together to tell
express-stormpath to enable social login support for Google, as well as provide
the proper credentials so things work as expected.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We recommend storing your credentials in environment variables.  Please
don&#8217;t hard code secret credentials into your source code!</p>
</div>
</div>
<div class="section" id="id6">
<h3>Test it Out<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve plugged your Google credentials into express-stormpath, social
login should already be working!</p>
<p>Open your Express app in a browser, and try logging in by visiting the login page
(<code class="docutils literal"><span class="pre">/login</span></code>).  If you&#8217;re using the default login page included with this
library, you should see the following:</p>
<img alt="_images/login-page-google.png" src="_images/login-page-google.png" />
<p>You now have a fancy new Google enabled login button!  Try logging in!  When you
click the new Google button you&#8217;ll be redirected to Google, and prompted to
select your Google account:</p>
<img alt="_images/login-page-google-account.png" src="_images/login-page-google-account.png" />
<p>After selecting your account you&#8217;ll then be prompted to accept any permissions,
then immediately redirected back to your website at the URL specified by
<code class="docutils literal"><span class="pre">redirectUrl</span></code> in your app&#8217;s settings.</p>
<p>Simple, right?!</p>
</div>
</div>
<div class="section" id="use-hosted-login">
<h2>Use Hosted Login<a class="headerlink" href="#use-hosted-login" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;d like to use Stormpath&#8217;s new hosted login functionality (<em>known as ID
Site</em>), you can now do so using Express-Stormpath 0.2.2+!</p>
<p>Stormpath&#8217;s ID Site functionality works as so:</p>
<ul class="simple">
<li>If a user wants to register for your web site, they&#8217;ll be redirected to your
ID site URL (<em>hosted by Stormpath</em>).  This can be something like:
<a class="reference external" href="https://login.mysite.com">https://login.mysite.com</a></li>
<li>Stormpath will then display a login / registration / forgot password page
automatically, depending on what the user wants to do, allowing the user to
register <strong>without touching your Express application!</strong>  These pages can be
completely customized however you like, of course.</li>
<li>Once Stormpath has registered or logged the user in, they&#8217;ll be redirected
back to a route on your Express app (<em>which defaults to /redirect</em>).  This
route will then verify that the user was successfully logged in, and create a
user session.</li>
<li>Lastly, the user will be redirected back to whatever page on your site is
configured as the <code class="docutils literal"><span class="pre">redirectUrl</span></code> (<em>this defaults to /</em>).</li>
</ul>
<p>For more information on ID Site, please read the official documentation:
<a class="reference external" href="http://docs.stormpath.com/guides/using-id-site/">http://docs.stormpath.com/guides/using-id-site/</a></p>
<div class="section" id="enable-id-site">
<h3>Enable ID Site<a class="headerlink" href="#enable-id-site" title="Permalink to this headline">¶</a></h3>
<p>The first step in getting hosted login working is enabling the ID Site
functionality on Stormpath.</p>
<p>To do this, you&#8217;ll want to first visit your <a class="reference external" href="https://api.stormpath.com/v#!idSite">ID Site dashboard</a>.  This page is
where you can configure your hosted login functionality.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These instructions will only cover using the built-in hosted login site &#8211;
if you&#8217;d like to customize your ID Site URL or theme, that will be covered
later.</p>
</div>
<p>In the box labeled &#8220;Authorized Redirect URIs&#8221;, enter your redirect URL &#8211; this
should be set to something like: <code class="docutils literal"><span class="pre">https://www.mysite.com/redirect</span></code>.  If you&#8217;re
testing locally, you might want to set this to:
<code class="docutils literal"><span class="pre">http://localhost:3000/redirect</span></code>.</p>
<p>If you&#8217;d like to support <em>both</em> production and local environments, you can add
multiple URLs (<em>just click the &#8220;Add another&#8221; button and enter as many URLs as
you&#8217;d like</em>).</p>
<p>Lastly, make sure to click the &#8220;Update&#8221; button at the bottom of the page to save
your changes.</p>
<p>In the end, it should look something like this:</p>
<img alt="_images/id-site-settings.png" src="_images/id-site-settings.png" />
</div>
<div class="section" id="id7">
<h3>Configure Your Express App<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Now that we&#8217;ve configured Stormpath properly, let&#8217;s configure our Express app!</p>
<p>In your app&#8217;s config, you&#8217;ll want to add the following settings:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">stormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">enableIdSite</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>This setting tells Express-Stormpath to use the hosted login functionality
instead of the built-in local authentication functionality.</p>
</div>
<div class="section" id="id8">
<h3>Test it Out<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Now that you&#8217;ve configured hosted login, let&#8217;s give it a test.</p>
<p>If you start your Express server, then visit either the login or registration
page (<em>/login or /registration, respectively</em>), you should be redirected to your
hosted login site on Stormpath, where you can either create or log into your
account.</p>
<p>Once you&#8217;ve logged in, you&#8217;ll be redirected back to your application in a logged
in state!</p>
<p>Here&#8217;s a screenshot of the login page to show you what the hosted login site
currently looks like:</p>
<img alt="_images/id-site-login.png" src="_images/id-site-login.png" />
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="help.html" class="btn btn-neutral float-right" title="Getting Help">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quickstart"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Stormpath, Inc..
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   
  <script type="text/javascript">var _gaq = _gaq || [];   _gaq.push(['_setAccount', 'UA-29159574-1']);   _gaq.push(['_setDomainName', 'stormpath.com']);   _gaq.push(['_trackPageview']);    (function() {     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;     ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);   })();</script><script type="text/javascript">var _kmq = _kmq || [];   var _kmk = _kmk || '684b854336bd3a6523260ebd991eec06b18b929a';   function _kms(u){     setTimeout(function(){       var d = document, f = d.getElementsByTagName('script')[0],       s = d.createElement('script');       s.type = 'text/javascript'; s.async = true; s.src = u;       f.parentNode.insertBefore(s, f);     }, 1);   }   _kms('//i.kissmetrics.com/i.js');   _kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');</script><script src="//cdn.optimizely.com/js/225847041.js"></script>

</body>
</html>