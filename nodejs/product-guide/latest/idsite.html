

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Using ID Site &mdash; Stormpath REST API V1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Stormpath REST API V1 documentation" href="index.html"/>
        <link rel="next" title="REST API Reference" href="reference.html"/>
        <link rel="prev" title="7. Multi-Tenancy with Stormpath" href="multitenancy.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Stormpath REST API
          

          
          </a>

          
            
            
              <div class="version">
                V1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">1. About Stormpath</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">2. First-Time Set-Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accnt_mgmt.html">4. Account Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_n.html">5. Authenticating Accounts with Stormpath</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_z.html">6. Authorization With Stormpath</a></li>
<li class="toctree-l1"><a class="reference internal" href="multitenancy.html">7. Multi-Tenancy with Stormpath</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">8. Using ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-an-id-site">8.1. What is an ID Site?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-should-i-use-stormpath-id-site">Why should I use Stormpath ID Site?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-does-id-site-work">8.2. How does ID Site Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#idsite-set-up">8.3. ID Site Set Up</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-your-id-site">8.3.1. Setting Up Your ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-your-own-custom-domain-name-and-ssl-certificate">Setting Your Own Custom Domain Name and SSL Certificate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-your-application-to-use-id-site">Setting up your Application to use ID Site</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-id-site-via-rest-api">8.4. Using ID Site Via REST API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-getting-a-user-to-id-site">Step 1: Getting a User to ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#idsite-auth-jwt">ID Site Authentication JWT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-handling-the-callback-to-your-application-from-id-site">Step 2: Handling the Callback to your Application from ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id-site-assertion-jwt">ID Site Assertion JWT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exchanging-the-id-site-jwt-for-an-oauth-token">Exchanging the ID Site JWT for an OAuth Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-optional-logging-out-of-id-site-with-rest">Step 3: (Optional) Logging Out of ID Site with REST</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-your-password-with-id-site">Resetting Your Password with ID Site</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">REST API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Stormpath REST API</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>8. Using ID Site</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/idsite.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-id-site">
<span id="idsite"></span><h1>8. Using ID Site<a class="headerlink" href="#using-id-site" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-an-id-site">
<h2>8.1. What is an ID Site?<a class="headerlink" href="#what-is-an-id-site" title="Permalink to this headline">¶</a></h2>
<p>Stormpath ID Site is a set of hosted and pre-built user interface screens that take care of common identity functions for your applications — log in, registration, and password reset. ID Site can be accessed via your own custom domain like <code class="docutils literal"><span class="pre">id.mydomain.com</span></code> and shared across multiple applications to create centralized authentication.</p>
<p>The screens and functionality of ID Site are completely customizable. You have full access to the source code of the ID Site screens so you can make simple changes like adding your own logo and changing CSS or more complex changes like adding fields, JavaScript code, screens, removing screens, and even changing how the screens behave.</p>
<div class="section" id="why-should-i-use-stormpath-id-site">
<h3>Why should I use Stormpath ID Site?<a class="headerlink" href="#why-should-i-use-stormpath-id-site" title="Permalink to this headline">¶</a></h3>
<p>Building, securing, and maintaining identity screens for your users is time consuming, full of security concerns, and often more complex than many developers estimate. Stormpath ID Site gives you and your development team peace of mind that you will have best in class user security quickly and easily, with very little code — minimizing risk to your project timeline.</p>
<p>Stormpath ID Site fully decouples your identity screens from your applications, making it incredibly easy to provide the same login / registration pages for multiple applications — achieving centralized user management and authentication with a clean and easy user experience.</p>
</div>
</div>
<div class="section" id="how-does-id-site-work">
<h2>8.2. How does ID Site Work?<a class="headerlink" href="#how-does-id-site-work" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate how the SDK works, we&#8217;ll use an example. Imagine you are building an application for managing Stormtrooper equipment — like awesome helmets and blasters. The application is &#8220;Imperial Exchange&#8221;, available at <a class="reference external" href="http://imperialxchange.com/">http://imperialxchange.com/</a>, and it uses Stormpath ID Site for login and registration.</p>
<p>Once ImperialXchange.com is rendered by the browser, login and registration buttons are available for the unauthenticated user. Clicking on these buttons will call your server-side application at specific endpoints. For illustration, the login button will invoke <code class="docutils literal"><span class="pre">/login</span></code> and registration will invoke <code class="docutils literal"><span class="pre">/register</span></code>. Your application using the Stormpath SDK will securely redirect the user to the ID Site along with a cryptographically signed JSON Web Token (JWT) that includes information like the Callback URI, the path to a specific ID Site page, and any State you think is important for your application.</p>
<p>On the ID Site, the user will enter their data and complete the appropriate action, like login. ID Site will automatically detect any Workflow or Social Login configurations set in Stormpath and show the appropriate buttons, messaging, and behavior.</p>
<p>After the user has logged-in successfully, they will be redirected back to your application’s Callback URI. For illustration purposes, this could be <code class="docutils literal"><span class="pre">https://imperialxchange.com/idSiteResult</span></code>. When the ID Site redirects back to your application, it will pass a secure JWT that represents the account in Stormpath. Using the Stormpath SDK, your application will handle the request to <code class="docutils literal"><span class="pre">/idSiteResult</span></code>, validate that the JWT is correct, and return an <code class="docutils literal"><span class="pre">ID</span> <span class="pre">Site</span> <span class="pre">Account</span> <span class="pre">Result</span></code>. The <code class="docutils literal"><span class="pre">ID</span> <span class="pre">Site</span> <span class="pre">Account</span> <span class="pre">Result</span></code> will include the Stormpath Account object and additional information, such as any state that was passed by your application or whether or not the Account returned is newly created.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/ID-diagram.png"><img alt="ID Site Flow" src="_images/ID-diagram.png" /></a>
<p class="caption"><span class="caption-text"><em>The ID Site Flow</em></span></p>
</div>
</div>
<div class="section" id="idsite-set-up">
<span id="id-site-set-up"></span><h2>8.3. ID Site Set Up<a class="headerlink" href="#idsite-set-up" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-up-your-id-site">
<h3>8.3.1. Setting Up Your ID Site<a class="headerlink" href="#setting-up-your-id-site" title="Permalink to this headline">¶</a></h3>
<p>Your ID Site uses a default configuration for testing purposes, but can be fully configured to host customized code or to use your own custom domain.</p>
<p>To set up your ID Site, log into the <a class="reference external" href="https://api.stormpath.com/login">Administrator Console</a> and:</p>
<ol class="arabic simple">
<li>Click on the &#8220;ID Site&#8221; Tab.</li>
<li>Add your application URLs that will be allowed to process the callbacks from the ID Site to the &#8220;Authorized Redirect URIs&#8221; property. These URLs will be hosted by your application and will use the Stormpath SDK to process the security assertions about the user that ID Site sends back.</li>
<li>Click the &#8220;Update&#8221; button at the bottom of the page.</li>
</ol>
<p>Once you configure your ID site, a default subdomain will be created on <code class="docutils literal"><span class="pre">stormpath.io</span></code>. The default ID Site URL follows the format of <code class="docutils literal"><span class="pre">tenant-name.id.stormpath.io</span></code> where <code class="docutils literal"><span class="pre">tenant-name</span></code> is the name of your Stormpath Tenant.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your ID Site URL can only be accessed via a redirect from a Stormpath-enabled application because ID Site expects a cryptographically signed token with specific data in it. Simply visiting your ID Site URL in a browser will give you an error.</p>
</div>
<p>For more advanced configurations, there are additional properties in the ID Site configuration that can help:</p>
<ul class="simple">
<li>Set a Logo to appear at the top of the default ID Site</li>
<li>Set a custom domain name (like id.mydomain.com) and SSL certificate to host your ID Site from your domain, securely</li>
<li>Set a custom GitHub repo to host your ID Site (to host custom code)</li>
</ul>
<div class="section" id="setting-your-own-custom-domain-name-and-ssl-certificate">
<span id="idsite-custom-domain-ssl"></span><h4>Setting Your Own Custom Domain Name and SSL Certificate<a class="headerlink" href="#setting-your-own-custom-domain-name-and-ssl-certificate" title="Permalink to this headline">¶</a></h4>
<p>By default, the address of your ID Site is <code class="docutils literal"><span class="pre">tenant-name.id.stormpath.io</span></code>. However, you can change the address to a subdomain of your own website, such as <code class="docutils literal"><span class="pre">id.mysite.com</span></code>. The Stormtrooper equipment application’s main website is <code class="docutils literal"><span class="pre">imperialxchange.com</span></code>, so the initial address of the ID Site might be something like <code class="docutils literal"><span class="pre">happy-rebel.id.stormpath.io</span></code>. You can change the ID Site’s address to a subdomain of your company website, like <code class="docutils literal"><span class="pre">id.trooperxchange.com</span></code>. In our example, ImperialXchange.com is actually part of a family of sites owned by the parent company Galactic Gear. Galactic Gear wants single-sign-on across its family of websites, so the ID Site is actually found at <code class="docutils literal"><span class="pre">id.galacticgear.co</span></code>.</p>
<p>The workflow for changing the address consists of the following steps:</p>
<ol class="arabic simple">
<li>Get a domain name and a subdomain (if you have not already)</li>
<li>Configure the subdomain as an alias of your ID Site</li>
<li>Enable the custom domain in Stormpath’s ID Site configuration</li>
<li>Input SSL information for Stormpath to host</li>
</ol>
<p>For more information on each of these steps, read on.</p>
<div class="section" id="get-a-domain-name-and-a-subdomain">
<h5>1. Get a Domain Name and a Subdomain<a class="headerlink" href="#get-a-domain-name-and-a-subdomain" title="Permalink to this headline">¶</a></h5>
<p>Purchase and register a domain name with a domain registrar. You can purchase and register a domain name from any domain registrar, including GoDaddy, Yahoo! Domains, 1&amp;1, Netregistry, or Register.com. For instructions, see the Help on the registrar’s website.</p>
<p>Create a subdomain for your domain for your ID Site. See the Help on the registrar’s website for instructions on adding a subdomain. You can call the subdomain “id”, “login” or something similar. Example: &#8220;id.galacticgear.com&#8221;.</p>
</div>
<div class="section" id="make-the-subdomain-an-alias-of-your-id-site-on-stormpath">
<h5>2. Make the Subdomain an Alias of your ID Site on Stormpath<a class="headerlink" href="#make-the-subdomain-an-alias-of-your-id-site-on-stormpath" title="Permalink to this headline">¶</a></h5>
<p>The next step is to make your subdomain an alias of your ID Site on Stormpath. An alias is simply an alternate address for a website. For example, you can make the addresses “id.galacticgear.com” and “happy-rebel.id.stormpath.io” interchangeable as far as web browsers are concerned.</p>
<p>To make your subdomain an alias of your ID Site website on Stormpath, you must use your domain registrar’s tools and UI. These steps will generally require you to:</p>
<ul class="simple">
<li>Log in to your domain registrar’s control panel.</li>
<li>Look for the option to change DNS records.</li>
<li>Locate or create the CNAME records for your domain.</li>
<li>Point the CNAME record from your subdomain (ex. “id” or “login”) to your ID Site subdomain (ex. happy-rebel.id.stormpath.io)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It takes time for changes to the DNS system to be implemented. Typically, it can take anywhere from a few hours to a day, depending on your Time To Live (TTL) settings in the registrar’s control panel.</p>
</div>
</div>
<div class="section" id="enable-the-custom-domain-in-stormpath-s-id-site-configuration">
<h5>3. Enable the Custom Domain in Stormpath&#8217;s ID Site Configuration<a class="headerlink" href="#enable-the-custom-domain-in-stormpath-s-id-site-configuration" title="Permalink to this headline">¶</a></h5>
<p>After making your subdomain an alias of your ID Site on Stormpath, you must enable a custom domain in the Stormpath Admin Console. If you omit this step, your subdomain will point to a error page rather than your ID Site.</p>
<p>To set up a custom domain on ID Site, log into the Administrator Console and:</p>
<ul class="simple">
<li>Click on the &#8220;ID Site&#8221; Tab</li>
<li>Click the &#8220;Custom&#8221; option under &#8220;Domain Name&#8221;.</li>
<li>Type in the subdomain for your ID Site (ex: id.galacticgear.com)</li>
<li>Click the &#8220;Update&#8221; button at the bottom of the page</li>
</ul>
</div>
<div class="section" id="set-up-ssl-on-your-id-site">
<h5>4. Set up SSL on your ID Site<a class="headerlink" href="#set-up-ssl-on-your-id-site" title="Permalink to this headline">¶</a></h5>
<p>Since Stormpath is hosting the ID Site under your custom subdomain, to secure it using SSL you must provide the SSL certificate information to Stormpath. Creating SSL certificates is an involved task which requires working with a certificate authority such as Verisign and includes:</p>
<ul class="simple">
<li>Generating a certificate request (CSR) with a Distinguished Name (DN) that matches your subdomain (ex. id.galacticgear.com)</li>
<li>Provide the CSR file to a certificate authority such as Verisign. The certificate authority generates a SSL certificate and gives it to you so that it can be installed on Stormpath’s servers.</li>
</ul>
<p>Once the SSL certificate is retrieved from the certificate authority, you can log-in to the Administrator Console and configure SSL:</p>
<ul class="simple">
<li>Click on the ID Site Tab</li>
<li>Open the zip to retrieve your .pem file if needed.</li>
<li>Copy the text for the SSL certificate and Private Key to the appropriate text boxes on the ID Site Tab</li>
<li>Click the Update button at the bottom of the page</li>
<li>When the ID Site is updated, the SSL information is uploaded to Stormpath and will update your ID Site automatically.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="setting-up-your-application-to-use-id-site">
<span id="idsite-app-set-up"></span><h3>Setting up your Application to use ID Site<a class="headerlink" href="#setting-up-your-application-to-use-id-site" title="Permalink to this headline">¶</a></h3>
<p>In order to set up your application to use ID Site, you will need to install the Stormpath SDK and register the application in Stormpath. The Stormpath SDK and hosted ID Site will do most of the work for your application, including signing and unpacking secure communication between themselves. For more information, please see the <a class="reference external" href="https://docs.stormpath.com/home/">relevant Stormpath SDK documentation</a>.</p>
</div>
</div>
<div class="section" id="using-id-site-via-rest-api">
<span id="idsite-with-rest"></span><h2>8.4. Using ID Site Via REST API<a class="headerlink" href="#using-id-site-via-rest-api" title="Permalink to this headline">¶</a></h2>
<p>The Stormpath SDKs help developers quickly integrate communication from Stormpath&#8217;s ID Site to their application. However, it is possible to use ID Site without an Stormpath SDK using the REST API.</p>
<p>To use ID Site without an Stormpath SDK there are two flows that need to be implemented:</p>
<ol class="arabic simple">
<li>Getting a user to ID Site</li>
<li>Handling the Callback to your Application from ID Site</li>
</ol>
<p>So, let&#8217;s show you how to do exactly that!</p>
<div class="section" id="step-1-getting-a-user-to-id-site">
<span id="idsite-direct-user"></span><h3>Step 1: Getting a User to ID Site<a class="headerlink" href="#step-1-getting-a-user-to-id-site" title="Permalink to this headline">¶</a></h3>
<p>When a user wants to log into, or register for, your application, you will need to redirect them to your ID Site.</p>
<p>A typical set of steps in your application are as follows:</p>
<ol class="arabic simple">
<li>You render your application with a login button</li>
<li>The user clicks the login button which will send a request to your server</li>
<li>Your server will generate a JWT and include the valid information</li>
<li>Your server responds with an HTTP 302 which redirects the user to the ID Site SSO endpoint</li>
<li>Stormpath will redirect the user to your ID Site</li>
</ol>
<div class="section" id="idsite-auth-jwt">
<span id="id-site-authentication-jwt"></span><h4>ID Site Authentication JWT<a class="headerlink" href="#idsite-auth-jwt" title="Permalink to this headline">¶</a></h4>
<p>First you will have to generate a JWT. Below are language specific JWT libraries that Stormpath has sanity tested with ID Site.</p>
<ul class="simple">
<li>.NET JWT - <a class="reference external" href="https://github.com/jwt-dotnet/jwt">https://github.com/jwt-dotnet/jwt</a></li>
<li>Ruby JWT - <a class="reference external" href="https://github.com/jwt/ruby-jwt">https://github.com/jwt/ruby-jwt</a></li>
<li>Go JWT - <a class="reference external" href="https://github.com/dgrijalva/jwt-go">https://github.com/dgrijalva/jwt-go</a></li>
<li>PHP JWT - <a class="reference external" href="https://github.com/firebase/php-jwt">https://github.com/firebase/php-jwt</a></li>
<li>Python JWT - <a class="reference external" href="https://github.com/jpadilla/pyjwt">https://github.com/jpadilla/pyjwt</a></li>
<li>Java JWT - <a class="reference external" href="https://github.com/jwtk/jjwt">https://github.com/jwtk/jjwt</a></li>
<li>Node JWT - <a class="reference external" href="https://github.com/jwtk/njwt">https://github.com/jwtk/njwt</a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This key must be signed with your API Key Secret.</p>
</div>
<p>The token itself will contain two parts, a Header and a Body that itself contains claims. You will have to add all of these into the JWT that you generate:</p>
<p><strong>Header</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Header Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">kid</span></code></td>
<td>Yes</td>
<td>Your Stormpath API Key ID.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">alg</span></code></td>
<td>Yes</td>
<td>The algorithm that was used to sign this key. The only valid value is <code class="docutils literal"><span class="pre">HS256</span></code>.</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<p>The <a class="reference external" href="https://tools.ietf.org/html/rfc7519#section-4.1">claims</a> for the JWT body are as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iat</span></code></td>
<td>Yes</td>
<td>The &#8220;Issued At Time&#8221;, which is the time the token was issued, expressed in Unix time.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">iss</span></code></td>
<td>Yes</td>
<td>The issuer of the token. You should put your Stormpath API Key ID here.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">sub</span></code></td>
<td>Yes</td>
<td>The subject of the token. You should put your Stormpath Application resource&#8217;s href here.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">cb_uri</span></code></td>
<td>Yes</td>
<td>The callback URI to use once the user takes an action on the ID Site. This must match a Authorized Callback URI on Application resource.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">jti</span></code></td>
<td>Yes</td>
<td>A universally unique identifier for the token. This can be generated using a GUID or UUID function of your choice.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">path</span></code></td>
<td>No</td>
<td>The path on the ID Site that you want the user to land on. Use <code class="docutils literal"><span class="pre">/</span></code> for login page, <code class="docutils literal"><span class="pre">/#/register</span></code> for the sign up page, <code class="docutils literal"><span class="pre">/#/forgot</span></code> for the forgot password page, <code class="docutils literal"><span class="pre">/#/reset</span></code> for the password reset page.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>No</td>
<td>The state of the application that you need to pass through ID Site back to your application through the callback. It is up to the developer to serialize/deserialize this value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">organizationNameKey</span></code></td>
<td>No</td>
<td>The string representing the <code class="docutils literal"><span class="pre">nameKey</span></code> for an Organization that is an Account Store for your application. This is used for multitenant applications that use ID Site.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">showOrganizationField</span></code></td>
<td>No</td>
<td>A boolean representing if the &#8220;Organization&#8221; field should show on the forms that ID Site renders.</td>
</tr>
</tbody>
</table>
<p>Once the JWT is generated by your server, you must respond with or send the browser to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>HTTP/1.1 302 Found
Location: https://api.stormpath.com/sso?jwtRequest=$GENERATED_JWT
</pre></div>
</div>
<p>The Stormpath <code class="docutils literal"><span class="pre">/sso</span></code> endpoint will validate the JWT, and redirect the user to your ID Site.</p>
</div>
</div>
<div class="section" id="step-2-handling-the-callback-to-your-application-from-id-site">
<h3>Step 2: Handling the Callback to your Application from ID Site<a class="headerlink" href="#step-2-handling-the-callback-to-your-application-from-id-site" title="Permalink to this headline">¶</a></h3>
<p>Once the user signs up or logs in to your application, they will be redirected back to your application using the <code class="docutils literal"><span class="pre">cb_uri</span></code> callback property that was set in the JWT. In addition to the callback URI, ID Site will include a <code class="docutils literal"><span class="pre">jwtResponse</span></code> parameter in the query. For example, if the specified <code class="docutils literal"><span class="pre">cb_uri</span></code> is <code class="docutils literal"><span class="pre">https://yourapp.com/dashboard</span></code> then the user will be redirected to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>https://yourapp.com/dashboard?jwtResponse={GENERATED_ID_SITE_ASSERTION_JWT}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">jwtResponse</span></code> represents a JWT that provides a signed security assertion about who the user is and what they did on ID Site.</p>
<div class="section" id="id-site-assertion-jwt">
<h4>ID Site Assertion JWT<a class="headerlink" href="#id-site-assertion-jwt" title="Permalink to this headline">¶</a></h4>
<p>Before you trust any of the information in the JWT, you MUST:</p>
<ul class="simple">
<li>Validate the signature with your API Key Secret from Stormpath. This will prove that the information stored in the JWT has not been tampered with during transit.</li>
<li>Validate that the JWT has not expired</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are using a library to generate a JWT, these usually have methods to help you validate the JWT. Some libraries will only validate the signature, but not the expiration time. Please review your JWT library to verify its capabilities.</p>
</div>
<p>The Header and Body claims found in this JWT are as follows:</p>
<p><strong>Header</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Required?</th>
<th class="head">Valid Value(s)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">typ</span></code></td>
<td>Yes</td>
<td>The type of token, which will be <code class="docutils literal"><span class="pre">JWT</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">alg</span></code></td>
<td>Yes</td>
<td>The algorithm that was used to sign this key. The only possible value is <code class="docutils literal"><span class="pre">HS256</span></code>.</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<p>Once the user has been authenticated by ID Site or the SAML IdP, you will receive back a JWT response. The JWT contains the following information:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Claim Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iss</span></code></td>
<td>This will match your ID Site domain and can be used for additional validation of the JWT.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">sub</span></code></td>
<td>The subject of the JWT. This will be an <code class="docutils literal"><span class="pre">href</span></code> for the Stormpath Account that signed up or logged into the ID Site / SAML IdP. This <code class="docutils literal"><span class="pre">href</span></code> can be queried by using the REST API to get more information about the Account.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">aud</span></code></td>
<td>The audience of the JWT. This will match your API Key ID from Stormpath.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">exp</span></code></td>
<td>The expiration time for the JWT in Unix time.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iat</span></code></td>
<td>The time at which the JWT was created, in Unix time.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">jti</span></code></td>
<td>A one-time-use-token for the JWT. If you require additional security around the validation of the token, you can store the <code class="docutils literal"><span class="pre">jti</span></code> in your application to validate that a particular JWT has only been used once.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>The state of your application, if you have chosen to have this passed back.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">status</span></code></td>
<td>The status of the request. Valid values for ID Site are <code class="docutils literal"><span class="pre">AUTHENTICATED</span></code>, <code class="docutils literal"><span class="pre">LOGOUT</span></code>, or <code class="docutils literal"><span class="pre">REGISTERED</span></code>.</td>
</tr>
</tbody>
</table>
<p>Once the JWT is validated, you can read information about the user from the JWT. In some cases you may wish to exchange this JWT for a Stormpath OAuth 2.0 token.</p>
</div>
<div class="section" id="exchanging-the-id-site-jwt-for-an-oauth-token">
<span id="idsite-jwt-to-oauth"></span><h4>Exchanging the ID Site JWT for an OAuth Token<a class="headerlink" href="#exchanging-the-id-site-jwt-for-an-oauth-token" title="Permalink to this headline">¶</a></h4>
<p>For background information, please see <a class="reference internal" href="auth_n.html#token-authn"><span>5.2. How Token-Based Authentication Works</span></a>. In this situation, after the user has been authenticated via ID Site, a developer may want to control their authorization with an OAuth 2.0 Token. This is done by passing the JWT similar to the way we passed the user&#8217;s credentials as described in <a class="reference internal" href="auth_n.html#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>. The difference is that instead of using the <code class="docutils literal"><span class="pre">password</span></code> grant type and passing credentials, we will use the <code class="docutils literal"><span class="pre">id_site_token</span></code> type and pass the JWT we got from the ID Site.</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/applications/$YOUR_APPLICATION_ID/oauth/token</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/x-www-form-urlencoded</span>

grant_type=id_site_token&amp;token={$JWT_FROM_ID_SITE}
</pre></div>
</div>
<p>Stormpath will validate the JWT (i.e. ensure that it has not been tampered with, is not expired, and the Account that its associated with is still valid) and then return an OAuth 2.0 Access Token:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJraWQiOiIyWkZNV...TvUt2WBOl3k&quot;</span><span class="p">,</span>
  <span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJraWQiOiIyWkZNV...8TvvrB7cBEmNF_g&quot;</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>
  <span class="nt">&quot;stormpath_access_token_href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accessTokens/1vHI0jBXDrmmvPqEXaMPle&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about Stormpath&#8217;s OAuth 2.0 tokens, please see <a class="reference internal" href="auth_n.html#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
</div>
</div>
<div class="section" id="step-3-optional-logging-out-of-id-site-with-rest">
<h3>Step 3: (Optional) Logging Out of ID Site with REST<a class="headerlink" href="#step-3-optional-logging-out-of-id-site-with-rest" title="Permalink to this headline">¶</a></h3>
<p>ID Site will keep a configurable session for authenticated users. When a user is sent from your application to ID Site, it will confirm that the session is still valid for the user. If it is, they will be automatically redirected to the <code class="docutils literal"><span class="pre">cb_uri</span></code>. This <code class="docutils literal"><span class="pre">cb_uri</span></code> can be the originating application or any application supported by a Stormpath SDK.</p>
<p>To log the user out and remove the session that ID Site creates, you must create a JWT similar to the one that got the user to ID Site, but instead of redirecting to the <code class="docutils literal"><span class="pre">/sso</span></code> endpoint, you redirect the user to <code class="docutils literal"><span class="pre">/sso/logout</span></code>.</p>
<p>So, once the JWT is generated by your server, you must respond with or send the browser to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>HTTP/1.1 302 Found
Location: https://api.stormpath.com/sso/logout?jwtRequest=%GENERATED_JWT%
</pre></div>
</div>
<p>Once the user is logged out of ID Site, they are automatically redirected to the <code class="docutils literal"><span class="pre">cb_uri</span></code> which was specified in the JWT. Your application will know that the user logged out because the <code class="docutils literal"><span class="pre">jwtResponse</span></code> will contain a status claim of <code class="docutils literal"><span class="pre">LOGOUT</span></code>.</p>
</div>
<div class="section" id="resetting-your-password-with-id-site">
<span id="idsite-password-reset"></span><h3>Resetting Your Password with ID Site<a class="headerlink" href="#resetting-your-password-with-id-site" title="Permalink to this headline">¶</a></h3>
<p>The Account Management chapter has an overview of <a class="reference internal" href="accnt_mgmt.html#password-reset-flow"><span>4.4.3. Password Reset</span></a> in Stormpath. In that flow, a user chooses to reset their password, then receives an email with a link to a page on your application that allows them to set a new password. If you are using ID Site for login, then it stands to reason that you would want them to land on your ID Site for password reset as well. The issue here, however, is bridging the Password Reset Flow and the ID Site flow.</p>
<p>Using a JWT library, you have to generate a new JWT, with all of <a class="reference internal" href="#idsite-auth-jwt"><span>the usual required claims</span></a>. The <code class="docutils literal"><span class="pre">path</span></code> claim should be set to <code class="docutils literal"><span class="pre">/#/reset</span></code> and you will also have to include an additional claim: <code class="docutils literal"><span class="pre">sp_token</span></code>. This is the <code class="docutils literal"><span class="pre">sp_token</span></code> value that you will have received from the link that the user clicked in their password reset email. This JWT is then passed to the <code class="docutils literal"><span class="pre">/sso</span></code> endpoint (as described in Step 1 above), and the user is taken to the Password Reset page on your ID Site.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="REST API Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multitenancy.html" class="btn btn-neutral" title="7. Multi-Tenancy with Stormpath" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'V1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/javascript_for_java.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>