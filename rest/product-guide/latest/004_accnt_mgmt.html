

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Account Management &mdash; Stormpath REST API V1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="top" title="Stormpath REST API V1 documentation" href="index.html"/>
        <link rel="next" title="5. Authenticating Accounts with Stormpath" href="005_auth_n.html"/>
        <link rel="prev" title="3. Quickstart" href="003_quickstart.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Stormpath REST API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="001_about.html">1. About Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="001_about.html#what-is-stormpath">What is Stormpath?</a></li>
<li class="toctree-l2"><a class="reference internal" href="001_about.html#the-stormpath-data-model">The Stormpath Data Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="002_setup.html">2. First-Time Set-Up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="002_setup.html#a-sign-up-for-stormpath">a. Sign-up for Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="002_setup.html#b-create-an-api-key-pair">b. Create an API Key Pair</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="003_quickstart.html">3. Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#a-retrieve-your-application">a. Retrieve Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#b-create-a-user-account">b. Create a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#c-authenticate-a-user-account">c. Authenticate a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#d-next-steps">d. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">4. Account Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-modeling-your-user-base">a. Modeling Your User Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-how-to-store-accounts-in-stormpath">b. How to Store Accounts in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c-how-to-search-accounts">c. How to Search Accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#d-how-to-manage-an-account-s-password">d. How to Manage an Account&#8217;s Password</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-how-to-verify-an-account-s-email">e. How to Verify an Account&#8217;s Email</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-customizing-stormpath-emails-via-rest">f. Customizing Stormpath Emails via REST</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="005_auth_n.html">5. Authenticating Accounts with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#a-how-password-authentication-works-in-stormpath">a. How Password Authentication Works in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#b-how-token-based-authentication-works">b. How Token-Based Authentication Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#c-how-social-authentication-works">c. How Social Authentication Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#d-authenticating-against-a-mirrored-ldap-directory">d. Authenticating Against a Mirrored LDAP Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#e-authenticating-against-a-saml-directory">e. Authenticating Against a SAML Directory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="006_auth_z.html">6. Authorization With Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="006_auth_z.html#a-what-is-authorization">a. What is Authorization?</a></li>
<li class="toctree-l2"><a class="reference internal" href="006_auth_z.html#b-modeling-authorization-in-stormpath">b. Modeling Authorization in Stormpath</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="007_multitenancy.html">7. Multi-Tenancy with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="007_multitenancy.html#a-what-is-a-multi-tenant-application">a. What Is a Multi-Tenant Application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="007_multitenancy.html#b-modeling-tenants-in-stormpath">b. Modeling Tenants in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="007_multitenancy.html#c-authenticating-an-account-against-an-organization">c. Authenticating an Account against an Organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="008_idsite.html">8. Using ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#a-what-is-an-id-site">a. What is an ID Site?</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#b-how-does-id-site-work">b. How does ID Site Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#c-id-site-set-up">c. ID Site Set Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#d-using-id-site-via-rest-api">d. Using ID Site Via REST API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">REST API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference.html#rest-api-core-concepts">REST API Core Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#tenant">Tenant</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#application">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account-store-mapping">Account Store Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#directory">Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group">Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group-membership">Group Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#organization">Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account">Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#custom-data">Custom Data</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Stormpath REST API</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>4. Account Management</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/004_accnt_mgmt.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="account-management">
<span id="account-mgmt"></span><h1>4. Account Management<a class="headerlink" href="#account-management" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-modeling-your-user-base">
<h2>a. Modeling Your User Base<a class="headerlink" href="#a-modeling-your-user-base" title="Permalink to this headline">¶</a></h2>
<p>The first question that we need to address is how we are going to model our users inside Stormpath. User Accounts in Stormpath aren&#8217;t directly associated with Applications, but only indirectly via <strong>Directories</strong> and also possibly <strong>Groups</strong>.</p>
<p>All of your Accounts will have to be associated with at least one Directory resource, so we can start there.</p>
<div class="section" id="i-directories">
<span id="directory-mgmt"></span><h3>i. Directories<a class="headerlink" href="#i-directories" title="Permalink to this headline">¶</a></h3>
<p>The <strong>Directory</strong> resource is a top-level container for Account and Group resources. A Directory also manages security policies (like password strength) for the Accounts it contains. Directories can be used to cleanly manage segmented user Account populations. For example, you might use one Directory for company employees and another Directory for customers, each with its own security policies.</p>
<p>For more detailed information about the Directory resource, please see the <a class="reference internal" href="reference.html#ref-directory"><span>Directory</span></a> section in the Reference chapter.</p>
<div class="section" id="types-of-directories">
<h4>Types of Directories<a class="headerlink" href="#types-of-directories" title="Permalink to this headline">¶</a></h4>
<p>Stormpath supports three types of Directories:</p>
<ol class="arabic simple">
<li>Natively-hosted Cloud Directories that originate in Stormpath</li>
<li>Mirror Directories that act as secure replicas of existing LDAP user directories outside of Stormpath, for example those on Active Directory servers.</li>
<li>Social Directories that pull in account information from four sites that support social login: Google, Facebook, Github and LinkedIn.</li>
</ol>
<p>You can add as many Directories of each type as you require.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Multiple Directories are a more advanced feature of Stormpath. If you have one or more applications that all access the same Accounts, you usually only need a single Directory, and you do not need to be concerned with creating or managing multiple Directories.</p>
<p class="last">If however, your application(s) needs to support login for external third-party accounts like those in Active Directory, or you have more complex account segmentation needs, Directories will be a powerful tool to manage your application&#8217;s user base.</p>
</div>
</div>
<div class="section" id="cloud-directories">
<span id="about-cloud-dir"></span><h4>Cloud Directories<a class="headerlink" href="#cloud-directories" title="Permalink to this headline">¶</a></h4>
<p>The standard, default Directory resource. They can be created using a simple POST API.</p>
<div class="section" id="how-to-make-a-cloud-directory">
<h5>How to Make a Cloud Directory<a class="headerlink" href="#how-to-make-a-cloud-directory" title="Permalink to this headline">¶</a></h5>
<p>The following API request:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/directories</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Captains&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;Captains from a variety of stories&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Would yield the following response:</p>
<div class="highlight-HTTP"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Captains&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Captains from a variety of stories&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-24T15:32:23.079Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-24T15:32:23.079Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/tenants/1gBTncWsp2ObQGeXampLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;provider&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE/provider&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span><span class="p">,</span>
  <span class="nt">&quot;groups&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE/groups&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mirror-directories">
<span id="about-mirror-dir"></span><h4>Mirror Directories<a class="headerlink" href="#mirror-directories" title="Permalink to this headline">¶</a></h4>
<p>Mirror Directories are a big benefit to Stormpath customers who need LDAP directory accounts to be able to securely log in to public web applications without breaking corporate firewall policies. Here is how they work:</p>
<ul class="simple">
<li>After creating an LDAP Directory in Stormpath, you download a Stormpath Agent. This is a simple standalone software application that you install behind the corporate firewall so it can communicate directly with the LDAP server.</li>
<li>You configure the agent via LDAP filters to view only the accounts that you want to expose to your Stormpath-enabled applications.</li>
<li>The Agent will start synchronizing immediately, pushing this select data outbound to Stormpath over a TLS (HTTPS) connection.</li>
<li>The synchronized user Accounts and Groups appear in the Stormpath Directory. The Accounts will be able to log in to any Stormpath-enabled application that you assign.</li>
<li>When the Agent detects local LDAP changes, additions or deletions to these specific Accounts or Groups, it will automatically propagate those changes to Stormpath to be reflected by your Stormpath-enabled applications.</li>
</ul>
<p>User Accounts and Groups in mirrored directories are automatically deleted when any of the following things happen:</p>
<ul class="simple">
<li>The original object is deleted from the LDAP directory service.</li>
<li>The original LDAP object information no longer matches the account filter criteria configured for the agent.</li>
<li>The LDAP directory is deleted.</li>
</ul>
<p>The big benefit is that your Stormpath-enabled applications still use the same convenient REST+JSON API – they do not need to know anything about things like LDAP or legacy connection protocols.</p>
<div class="section" id="modeling-mirror-directories">
<span id="modeling-mirror-dirs"></span><h5>Modeling Mirror Directories<a class="headerlink" href="#modeling-mirror-directories" title="Permalink to this headline">¶</a></h5>
<p>If you Application is going to have an LDAP integration, it will need to support multiple Directories — one Mirror Directory for each LDAP integration.</p>
<p>In this scenario, we recommend linking each Account in a LDAP Mirror Directory with a master Account in a master Directory. This offers a few benefits:</p>
<ol class="arabic simple">
<li>You can maintain one Directory that has all your user Accounts, retaining globally unique canonical identities across your application</li>
<li>You are able to leverage your own Groups in the master Directory. Remember, most data in a Mirror Directory is read-only, meaning you cannot create your own Groups in it, only read the Groups synchronized from Active Directory and LDAP</li>
<li>Keep a user’s identity alive even after they&#8217;ve left your customer&#8217;s organization and been deprovisioned in AD/LDAP. This is valuable in a SaaS model where the user is loosely coupled to an organization. Contractors and temporary workers are good examples</li>
</ol>
<p>The Stormpath Agent (see <a class="reference internal" href="reference.html#ref-ldap-agent"><span>LDAP Agent</span></a>) is regularly updating its Mirror Directory and sometimes adding new user Accounts. Because this data can be quite fluid, we recommend initiating all provisioning, linking, and synchronization on a successful login attempt of the Account in the Mirror Directory. This means that the master Directory would start off empty, and would then gradually become populated every time a user logged in.</p>
<p>For more information on how to this works, please see <a class="reference internal" href="005_auth_n.html#mirror-dir-authn"><span>d. Authenticating Against a Mirrored LDAP Directory</span></a>.</p>
</div>
<div class="section" id="how-to-make-a-mirror-directory">
<span id="make-mirror-dir"></span><h5>How to Make a Mirror Directory<a class="headerlink" href="#how-to-make-a-mirror-directory" title="Permalink to this headline">¶</a></h5>
<p>Presently, Mirror Directories can be made via the Stormpath Admin Console, or using the REST API. If you&#8217;d like to do it with the Admin Console, please see <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#create-a-directory">the Directory Creation section of the Admin Console Guide</a>. For more information about creating them using REST API, please see <a class="reference internal" href="005_auth_n.html#mirror-dir-authn"><span>d. Authenticating Against a Mirrored LDAP Directory</span></a>.</p>
</div>
</div>
<div class="section" id="social-directories">
<span id="about-social-dir"></span><h4>Social Directories<a class="headerlink" href="#social-directories" title="Permalink to this headline">¶</a></h4>
<p>Stormpath works with user Accounts pulled from social login providers (currently Google, Facebook, Github, and LinkedIn) in a way very similar to the way it works with user Accounts from LDAP servers. These external Identity Providers (IdPs) are modeled as Stormpath Directories, much like Mirror Directories. The difference is that, while Mirror Directories always come with an Agent that takes care of synchronization, Social Directories have an associated <strong>Provider</strong> resource. This resource contains the information required by the social login site to work with their site (e.g. the App ID for your Google application or the App Secret).</p>
<p>Stormpath also simplifies the authorization process by doing things like automating Google&#8217;s access token exchange flow. All you do is POST the authorization code from the end-user and Stormpath returns a new or updated user Account, along with the Google access token which you can use for any further API calls.</p>
<div class="section" id="modeling-social-directories">
<h5>Modeling Social Directories<a class="headerlink" href="#modeling-social-directories" title="Permalink to this headline">¶</a></h5>
<p>Modeling your users who authorize via Social Login could be accomplished by creating a Directory resource for each social provider that you want to support, along with one master Directory for your application. For more about how these Directories are provisioned, please see <a class="reference internal" href="005_auth_n.html#non-cloud-login"><span>How Login Works with Mirrored and Social Directories</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For both Mirror and Social Directories, since the relationship with the outside directory is read-only, the remote directory is still the &#8220;system of record&#8221;.</p>
</div>
</div>
<div class="section" id="how-to-make-a-social-directory">
<h5>How to Make a Social Directory<a class="headerlink" href="#how-to-make-a-social-directory" title="Permalink to this headline">¶</a></h5>
<p>Presently, Social Directories can be made via the Stormpath Admin Console or using REST API. For more information about creating them with the Admin Console please see the <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#create-a-directory">Directories section of the Stormpath Admin Console Guide</a>. For more information about creating them using REST API, please see <a class="reference internal" href="005_auth_n.html#social-authn"><span>c. How Social Authentication Works</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="ii-groups">
<span id="group-mgmt"></span><h3>ii. Groups<a class="headerlink" href="#ii-groups" title="Permalink to this headline">¶</a></h3>
<p>The Group resource can either be imagined as a container for Accounts, or as a label applied to them. Groups can be used in a variety of ways, including organizing people by geographic location, or by their role within a company.</p>
<p>For more detailed information about the Group resource, please see the <a class="reference internal" href="reference.html#ref-group"><span>Group</span></a> section of the Reference chapter.</p>
<div class="section" id="modeling-user-hierarchies-using-groups">
<span id="hierarchy-groups"></span><h4>Modeling User Hierarchies Using Groups<a class="headerlink" href="#modeling-user-hierarchies-using-groups" title="Permalink to this headline">¶</a></h4>
<p>Groups, like labels, are inherently &#8220;flat&#8221;. This means that they do not by default include any kind of hierarchy. If a hierarchical or nested structure is desired, it can be simulated in one of two ways: Either, using the Group resource&#8217;s <code class="docutils literal"><span class="pre">description</span></code> field, or with the Group&#8217;s associated customData resource.</p>
<p>A geographical region can, for example, be represented as <code class="docutils literal"><span class="pre">&quot;North</span> <span class="pre">America/US/US</span> <span class="pre">East&quot;</span></code> in the Group&#8217;s <code class="docutils literal"><span class="pre">description</span></code> field, allowing for queries to be made using simple pattern-matching queries. So to find all Groups in the US, you&#8217;d make the following HTTP GET:</p>
<div class="highlight-python"><div class="highlight"><pre>https://api.stormpath.com/v1/directories/$DIR_ID/groups?description=US*
</pre></div>
</div>
<p>Or, to find all Groups in the US East region only, you would GET:</p>
<div class="highlight-python"><div class="highlight"><pre>https://api.stormpath.com/v1/directories/$DIR_ID/groups?description=US%20East*
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URL encoding will change a space into &#8220;%20&#8221;.</p>
</div>
<p>It can also be included in the customData resource, as a series of key-value relations. The downside to this second approach is that customData resources are not currently searchable in the same manner as the Group&#8217;s <code class="docutils literal"><span class="pre">description</span></code> field is.</p>
</div>
<div class="section" id="how-to-create-a-group">
<h4>How to Create a Group<a class="headerlink" href="#how-to-create-a-group" title="Permalink to this headline">¶</a></h4>
<p>So let&#8217;s say we want to add a new Group resource with the name &#8220;Starfleet Officers&#8221; to the &#8220;Captains&#8221; Directory.</p>
<p>The following API request:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/directories/2SKhstu8PlaekcaEXampLE/groups</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;Starfleet Officers&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;Commissioned officers in Starfleet&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;enabled&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Would yield this response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Starfleet Officers&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;Commissioned officers in Starfleet&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-08-25T20:09:23.698Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span><span class="s2">&quot;2015-08-25T20:09:23.698Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;customData&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe/customData&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;directory&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/tenants/1gBTncWsp2ObQGeXampLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accounts&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe/accounts&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountMemberships&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe/accountMemberships&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;applications&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe/applications&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="b-how-to-store-accounts-in-stormpath">
<span id="account-creation"></span><h2>b. How to Store Accounts in Stormpath<a class="headerlink" href="#b-how-to-store-accounts-in-stormpath" title="Permalink to this headline">¶</a></h2>
<p>The Account resource is a unique identity within your application. It is usually used to model an end-user, although it can also be used by a service, process, or any other entity that needs to log-in to Stormpath.</p>
<p>For more detailed information about the Account resource, see the <a class="reference internal" href="reference.html#ref-account"><span>Account</span></a> section of the Reference chapter.</p>
<div class="section" id="new-account-creation">
<h3>New Account Creation<a class="headerlink" href="#new-account-creation" title="Permalink to this headline">¶</a></h3>
<p>The basic steps for creating a new Account are covered in the <a class="reference internal" href="003_quickstart.html#quickstart"><span>Quickstart</span></a> chapter. In that example, we show how to add an Account to an Application. Below, we will also show how to add an Account to a specific Directory or Group.</p>
<div class="section" id="add-a-new-account-to-a-directory">
<span id="add-new-account"></span><h4>Add a New Account to a Directory<a class="headerlink" href="#add-a-new-account-to-a-directory" title="Permalink to this headline">¶</a></h4>
<p>Because Accounts are &#8220;owned&#8221; by Directories, you create new Accounts by adding them to a Directory. You can add an Account to a Directory directly, or you can add it indirectly by registering an Account with an Application, like in the <a class="reference internal" href="003_quickstart.html"><em>Quickstart</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section will show examples using a Directory&#8217;s <code class="docutils literal"><span class="pre">/accounts</span></code> href, but they will also function the same if you use an Application’s <code class="docutils literal"><span class="pre">/accounts</span></code> href instead.</p>
</div>
<p>Let&#8217;s say we want to add a new account for user &#8220;Jean-Luc Picard&#8221; to the &#8220;Captains&#8221; Directory, which has the <code class="docutils literal"><span class="pre">directoryId</span></code> value <code class="docutils literal"><span class="pre">2SKhstu8PlaekcaEXampLE</span></code>. The following API request:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/directories/2SKhstu8PlaekcaEXampLE/accounts</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;username&quot;</span> <span class="p">:</span> <span class="s2">&quot;jlpicard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span> <span class="p">:</span> <span class="s2">&quot;capt@enterprise.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;givenName&quot;</span> <span class="p">:</span> <span class="s2">&quot;Jean-Luc&quot;</span><span class="p">,</span>
  <span class="nt">&quot;surname&quot;</span> <span class="p">:</span> <span class="s2">&quot;Picard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;password&quot;</span> <span class="p">:</span> <span class="s2">&quot;uGhd%a8Kl!&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The password in the request is being sent to Stormpath as plain text. This is one of the reasons why Stormpath only allows requests via HTTPS. Stormpath implements the latest password hashing and cryptographic best-practices that are automatically upgraded over time so the developer does not have to worry about this. Stormpath can only do this for the developer if we receive the password as plaintext, and only hash it using these techniques.</p>
<p>Plaintext passwords also allow Stormpath to enforce password restrictions in a configurable manner.</p>
<p>Most importantly, Stormpath never persists or relays plaintext passwords under any circumstances.</p>
<p class="last">On the client side, then, you do not need to worry about salting or storing passwords at any point; you need only pass them to Stormpath for hashing, salting, and persisting with the appropriate HTTPS API call.</p>
</div>
<p>Would yield this response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe&quot;</span><span class="p">,</span>
  <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;jlpicard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;capt@enterprise.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Jean-Luc&quot;</span><span class="p">,</span>
  <span class="nt">&quot;middleName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Picard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fullName&quot;</span><span class="p">:</span> <span class="s2">&quot;Jean-Luc Picard&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-25T19:57:05.976Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-25T19:57:05.976Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;emailVerificationToken&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;customData&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe/customData&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;providerData&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe/providerData&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;comment&quot;</span><span class="p">:</span><span class="s2">&quot; // This JSON has been truncated for readability&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="add-an-existing-account-to-a-group">
<h4>Add an Existing Account to a Group<a class="headerlink" href="#add-an-existing-account-to-a-group" title="Permalink to this headline">¶</a></h4>
<p>So let&#8217;s say we want to add &#8220;Jean-Luc Picard&#8221; to the &#8220;Starfleet Officers&#8221; Group inside the &#8220;Captains&#8221; Directory.</p>
<p>We make the following request:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/groupMemberships</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;account&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe&quot;</span>
   <span class="p">},</span>
   <span class="nt">&quot;group&quot;</span> <span class="p">:</span> <span class="p">{</span>
       <span class="nt">&quot;href&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And get the following response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/groupMemberships/1ufdzvjTWThoqnHf0a9vQ0</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groupMemberships/1ufdzvjTWThoqnHf0a9vQ0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/1ORBsz2iCNpV8yJExAMpLe&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="importing-accounts">
<span id="id1"></span><h3>Importing Accounts<a class="headerlink" href="#importing-accounts" title="Permalink to this headline">¶</a></h3>
<p>Stormpath also makes it very easy to transfer your existing user directory into a Stormpath Directory using our API. Depending on how you store your passwords, you will use one of three approaches:</p>
<ol class="arabic simple">
<li><strong>Passwords in Plaintext:</strong> If you stored passwords in plaintext, you can use the Stormpath API to import them directly. Stormpath will create the Accounts and secure their passwords automatically (within our system). Make sure that your Stormpath Directory is configured to <em>not</em> send Account Verification emails before beginning import.</li>
<li><strong>Passwords With MCF Hash:</strong> If your password hashing algorithm follows a format Stormpath supports, you can use the API to import Accounts directly. Available formats and instructions are detailed <a class="reference internal" href="#importing-mcf"><span>below</span></a>.</li>
<li><strong>Passwords With Non-MCF Hash:</strong> If you hashed passwords in a format Stormpath does not support, you can still use the API to create the Accounts, but you will need to issue a password reset afterwards. Otherwise, your users won&#8217;t be able to use their passwords to login.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To import user accounts from an LDAP or Social Directory, please see <a class="reference internal" href="005_auth_n.html#non-cloud-login"><span>How Login Works with Mirrored and Social Directories</span></a>.</p>
</div>
<p>Due to the sheer number of database types and the variation between individual data models, the actual importing of users is not something that Stormpath handles at this time. What we recommend is that you write a script that is able to iterate through your database and grab the necessary information. Then the script uses our APIs to re-create the user base in the Stormpath database.</p>
<div class="section" id="importing-accounts-with-plaintext-passwords">
<h4>Importing Accounts with Plaintext Passwords<a class="headerlink" href="#importing-accounts-with-plaintext-passwords" title="Permalink to this headline">¶</a></h4>
<p>In this case, it is recommended that you suppress Account Verification emails. This can be done by simply adding a <code class="docutils literal"><span class="pre">registrationWorkflowEnabled=false</span></code> query parameter to the end of your API like so:</p>
<div class="highlight-python"><div class="highlight"><pre>https://api.stormpath.com/v1/directories/WpM9nyZ2TbaEzfbeXaMPLE/accounts?registrationWorkflowEnabled=false
</pre></div>
</div>
</div>
<div class="section" id="importing-accounts-with-mcf-hash-passwords">
<span id="importing-mcf"></span><h4>Importing Accounts with MCF Hash Passwords<a class="headerlink" href="#importing-accounts-with-mcf-hash-passwords" title="Permalink to this headline">¶</a></h4>
<p>If you are moving from an existing user repository to Stormpath, you may have existing password hashes that you want to reuse in order to provide a seamless upgrade path for your end users. Stormpath does not allow for Account creation with <em>any</em> password hash, the password hash must follow modular crypt format (MCF), which is a <code class="docutils literal"><span class="pre">$</span></code> delimited string.
This works as follows:</p>
<ol class="arabic simple">
<li>Create the Account specifying the password hash instead of a plain text password. Stormpath will use the password hash to authenticate the Account’s login attempt.</li>
<li>If the login attempt is successful, Stormpath will recreate the password hash using a secure HMAC algorithm.</li>
</ol>
<div class="section" id="supported-hashing-algorithms">
<h5>Supported Hashing Algorithms<a class="headerlink" href="#supported-hashing-algorithms" title="Permalink to this headline">¶</a></h5>
<p>Stormpath only supports password hashes that use the following algorithms:</p>
<ul class="simple">
<li><strong>bcrypt</strong>: These password hashes have the identifier <code class="docutils literal"><span class="pre">$2a$</span></code>, <code class="docutils literal"><span class="pre">$2b$</span></code>, <code class="docutils literal"><span class="pre">$2x$</span></code>, <code class="docutils literal"><span class="pre">$2a$</span></code></li>
<li><strong>stormpath2</strong>: A Stormpath-specific password hash format that can be generated with common password hash information, such as algorithm, iterations, salt, and the derived cryptographic hash. For more information see <a class="reference internal" href="#stormpath2-hash"><span>below</span></a>.</li>
</ul>
<p>Once you have a bcrypt or stormpath2 MCF password hash, you can create the Account in Stormpath with the password hash by POSTing the Account information to the Directory or Application <code class="docutils literal"><span class="pre">/accounts</span></code> endpoint and specifying <code class="docutils literal"><span class="pre">passwordFormat=mcf</span></code> as a query parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>https://api.stormpath.com/v1/directories/WpM9nyZ2TbaEzfbeXaMPLE/accounts?passwordFormat=mcf
</pre></div>
</div>
<div class="section" id="the-stormpath2-hashing-algorithm">
<span id="stormpath2-hash"></span><h6>The stormpath2 Hashing Algorithm<a class="headerlink" href="#the-stormpath2-hashing-algorithm" title="Permalink to this headline">¶</a></h6>
<p>stormpath2 has a format which allows you to derive an MCF hash that Stormpath can read to understand how to recreate the password hash to use during a login attempt. stormpath2 hash format is formatted as:</p>
<div class="highlight-python"><div class="highlight"><pre>$stormpath2$ALGORITHM_NAME$ITERATION_COUNT$BASE64_SALT$BASE64_PASSWORD_HASH
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
<th class="head">Valid Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ALGORITHM_NAME</span></code></td>
<td>The name of the hashing algorithm used to generate the <code class="docutils literal"><span class="pre">BASE64_PASSWORD_HASH</span></code>.</td>
<td><code class="docutils literal"><span class="pre">MD5</span></code>, <code class="docutils literal"><span class="pre">SHA-1</span></code>, <code class="docutils literal"><span class="pre">SHA-256</span></code>, <code class="docutils literal"><span class="pre">SHA-384</span></code>, <code class="docutils literal"><span class="pre">SHA-512</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ITERATION_COUNT</span></code></td>
<td>The number of iterations executed when generating the <code class="docutils literal"><span class="pre">BASE64_PASSWORD_HASH</span></code></td>
<td>Number &gt; 0</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">BASE64_SALT</span></code></td>
<td>The salt byte array used to salt the first hash iteration.</td>
<td>String (Base64). If your password hashes do you have salt, you can leave it out entirely.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">BASE64_PASSWORD_HASH</span></code></td>
<td>The computed hash byte array.</td>
<td>String (Base64)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="importing-accounts-with-non-mcf-hash-passwords">
<h4>Importing Accounts with Non-MCF Hash Passwords<a class="headerlink" href="#importing-accounts-with-non-mcf-hash-passwords" title="Permalink to this headline">¶</a></h4>
<p>In this case you will be using the API in the same way as usual, except with the Password Reset Workflow enabled. That is, you should set the Account&#8217;s password to a large randomly generated string, and then force the user through the password reset flow. For more information, please see the <a class="reference internal" href="#password-reset-flow"><span>Password Reset section below</span></a>.</p>
</div>
</div>
<div class="section" id="how-to-store-additional-user-information-as-custom-data">
<span id="add-user-customdata"></span><h3>How to Store Additional User Information as Custom Data<a class="headerlink" href="#how-to-store-additional-user-information-as-custom-data" title="Permalink to this headline">¶</a></h3>
<p>While Stormpath’s default Account attributes are useful to many applications, you might want to add your own custom data to a Stormpath Account. If you want, you can store all of your custom account information in Stormpath so you don’t have to maintain another separate database to store your specific account data.</p>
<p>One example of this could be if we wanted to add information to our &#8220;Jean-Luc Picard&#8221; Account that didn&#8217;t fit into any of the existing Account attributes.</p>
<p>For example, we could want to add information about this user&#8217;s current location, like the ship this Captain is currently assigned to. To do this, we specify the <code class="docutils literal"><span class="pre">accountId</span></code> and the <code class="docutils literal"><span class="pre">/customdata</span></code> endpoint.</p>
<p>So if we were to send following REST call:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/accounts/3apenYvL0Z9v9spExAMpLe/customData</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;currentAssignment&quot;</span><span class="p">:</span> <span class="s2">&quot;USS Enterprise (NCC-1701-E)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We would get this response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe/customData</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spExAMpLe/customData&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-25T19:57:05.976Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-26T19:25:27.936Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;currentAssignment&quot;</span><span class="p">:</span> <span class="s2">&quot;USS Enterprise (NCC-1701-E)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This information can also be appended as part of the initial Account creation payload.</p>
<p>For more information about the customData resource, please see the <a class="reference external" href="http://docs.stormpath.com/rest/product-guide/#custom-data">customData section</a> of the REST API Product Guide .</p>
</div>
</div>
<div class="section" id="c-how-to-search-accounts">
<h2>c. How to Search Accounts<a class="headerlink" href="#c-how-to-search-accounts" title="Permalink to this headline">¶</a></h2>
<p>You can search Stormpath Accounts, just like all Resource collections, using Filter, Attribute, and Datetime search. For more information about how search works in Stormpath, please see the <a class="reference internal" href="reference.html#about-search"><span>Search section</span></a> of the Reference chapter.</p>
<p>Search can be performed against one of the collections of Accounts associated with other entities:</p>
<p><code class="docutils literal"><span class="pre">/v1/applications/$APPLICATION_ID/accounts</span></code></p>
<p><code class="docutils literal"><span class="pre">/v1/directories/$DIRECTORY_ID/accounts</span></code></p>
<p><code class="docutils literal"><span class="pre">/v1/groups/$GROUP_ID/accounts</span></code></p>
<p><code class="docutils literal"><span class="pre">/v1/organizations/$ORGANIZATION_ID/accounts</span></code></p>
<p>As mentioned in the <a class="reference internal" href="reference.html#about-search"><span>Search section</span></a> of the Reference chapter, the Account resource&#8217;s <strong>searchable attributes</strong> are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">givenName</span></code></li>
<li><code class="docutils literal"><span class="pre">middleName</span></code></li>
<li><code class="docutils literal"><span class="pre">surname</span></code></li>
<li><code class="docutils literal"><span class="pre">username</span></code></li>
<li><code class="docutils literal"><span class="pre">email</span></code></li>
<li><code class="docutils literal"><span class="pre">status</span></code></li>
</ul>
<div class="section" id="example-account-searches">
<h3>Example Account Searches<a class="headerlink" href="#example-account-searches" title="Permalink to this headline">¶</a></h3>
<p>Below are some examples of different kinds of searches that can be performed to find Accounts.</p>
<div class="section" id="search-an-application-s-accounts-for-a-particular-word">
<h4>Search an Application&#8217;s Accounts for a Particular Word<a class="headerlink" href="#search-an-application-s-accounts-for-a-particular-word" title="Permalink to this headline">¶</a></h4>
<p>A simple <a class="reference internal" href="reference.html#search-filter"><span>Filter Search</span></a> using the <code class="docutils literal"><span class="pre">?q=</span></code> parameter to the Application&#8217;s <code class="docutils literal"><span class="pre">/accounts</span></code> collection will find us any Account associated with this Application that has the filter query string as part of any of its searchable attributes.</p>
<p><strong>Query</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/v1/applications/1gk4Dxzi6o4Pbdlexample/accounts?q=luc</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Matching is case-insensitive. So <code class="docutils literal"><span class="pre">?q=luc</span></code> and <code class="docutils literal"><span class="pre">?q=Luc</span></code> will return the same results.</p>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/applications/1gk4Dxzi6o4Pbdlexample/accounts</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/applications/1gk4Dxzi6o4Pbdlexample/accounts&quot;</span><span class="p">,</span>
  <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
  <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
          <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/3apenYvL0Z9v9spexAmple&quot;</span><span class="p">,</span>
          <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;jlpicard&quot;</span><span class="p">,</span>
          <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;capt@enterprise.com&quot;</span><span class="p">,</span>
          <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Jean-Luc&quot;</span><span class="p">,</span>
          <span class="nt">&quot;middleName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Picard&quot;</span><span class="p">,</span>
          <span class="nt">&quot;fullName&quot;</span><span class="p">:</span> <span class="s2">&quot;Jean-Luc Picard&quot;</span><span class="p">,</span>
          <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
          <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
      <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="find-all-the-disabled-accounts-in-a-directory">
<h4>Find All the Disabled Accounts in a Directory<a class="headerlink" href="#find-all-the-disabled-accounts-in-a-directory" title="Permalink to this headline">¶</a></h4>
<p>An <a class="reference internal" href="reference.html#search-attribute"><span>Attribute Search</span></a> can be used on a Directory&#8217;s Accounts collection in order to find all of the Accounts that contain a certain value in the specified attribute. This could be used to find all the Accounts that are disabled (i.e. that have their <code class="docutils literal"><span class="pre">status</span></code> set to <code class="docutils literal"><span class="pre">disabled</span></code>).</p>
<p><strong>Query</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/v1/directories/accounts?status=DISABLED</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8PlaekcaEXampLE/accounts&quot;</span><span class="p">,</span>
    <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/72EaYgOaq8lwTFHexAmple&quot;</span><span class="p">,</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;first2shoot&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;han@newrepublic.gov&quot;</span><span class="p">,</span>
            <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Han&quot;</span><span class="p">,</span>
            <span class="nt">&quot;middleName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Solo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;fullName&quot;</span><span class="p">:</span> <span class="s2">&quot;Han Solo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;DISABLED&quot;</span><span class="p">,</span>
            <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="find-all-accounts-in-a-directory-that-were-created-on-a-particular-day">
<h4>Find All Accounts in a Directory That Were Created on a Particular Day<a class="headerlink" href="#find-all-accounts-in-a-directory-that-were-created-on-a-particular-day" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="reference.html#search-datetime"><span>Datetime Search</span></a> is used when you want to search for Accounts that have a certain point or period in time that interests you. So we could search for all of the Accounts in a Directory that were modified on Dec 1, 2015.</p>
<p><strong>Query</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/v1/directories/2SKhstu8PlaekcaEXampLE/accounts?modifiedAt=2015-12-01</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The parameter can be written in many different ways. The following are all equivalent:</p>
<ul class="simple">
<li>?modifiedAt=2015-12-01</li>
<li>?modifiedAt=[2015-12-01T00:00, 2015-12-02T00:00]</li>
<li>?modifiedAt=[2015-12-01T00:00:00, 2015-12-02T00:00:00]</li>
</ul>
<p class="last">For more information see <a class="reference internal" href="reference.html#search-datetime"><span>Datetime Search</span></a>.</p>
</div>
<p><strong>Response</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2SKhstu8Plaekcai8lghrp/accounts&quot;</span><span class="p">,</span>
    <span class="nt">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;items&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/72EaYgOaq8lwTFHILydAid&quot;</span><span class="p">,</span>
            <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;first2shoot&quot;</span><span class="p">,</span>
            <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;han@newrepublic.gov&quot;</span><span class="p">,</span>
            <span class="nt">&quot;givenName&quot;</span><span class="p">:</span> <span class="s2">&quot;Han&quot;</span><span class="p">,</span>
            <span class="nt">&quot;middleName&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
            <span class="nt">&quot;surname&quot;</span><span class="p">:</span> <span class="s2">&quot;Solo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;fullName&quot;</span><span class="p">:</span> <span class="s2">&quot;Han Solo&quot;</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;DISABLED&quot;</span><span class="p">,</span>
            <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-08-28T16:07:38.347Z&quot;</span><span class="p">,</span>
            <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-12-01T21:22:56.608Z&quot;</span><span class="p">,</span>
            <span class="nt">&quot;...&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="d-how-to-manage-an-account-s-password">
<span id="managing-account-pwd"></span><h2>d. How to Manage an Account&#8217;s Password<a class="headerlink" href="#d-how-to-manage-an-account-s-password" title="Permalink to this headline">¶</a></h2>
<div class="section" id="manage-password-policies">
<h3>Manage Password Policies<a class="headerlink" href="#manage-password-policies" title="Permalink to this headline">¶</a></h3>
<p>In Stormpath, password policies are defined on a Directory level. Specifically, they are controlled in a <strong>Password Policy</strong> resource associated with the Directory. Modifying this resource also modifies the behavior of all Accounts that are included in this Directory. For more information about this resource, see the <a class="reference internal" href="reference.html#ref-password-policy"><span>Password Policy section in the Reference chapter</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section assumes a basic familiarity with Stormpath Workflows. For more information about Workflows, please see <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#directory-workflows">the Directory Workflows section of the Admin Console Guide</a>.</p>
</div>
<p>Changing the Password Strength resource for a Directory modifies the requirement for new Accounts and password changes on existing Accounts in that Directory. To update Password Strength, simply HTTP POST to the appropriate <code class="docutils literal"><span class="pre">$directoryId</span></code> and <code class="docutils literal"><span class="pre">/strength</span></code> resource with the changes.</p>
<p>This call:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">v1/passwordPolicies/$DIRECTORY_ID/strength</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;minLength&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;maxLength&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="nt">&quot;minSymbol&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the following response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/passwordPolicies/$DIRECTORY_ID/strength</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/passwordPolicies/$DIRECTORY_ID/strength&quot;</span><span class="p">,</span>
  <span class="nt">&quot;maxLength&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="nt">&quot;minDiacritic&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;minLength&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;minLowerCase&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;minNumeric&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;minSymbol&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;minUpperCase&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="change-an-account-s-password">
<span id="change-account-pwd"></span><h3>Change An Account&#8217;s Password<a class="headerlink" href="#change-an-account-s-password" title="Permalink to this headline">¶</a></h3>
<p>At no point is the user shown, or does Stormpath have access to, the original password once it has been hashed during account creation. The only ways to change an Account password once it has been created are:</p>
<ol class="arabic simple">
<li>To allow the user to update it (without seeing the original value) after being authenticated, or</li>
<li>To use the <a class="reference internal" href="#password-reset-flow"><span>password reset workflow</span></a>.</li>
</ol>
<p>To update the password, you simply send a POST to the <code class="docutils literal"><span class="pre">v1/accounts/$ACCOUNT_ID</span></code> endpoint with the new password:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/accounts/3apenYvL0Z9v9spexAmple</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="s2">&quot;some_New+Value1234&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the call succeeds you will get back an <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span> <span class="pre">OK</span></code> with the Account resource in the body.</p>
<p>For more information about resetting the password, read on.</p>
</div>
<div class="section" id="password-reset">
<span id="password-reset-flow"></span><h3>Password Reset<a class="headerlink" href="#password-reset" title="Permalink to this headline">¶</a></h3>
<p>Password Reset in Stormpath is a self-service flow, where the user is sent an email with a secure link. The user can then click that link and be shown a password reset form. The password reset workflow involves changes to an account at an application level, and as such, this workflow relies on the application resource as a starting point. While this workflow is disabled by default, you can enable it easily in the Stormpath Admin Console UI. Refer to the <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#password-reset">Stormpath Admin Console product guide</a> for complete instructions.</p>
</div>
<div class="section" id="how-to-reset-a-password">
<h3>How To Reset A Password<a class="headerlink" href="#how-to-reset-a-password" title="Permalink to this headline">¶</a></h3>
<p>There are three steps to the password reset flow:</p>
<ol class="arabic simple">
<li>Trigger the workflow</li>
<li>Verify the token</li>
<li>Update the password</li>
</ol>
<p><strong>Trigger the workflow</strong></p>
<p>To trigger the password reset workflow, you send an HTTP POST to the Application&#8217;s <code class="docutils literal"><span class="pre">/passwordResetTokens</span></code> endpoint:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4Pbdlexample/passwordResetTokens</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="s2">&quot;phasma@empire.gov&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is also possible to specify the Account Store in your Password Reset POST:</p>
<div class="last highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4Pbdlexample/passwordResetTokens</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="s2">&quot;phasma@empire.gov&quot;</span>
  <span class="s2">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/2SKhstu8Plaekcai8lghrp&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>If this is a valid email in an Account associated with this Application, you will get a success response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/applications/1gk4Dxzi6o4PbdlBVa6tfR/passwordResetTokens/eyJraWQiOiIxZ0JUbmNXc3AyT2JRR2dEbjlSOTFSIiwiYWxnIjoiSFExaMPLe.eyJleHAiOjE0NDgwNDg4NDcsImp0aSI6IjJwSW44eFBHeURMTVM5WFpqWEVExaMPLe.cn9VYU3OnyKXN0dA0qskMv4T4jhDgQaRdA-wExaMPLe&quot;</span><span class="p">,</span>
  <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;phasma@empire.gov&quot;</span><span class="p">,</span>
  <span class="nt">&quot;account&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/2FvPkChR78oFnyfexample&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For a full description of this endpoint please see <a class="reference internal" href="reference.html#ref-password-reset-token"><span>Password Reset Tokens</span></a> in the Reference chapter.</p>
</div>
<p>At this point, an email will be built using the password reset base URL specified in the Stormpath Admin Console. Stormpath sends an email (that you <a class="reference internal" href="#password-reset-email-templates"><span>can customize</span></a>) to the user with a link in the format that follows:</p>
<p><code class="docutils literal"><span class="pre">http://yoursite.com/path/to/reset/page?sptoken=$TOKEN</span></code></p>
<p>So the user would then receive something that looked like this:</p>
<div class="highlight-python"><div class="highlight"><pre>Forgot your password?

We&#39;ve received a request to reset the password for this email address.

To reset your password please click on this link or cut and paste this
URL into your browser (link expires in 24 hours):
https://api.stormpath.com/passwordReset?sptoken=eyJraWQiOiIxZ0JUbmNXc[...]

This link takes you to a secure page where you can change your password.
</pre></div>
</div>
<p><strong>Verify the token</strong></p>
<p>Once the user clicks this link, your controller should retrieve the token from the query string and check it against the Stormpath API. This can be accomplish by sending a GET to the Application&#8217;s <code class="docutils literal"><span class="pre">/passwordResetTokens/$TOKEN_VALUE</span></code> endpoint:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/v1/applications/1gk4Dxzi6o4Pbdlexample/passwordResetTokens/eyJraWQiOiIxZ0JUbmNXc[...]</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
<p>This would result in the exact same <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span></code> success response as when the token was first generated above.</p>
<p><strong>Update the password</strong></p>
<p>After a successful GET with the query string token, you can direct the user to a page where they can update their password. Once you have the password, you can update the Account resource with POST to the  <cite>passwordResetTokens</cite> endpoint. This is the same endpoint that you used to validate the token above.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/applications/1gk4Dxzi6o4Pbdlexample/passwordResetTokens/eyJraWQiOiIxZ0JUbmNXc[...]</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;updated+Password1234&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On success, the response will include a link to the Account that the password was reset for. It will also send the password change confirmation email that was configured in the Administrator Console to the email account associated with the account.</p>
<div class="section" id="manage-password-reset-emails">
<h4>Manage Password Reset Emails<a class="headerlink" href="#manage-password-reset-emails" title="Permalink to this headline">¶</a></h4>
<p>The Password Reset Email is configurable for a Directory. There is a set of properties on the <a class="reference internal" href="reference.html#ref-password-policy"><span>Password Policy</span></a> resource that define its behavior. These properties are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">resetEmailStatus</span></code> which enables or disables the reset email.</li>
<li><code class="docutils literal"><span class="pre">resetEmailTemplates</span></code> which defines the content of the password reset email that is sent to the Account’s email address with a link to reset the Account’s password.</li>
<li><code class="docutils literal"><span class="pre">resetSuccessEmailStatus</span></code> which enables or disables the reset success email, and</li>
<li><code class="docutils literal"><span class="pre">resetSuccessEmailTemplates</span></code> which defines the content of the reset success email.</li>
</ul>
<p>To control whether any email is sent or not is simply a matter of setting the appropriate value to either <code class="docutils literal"><span class="pre">ENABLED</span></code> or <code class="docutils literal"><span class="pre">DISABLED</span></code>. For example, if you would like a Password Reset email to be sent, send the following:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/passwordPolicies/$DIRECTORY_ID</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
    <span class="nt">&quot;resetEmailStatus&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="password-reset-email-templates">
<span id="id2"></span><h4>Password Reset Email Templates<a class="headerlink" href="#password-reset-email-templates" title="Permalink to this headline">¶</a></h4>
<p>The contents of the password reset and the password reset success emails are both defined in an <a class="reference internal" href="reference.html#ref-emailtemplates"><span>Email Templates</span></a> collection.</p>
<p>To modify the emails that get sent during the password reset workflow, all you have to do is send an HTTP POST with the desired property in the payload body.</p>
</div>
</div>
</div>
<div class="section" id="e-how-to-verify-an-account-s-email">
<span id="verify-account-email"></span><h2>e. How to Verify an Account&#8217;s Email<a class="headerlink" href="#e-how-to-verify-an-account-s-email" title="Permalink to this headline">¶</a></h2>
<p>If you want to verify that an Account’s email address is valid and that the Account belongs to a real person, Stormpath can help automate this for you using <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#directory-workflows">Workflows</a>.</p>
<div class="section" id="understanding-the-email-verification-workflow">
<h3>Understanding the Email Verification Workflow<a class="headerlink" href="#understanding-the-email-verification-workflow" title="Permalink to this headline">¶</a></h3>
<p>This workflow involves 3 parties: your application&#8217;s end-user, your application, and the Stormpath API server.</p>
<ol class="arabic simple">
<li>When the Account is created in a Directory that has “Verification” enabled, Stormpath will automatically send an email to the Account&#8217;s email address.</li>
<li>The end-user opens their email and clicks the verification link. This link comes with a token.</li>
<li>With the token, your application calls back to the Stormpath API server to complete the process.</li>
</ol>
<p>If you create a new Account in a Directory with both Account Registration and Verification enabled, Stormpath will automatically send a welcome email that contains a verification link to the Account’s email address on your behalf. If the person reading the email clicks the verification link in the email, the Account will then have an <code class="docutils literal"><span class="pre">ENABLED</span></code> status and be allowed to log in to applications.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Accounts created in a Directory that has the Verification workflow enabled will have an <code class="docutils literal"><span class="pre">UNVERIFIED</span></code> status by default. <code class="docutils literal"><span class="pre">UNVERIFIED</span></code> is the same as <code class="docutils literal"><span class="pre">DISABLED</span></code>, but additionally indicates why the Account is disabled. When the email link is clicked, the Account&#8217;s status will change <code class="docutils literal"><span class="pre">ENABLED</span></code>.</p>
</div>
<div class="section" id="the-account-verification-base-url">
<h4>The Account Verification Base URL<a class="headerlink" href="#the-account-verification-base-url" title="Permalink to this headline">¶</a></h4>
<p>It is also expected that the workflow’s <strong>Account Verification Base URL</strong> has been set to a URL that will be processed by your own application web server. This URL should be free of any query parameters, as the Stormpath back-end will append on to the URL a parameter used to verify the email. If this URL is not set, a default Stormpath-branded page will appear which allows the user to complete the workflow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Account Verification Base URL defaults to a Stormpath API Sever URL which, while it is functional, is a Stormpath API server web page. Because it will likely confuse your application end-users if they see a Stormpath web page, we strongly recommended that you specify a URL that points to your web application.</p>
</div>
</div>
</div>
<div class="section" id="configuring-the-verification-workflow">
<h3>Configuring the Verification Workflow<a class="headerlink" href="#configuring-the-verification-workflow" title="Permalink to this headline">¶</a></h3>
<p>This workflow is disabled by default on Directories, but you can enable it, and set up the account verification base URL, easily in the Stormpath Admin Console UI. Refer to the <a class="reference external" href="http://docs.stormpath.com/console/product-guide/#directory-workflows">Stormpath Admin Console Guide</a> for complete instructions.</p>
</div>
<div class="section" id="triggering-the-verification-email-creating-a-token">
<h3>Triggering the Verification Email (Creating A Token)<a class="headerlink" href="#triggering-the-verification-email-creating-a-token" title="Permalink to this headline">¶</a></h3>
<p>In order to verify an Account’s email address, an <code class="docutils literal"><span class="pre">emailVerificationToken</span></code> must be created for that Account. To create this token, you simply create an Account in a Directory, either programmatically or via a public account creation form of your own design, that has the account registration and verification workflows enabled.</p>
</div>
<div class="section" id="verifying-the-email-address-consuming-the-token">
<h3>Verifying the Email Address (Consuming The Token)<a class="headerlink" href="#verifying-the-email-address-consuming-the-token" title="Permalink to this headline">¶</a></h3>
<p>The email that is sent upon Account creation contains a link to the base URL that you&#8217;ve configured, along with the <code class="docutils literal"><span class="pre">sptoken</span></code> query string parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>http://www.yourapplicationurl.com/path/to/validator/?sptoken=$VERIFICATION_TOKEN
</pre></div>
</div>
<p>The token you capture from the query string is used to form the full <code class="docutils literal"><span class="pre">href</span></code> for a special email verification endpoint used to verify the Account:</p>
<div class="highlight-python"><div class="highlight"><pre>/v1/accounts/emailVerificationsToken/$VERIFICATION_TOKEN
</pre></div>
</div>
<p>To verify the Account, you use the token from the query string to form the above URL and POST a body-less request against the fully-qualified end point:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/accounts/emailVerificationTokens/6YJv9XBH1dZGP5A8rq7Zyl</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>
</pre></div>
</div>
<p>Which will return a result that looks like this:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/accounts/6XLbNaUsKm3E0kXMTTr10V</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8;</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/accounts/6XLbNaUsKm3E0kXMTTr10V&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the validation succeeds, you will receive back the <code class="docutils literal"><span class="pre">href</span></code> for the Account resource which has now been verified. An email confirming the verification will be automatically sent to the Account’s email address by Stormpath afterwards, and the Account will then be able to authenticate successfully.</p>
<p>If the verification token is not found, a <code class="docutils literal"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code> error is returned with a payload explaining why the attempt failed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more about Account Authentication you can read <a class="reference internal" href="005_auth_n.html"><em>the next chapter</em></a>.</p>
</div>
</div>
<div class="section" id="resending-the-verification-email">
<span id="resending-verification-email"></span><h3>Resending The Verification Email<a class="headerlink" href="#resending-the-verification-email" title="Permalink to this headline">¶</a></h3>
<p>If a user accidentally deletes their verification email, or it was undeliverable for some reason, it is possible to resend the email using the <a class="reference internal" href="reference.html#ref-application"><span>Application resource&#8217;s</span></a> <code class="docutils literal"><span class="pre">/verificationEmails</span></code> endpoint.</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/applications/$APPLICATION_ID/verificationEmails</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;email@address.com&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If this calls succeeds, an <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">202</span> <span class="pre">ACCEPTED</span></code> will return.</p>
</div>
</div>
<div class="section" id="f-customizing-stormpath-emails-via-rest">
<span id="customizing-email-templates"></span><h2>f. Customizing Stormpath Emails via REST<a class="headerlink" href="#f-customizing-stormpath-emails-via-rest" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-emails-does-stormpath-send">
<h3>What emails does Stormpath send?<a class="headerlink" href="#what-emails-does-stormpath-send" title="Permalink to this headline">¶</a></h3>
<p>Stormpath can be configured to send emails to users as part of a Directory&#8217;s Account Creation and Password Reset policies.</p>
<div class="section" id="id3">
<h4>Account Creation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Found in: <a class="reference internal" href="reference.html#ref-accnt-creation-policy"><span>Account Creation Policy</span></a></p>
<ul class="simple">
<li><em>Verification Email</em>: The initial email that is sent out after Account creation that verifies the email address that was used for registration with a link containing the verification token.</li>
<li><em>Verification Success Email</em>: An email that is sent after a successful email verification.</li>
<li><em>Welcome Email</em>: An email welcoming the user to your application.</li>
</ul>
<p>For more information about this, see <a class="reference internal" href="#verify-account-email"><span>e. How to Verify an Account&#8217;s Email</span></a>.</p>
</div>
<div class="section" id="id4">
<h4>Password Reset<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Found in: <a class="reference internal" href="reference.html#ref-password-policy"><span>Password Policy</span></a></p>
<ul class="simple">
<li><em>Reset Email</em>: The email that is sent out after a user asks to reset their password. It contains a URL with a password reset token.</li>
<li><em>Reset Success Email</em>:  An email that is sent after a successful password reset.</li>
</ul>
<p>For more information about this, see <a class="reference internal" href="#password-reset-flow"><span>Password Reset</span></a>.</p>
</div>
</div>
<div class="section" id="customizing-stormpath-email-templates">
<h3>Customizing Stormpath Email Templates<a class="headerlink" href="#customizing-stormpath-email-templates" title="Permalink to this headline">¶</a></h3>
<p>The emails that Stormpath sends to users be customized by modifying the <a class="reference internal" href="reference.html#ref-emailtemplates"><span>Email Templates</span></a> resource. This can be done either via the &#8220;Directory Workflows&#8221; section of the <a class="reference external" href="https://api.stormpath.com/login">Stormpath Admin Console</a>, or via REST. To find out how to do it via REST, keep reading.</p>
<p>First, let&#8217;s look at the default template that comes with the Stormpath Administrator&#8217;s Directory:</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/v1/emailTemplates/2jwPxFsnjqxYrojvU1m2Nh&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Default Verification Email Template&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;This is the verification email template that is associated with the directory.&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fromName&quot;</span><span class="p">:</span><span class="s2">&quot;Jakub Swiatczak&quot;</span><span class="p">,</span>
  <span class="nt">&quot;fromEmailAddress&quot;</span><span class="p">:</span><span class="s2">&quot;change-me@stormpath.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;subject&quot;</span><span class="p">:</span><span class="s2">&quot;Verify your account&quot;</span><span class="p">,</span>
  <span class="nt">&quot;textBody&quot;</span><span class="p">:</span><span class="s2">&quot;Hi,\nYou have been registered for an application that uses Stormpath.\n\n${url}\n\nOnce you verify, you will be able to login.\n\n---------------------\nFor general inquiries or to request support with your account, please email change-me@stormpath.com&quot;</span><span class="p">,</span>
  <span class="nt">&quot;htmlBody&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;p&gt;Hi,&lt;/p&gt;\n&lt;p&gt;You have been registered for an application that uses Stormpath.&lt;/p&gt;&lt;a href=\&quot;${url}\&quot;&gt;Click here to verify your account&lt;/a&gt;&lt;p&gt;Once you verify, you will be able to login.&lt;/p&gt;&lt;p&gt;--------------------- &lt;br /&gt;For general inquiries or to request support with your account, please email change-me@stormpath.com&lt;/p&gt;&quot;</span><span class="p">,</span>
  <span class="nt">&quot;mimeType&quot;</span><span class="p">:</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
  <span class="nt">&quot;defaultModel&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;linkBaseUrl&quot;</span><span class="p">:</span><span class="s2">&quot;https://api.stormpath.com/emailVerificationTokens&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="message-format">
<h3>Message Format<a class="headerlink" href="#message-format" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">mimeType</span></code> designates whether the email is sent as plain text or HTML. This in turns tells Stormpath whether to use the <code class="docutils literal"><span class="pre">textBody</span></code> or <code class="docutils literal"><span class="pre">htmlBody</span></code> text in the email.</p>
</div>
<div class="section" id="textbody-and-htmlbody">
<h3>textBody and htmlBody<a class="headerlink" href="#textbody-and-htmlbody" title="Permalink to this headline">¶</a></h3>
<p>These define the actual content of the email. The only difference is that <code class="docutils literal"><span class="pre">htmlBody</span></code> is allowed to contain HTML markup while <code class="docutils literal"><span class="pre">textBody</span></code> only accepts plaintext. Both are also able to use <a class="reference external" href="http://web.cerritos.edu/jwilson/SitePages/java_language_resources/Java_Escape_Sequences.htm">Java Escape Sequences</a>. Both <code class="docutils literal"><span class="pre">htmlBody</span></code> and <code class="docutils literal"><span class="pre">textBody</span></code> can have customized output generated using template macros.</p>
<div class="section" id="using-email-macros">
<span id="id5"></span><h4>Using Email Macros<a class="headerlink" href="#using-email-macros" title="Permalink to this headline">¶</a></h4>
<p>Stormpath uses Apache Velocity for email templating, and consequently you can use macros in your email templates. Macros are placeholder text that are converted into actual values at the time the email is generated. You could use a macro to insert your user&#8217;s first name into the email, as well as the name of your Application. This would look like this:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;Hi ${account.givenName}, welcome to $!{application.name}!&quot;</span>
</pre></div>
</div>
<p>The basic structure for a macro is <code class="docutils literal"><span class="pre">${resource.attribute}</span></code>. There are three kinds of <code class="docutils literal"><span class="pre">resource</span></code> that you can work with:</p>
<ul class="simple">
<li>Account (<code class="docutils literal"><span class="pre">${account}</span></code>)</li>
<li>an Account&#8217;s Directory (<code class="docutils literal"><span class="pre">${account.directory}</span></code>), and</li>
<li>an Application (<code class="docutils literal"><span class="pre">$!{application}</span></code>).</li>
</ul>
<p>You can also include any <code class="docutils literal"><span class="pre">attribute</span></code> that isn&#8217;t a link, as well as customData.</p>
<p>For a full list of email macros, see the <a class="reference internal" href="reference.html#ref-email-macros"><span>Macros</span></a> section of the Reference chapter.</p>
<div class="section" id="macros-and-customdata">
<h5>Macros and customData<a class="headerlink" href="#macros-and-customdata" title="Permalink to this headline">¶</a></h5>
<p>The formatting for customData macros is as follows:</p>
<div class="highlight-velocity"><div class="highlight"><pre>$!{resource.attribute.customData.key}
</pre></div>
</div>
<p>You may have noticed here and with the Application resource that there is an included <code class="docutils literal"><span class="pre">!</span></code> character, this is called a &#8220;quiet reference&#8221;.</p>
</div>
<div class="section" id="quiet-references">
<span id="quiet-macro-reference"></span><h5>Quiet References<a class="headerlink" href="#quiet-references" title="Permalink to this headline">¶</a></h5>
<p>Quiet references (<code class="docutils literal"><span class="pre">!</span></code>) tell Velocity that, if it can&#8217;t resolve the object, it should just show nothing. Normally, if a macro was  <code class="docutils literal"><span class="pre">Is</span> <span class="pre">your</span> <span class="pre">favorite</span> <span class="pre">color</span> <span class="pre">${account.customData.favoriteColor}?</span></code>, and Velocity was able to find the value as <code class="docutils literal"><span class="pre">blue</span></code>, it would output:</p>
<p><code class="docutils literal"><span class="pre">Is</span> <span class="pre">your</span> <span class="pre">favorite</span> <span class="pre">color</span> <span class="pre">blue?</span></code></p>
<p>However, if the value could not be found, it would output:</p>
<p><code class="docutils literal"><span class="pre">Is</span> <span class="pre">your</span> <span class="pre">favorite</span> <span class="pre">color</span> <span class="pre">${account.customData.favoriteColor}?</span></code></p>
<p>To avoid this, we include the <code class="docutils literal"><span class="pre">!</span></code> which puts the macro into &#8220;quiet reference&#8221; mode. This means that if the value is not found, the output will be:</p>
<p><code class="docutils literal"><span class="pre">Is</span> <span class="pre">your</span> <span class="pre">favorite</span> <span class="pre">color</span> <span class="pre">?</span></code></p>
<p>Since customData can contain any arbitrary key-value pairs, Stormpath recommends that any email macro references to customData keys use the <code class="docutils literal"><span class="pre">!</span></code> quiet reference. Applications should also use the quiet reference because there are possible cases where the Velocity engine might not have access to an Application resource.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="005_auth_n.html" class="btn btn-neutral float-right" title="5. Authenticating Accounts with Stormpath">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="003_quickstart.html" class="btn btn-neutral" title="3. Quickstart"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath, Inc..
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'V1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>