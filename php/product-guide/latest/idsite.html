

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Using ID Site &mdash; Stormpath PHP Documentation  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Stormpath PHP Documentation  documentation" href="index.html"/>
        <link rel="next" title="REST API Reference" href="reference.html"/>
        <link rel="prev" title="6. Multi-Tenancy with Stormpath" href="multitenancy.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  
  <script src="https://cdn.optimizely.com/js/225847041.js"></script>

  
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '986262161469311');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=986262161469311&ev=PageView&noscript=1"
  /></noscript>
</head>

<body class="wy-body-for-nav" role="document">

  
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NQZZFW');</script>

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
  

          
            <a href="index.html" class="icon icon-home"> Stormpath PHP Documentation
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

  <div class="langpicker-container">
    <a href="#langpicker" class="langpicker-link">
      <i class="fa fa-code"></i>
      Switch Language
    </a>
    <div id="langpicker" style="display:none;">
      <div class="">
        <a href="/csharp/product-guide/latest/idsite.html">C#</a>
      </div>
      <div class="">
        <a href="/java/product-guide/latest/idsite.html">Java</a>
      </div>
      <div class="">
        <a href="/nodejs/product-guide/latest/idsite.html">Node.js</a>
      </div>
      <div class="current">
        <a href="/php/product-guide/latest/idsite.html">PHP</a>
      </div>
      <div class="">
        <a href="/python/product-guide/latest/idsite.html">Python</a>
      </div>
      <div class="">
        <a href="/rest/product-guide/latest/idsite.html">REST</a>
      </div>
      <div class="">
        <a href="/ruby/product-guide/latest/idsite.html">Ruby</a>
      </div>
      <div class="">
        <a href="/vbnet/product-guide/latest/idsite.html">Visual Basic</a>
      </div>
    </div>
  </div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">1. About Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-stormpath">1.1. What is Stormpath?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="about.html#what-you-can-do-with-stormpath">1.1.1. What you can do with Stormpath</a></li>
<li class="toctree-l3"><a class="reference internal" href="about.html#who-should-use-stormpath">1.1.2. Who should use Stormpath</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="about.html#the-stormpath-data-model">1.2. The Stormpath Data Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">2. Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#sign-up-for-stormpath">2.1 Sign-up for Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-an-api-key-pair">2.2 Create an API Key Pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#installing-the-sdk">2.3 Installing the SDK</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#retrieve-your-application">2.4. Retrieve Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-a-user-account">2.5. Create a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#authenticate-a-user-account">2.6. Authenticate a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#next-steps">2.7. Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="accnt_mgmt.html">3. Account Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#modeling-your-user-base">3.1. Modeling Your User Base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#directories">3.1.1. Directories</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#types-of-directories">Types of Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#cloud-directories">Cloud Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#mirror-directories">Mirror Directories</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#groups">3.1.2. Groups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#modeling-user-hierarchies-using-groups">Modeling User Hierarchies Using Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#how-to-create-a-group">How to Create a Group</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-store-accounts-in-stormpath">3.2. How to Store Accounts in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#new-account-creation">3.2.1. New Account Creation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#add-a-new-account-to-a-directory">Add a New Account to a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#add-an-existing-account-to-a-group">Add an Existing Account to a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#adding-a-new-account-or-group-to-an-application-or-organization">Adding a new Account or Group to an Application or Organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#importing-accounts">3.2.2. Importing Accounts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-plaintext-passwords">Importing Accounts with Plaintext Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-supported-password-hashes">Importing Accounts with Supported Password Hashes</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#importing-accounts-with-unsupported-password-hashes">Importing Accounts with Unsupported Password Hashes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-store-additional-user-information-as-custom-data">3.2.3. How to Store Additional User Information as Custom Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-search-accounts">3.3. How to Search Accounts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#example-account-searches">3.3.1. Example Account Searches</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#search-an-application-s-accounts-for-a-particular-word">Search an Application&#8217;s Accounts for a Particular Word</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#find-all-the-disabled-accounts-in-a-directory">Find All the Disabled Accounts in a Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#find-all-accounts-in-a-directory-that-were-modified-on-a-particular-day">Find All Accounts in a Directory That Were Modified on a Particular Day</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#searching-for-accounts-with-custom-data">3.3.2. Searching for Accounts with Custom Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-manage-an-account-s-password">3.4. How to Manage an Account&#8217;s Password</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#manage-password-policies">3.4.1. Manage Password Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#change-an-account-s-password">3.4.2. Change an Account&#8217;s Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#password-reset">3.4.3. Password Reset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#how-to-reset-a-password">How to Reset a Password</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#manage-password-reset-emails">Manage Password Reset Emails</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#password-reset-email-templates">Password Reset Email Templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-find-when-an-account-s-password-was-changed">3.4.4. How to Find When An Account&#8217;s Password Was Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-restrict-password-reuse">3.4.5. How to Restrict Password Reuse</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-manage-an-account-s-required-attributes">3.5. How to Manage an Account&#8217;s Required Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#retrieving-your-directory-s-account-schema">3.5.1. Retrieving your Directory&#8217;s Account Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#modifying-your-directory-s-account-schema">3.5.2. Modifying your Directory&#8217;s Account Schema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#how-to-verify-an-account-s-email">3.6. How to Verify an Account&#8217;s Email</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#the-email-verification-workflow">3.6.1. The Email Verification Workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#the-account-verification-base-url">The Account Verification Base URL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#configuring-the-verification-workflow">3.6.2. Configuring the Verification Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#triggering-the-verification-email-creating-a-token">3.6.3. Triggering the Verification Email (Creating A Token)</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#verifying-the-email-address-consuming-the-token">3.6.4. Verifying the Email Address (Consuming The Token)</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#resending-the-verification-email">3.6.5. Resending the Verification Email</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#customizing-stormpath-emails">3.7. Customizing Stormpath Emails</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#what-emails-does-stormpath-send">3.7.1. What Emails Does Stormpath Send?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#id6">Account Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#id7">Password Reset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#customizing-stormpath-email-templates">3.7.2. Customizing Stormpath Email Templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#using-email-macros">Using Email Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#customizing-your-smtp-server">3.7.3. Customizing Your SMTP Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#adding-a-new-custom-server">Adding a new Custom Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#deleting-a-custom-server">Deleting a Custom Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#restricting-user-email-domains">3.7.4 Restricting User Email Domains</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#domain-entries">Domain Entries</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#working-with-the-lists">Working with the Lists</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accnt_mgmt.html#account-linking">3.8. Account Linking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-login-works-with-linked-accounts">How Login Works with Linked Accounts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#application-vs-organization-account-linking-policies">Application vs Organization Account Linking Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-login-behaviors">Example Login Behaviors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-link-accounts-manually">How to Link Accounts Manually</a></li>
<li class="toctree-l3"><a class="reference internal" href="accnt_mgmt.html#how-to-link-accounts-automatically">How to Link Accounts Automatically</a><ul>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#what-s-in-the-account-linking-policy">What&#8217;s in the Account Linking Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#account-matching-and-account-verification">Account Matching and Account Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-scenario-1">Example Scenario 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="accnt_mgmt.html#example-scenario-2">Example Scenario 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auth_n.html">4. Authenticating Accounts with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#how-password-authentication-works-in-stormpath">4.1. How Password Authentication Works in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#authenticating-an-account">4.1.1. Authenticating An Account</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#how-login-attempts-work-in-stormpath">4.1.2. How Login Attempts Work in Stormpath</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#manage-who-can-log-into-your-application">4.1.3. Manage Who Can Log Into Your Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#mapping-a-new-account-store">Mapping a new Account Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#updating-an-existing-account-store">Updating an Existing Account Store</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#how-token-based-authentication-works">4.2. How Token-Based Authentication Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#introduction-to-token-based-authentication">4.2.1. Introduction to Token-Based Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#why-oauth-2-0">Why OAuth 2.0?</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#what-tokens-are-available-for-token-based-authentication">What Tokens Are Available for Token-Based Authentication?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#using-stormpath-for-token-based-authentication">4.2.2. Using Stormpath for Token-Based Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#configuring-token-based-authentication">Configuring Token-Based Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#generating-an-oauth-2-0-access-token">Generating an OAuth 2.0 Access Token</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#validating-an-access-token">Validating an Access Token</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#refreshing-access-tokens">Refreshing Access Tokens</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#revoking-access-and-refresh-tokens">Revoking Access and Refresh Tokens</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#how-social-authentication-works">4.3. How Social Authentication Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#attribute-mappings">Attribute Mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#scopes">Scopes</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#social-login-providers">Social Login Providers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#google">4.3.1. Google</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#facebook">4.3.2. Facebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#github">4.3.3. Github</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#linkedin">4.3.4 LinkedIn</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#twitter">4.3.5. Twitter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#authenticating-against-an-ldap-directory">4.4. Authenticating Against an LDAP Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#the-ldap-authentication-flow">The LDAP Authentication Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#mirror-directories-and-ldap">Mirror Directories and LDAP</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#setting-up-login-with-ldap">Setting Up Login With LDAP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-1-create-an-ldap-directory">Step 1: Create an LDAP Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-2-install-your-ldap-agent">Step 2: Install your LDAP Agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-3-map-the-ldap-directory-as-an-account-store-for-your-application">Step 3: Map the LDAP Directory as an Account Store for Your Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#authenticating-against-a-saml-directory">4.5. Authenticating Against a SAML Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#stormpath-as-a-service-provider">4.5.1. Stormpath as a Service Provider</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#identity-provider-initiated-saml-authentication">Identity Provider Initiated SAML Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#service-provider-initiated-saml-authentication">Service Provider Initiated SAML Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#configuring-saml">4.5.2. Configuring SAML</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#salesforce">Salesforce</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#onelogin">OneLogin</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#okta">Okta</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#ping">Ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#active-directory-federation-services">Active Directory Federation Services</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#azure-active-directory">Azure Active Directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#configuring-saml-via-rest">4.5.3. Configuring SAML via REST</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-1-gather-idp-data">Step 1: Gather IDP Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-2-configure-your-saml-directory">Step 2: Configure Your SAML Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-3-retrieve-your-service-provider-metadata">Step 3: Retrieve Your Service Provider Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-4-configure-your-service-provider-in-your-identity-provider">Step 4: Configure Your Service Provider in Your Identity Provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-5-configure-your-application">Step 5: Configure Your Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-6-add-the-saml-directory-as-an-account-store">Step 6: Add the SAML Directory as an Account Store</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-7-configure-saml-attribute-mapping-optional">Step 7: Configure SAML Attribute Mapping (Optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#the-stormpath-saml-flow">4.5.4. The Stormpath SAML Flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#the-identity-provider-initiated-flow">The Identity Provider Initiated Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-1-identity-provider-login">Step 1: Identity Provider Login</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-2-redirect-to-assertion-consumer-service-url">Step 2: Redirect to Assertion Consumer Service URL</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-3-stormpath-response-with-jwt">Step 3: Stormpath Response with JWT</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#the-service-provider-initiated-flow">The Service Provider Initiated Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-1-generate-a-jwt">Step 1: Generate a JWT</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-2-initiate-the-flow">Step 2: Initiate the flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-3-redirection">Step 3: Redirection</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-4-identity-provider-login">Step 4: Identity Provider Login</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-5-redirect-to-assertion-consumer-service-url">Step 5: Redirect to Assertion Consumer Service URL</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#step-6-stormpath-response-with-jwt">Step 6: Stormpath Response with JWT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#using-multi-factor-authentication-mfa">4.6. Using Multi-Factor Authentication (MFA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#enrolling-an-additional-factor">4.6.1. Enrolling an Additional Factor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#adding-an-sms-factor">Adding an SMS Factor</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#adding-a-google-authenticator-factor">Adding a Google Authenticator Factor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#challenging-a-factor">4.6.2. Challenging a Factor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#challenging-after-factor-creation">Challenging After Factor Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#challenging-during-factor-creation">Challenging During Factor Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#challenging-a-factor-after-login">Challenging a Factor After Login</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_n.html#how-api-key-authentication-works-in-stormpath">4.7. How API Key Authentication Works in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#how-to-use-api-key-and-secret-authentication">4.7.1. How to use API Key and Secret Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#create-an-api-key-for-an-account">Create an API Key for an Account</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_n.html#managing-api-keys">Managing API Keys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#how-to-authenticate-using-http-basic">4.7.2. How to Authenticate Using HTTP Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#how-to-exchange-an-api-key-for-an-access-token">4.7.3. How to Exchange an API Key for an Access Token</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_n.html#how-to-authenticate-using-http-bearer-access-tokens">4.7.4. How to Authenticate Using HTTP Bearer Access Tokens</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auth_z.html">5. Authorization With Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auth_z.html#what-is-authorization">5.1. What is Authorization?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#simple-authorization">5.1.1. Simple Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#permissions-based-authorization">5.1.2. Permissions-based Authorization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth_z.html#modeling-authorization-in-stormpath">5.2. Modeling Authorization in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#how-to-use-groups-to-model-authorization-roles">5.2.1. How to Use Groups to Model Authorization Roles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#application-wide-roles">Application-Wide Roles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth_z.html#using-permissions">5.2.2. Using Permissions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#how-to-model-fine-grained-permissions">How to Model Fine-Grained Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth_z.html#checking-user-and-role-permissions">Checking User and Role Permissions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="multitenancy.html">6. Multi-Tenancy with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#what-is-a-multi-tenant-application">6.1. What Is a Multi-Tenant Application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#modeling-tenants-in-stormpath">6.2. Modeling Tenants in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#multi-tenancy-and-the-stormpath-data-model">6.2.1 Multi-Tenancy and the Stormpath Data Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#why-use-organizations">Why use Organizations?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#account-store-strategies-for-multi-tenancy">6.2.1. Account Store Strategies for Multi-Tenancy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#strategy-1-directory-per-organization">Strategy 1: Directory per Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#strategy-2-group-per-organization">Strategy 2: Group per Organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#working-with-organizations">6.2.2. Working with Organizations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#how-to-create-an-organization">How to Create an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#adding-an-account-store-to-an-organization">Adding an Account Store to an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#registering-an-organization-as-an-account-store-for-an-application">Registering an Organization as an Account Store for an Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#adding-an-account-to-an-organization">Adding an Account to an Organization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#authenticating-an-account-against-an-organization">6.3. Authenticating an Account against an Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="multitenancy.html#routing-users-to-their-tenant">6.4 Routing Users to their Tenant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#sub-domain">6.4.1. Sub-Domain</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#separate-domain-space">Separate Domain Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="multitenancy.html#combine-with-login-form-field">Combine With Login Form Field</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multitenancy.html#login-form-field">6.4.2. Login Form Field</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">7. Using ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-an-id-site">7.1. What is an ID Site?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-should-i-use-stormpath-id-site">Why should I use Stormpath ID Site?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#browser-support">Browser Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-does-id-site-work">7.2. How does ID Site Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#idsite-set-up">7.3. ID Site Set Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-id-site-via-language">7.4. Using ID Site Via PHP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-getting-a-user-to-id-site">Step 1: Getting a User to ID Site</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-handling-the-callback-to-your-application-from-id-site">Step 2: Handling the Callback to your Application from ID Site</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exchanging-the-id-site-jwt-for-an-oauth-token">Exchanging the ID Site JWT for an OAuth Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-optional-logging-out-of-id-site">Step 3: (Optional) Logging Out of ID Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resetting-your-password-with-id-site">Resetting Your Password with ID Site</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-id-site-for-multi-tenancy">7.5. Using ID Site for Multi-tenancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#idsite-sso">7.6. ID Site &amp; Single Sign-On</a></li>
<li class="toctree-l2"><a class="reference internal" href="#idsite-hosting">7.7. ID Site Hosting Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#required-api-credentials">1. Required API Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#setting-up-caching">2. Setting Up Caching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#memcached">Memcached</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#redis">Redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#other-caches">Other Caches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#using-a-different-environment">3. Using a Different Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuration-sources">4. Configuration Sources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#environment-variables">4.1. Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#yaml-json-markup-file">4.2. YAML/JSON Markup File</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#api-credentials-file">4.3. API Credentials File</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#inline-code-configuration">4.4. Inline Code Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#configuration-reference">5. Configuration Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#api-credentials">API Credentials</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#base-url">Base URL</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#cache-manager">Cache Manager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#id13">Inline Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#authentication-scheme">Authentication Scheme</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#generating-an-oauth-2-0-access-token">Generating an OAuth 2.0 Access Token</a><ul>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#client-credentials">Client Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#social">Social</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#password">Password</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#stormpath-factor-challenge">Stormpath Factor Challenge</a></li>
<li class="toctree-l3"><a class="reference internal" href="appendix.html#token-generation-example">Token Generation Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="appendix.html#social-login-deprecated">Social Login (Deprecated)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#google">Google</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#facebook">Facebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#github">GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#linkedin">LinkedIn</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Stormpath Error Codes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="errors.html#x-communication">110X: Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1100">Error 1100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1101">Error 1101</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-billing-payment">19XX: Billing / Payment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1900">Error 1900</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1902">Error 1902</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1903">Error 1903</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1904">Error 1904</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1905">Error 1905</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1906">Error 1906</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-1910">Error 1910</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-general-validation">2XXX: General Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2000">Error 2000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2001">Error 2001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2002">Error 2002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2003">Error 2003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2004">Error 2004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2005">Error 2005</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2006">Error 2006</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2007">Error 2007</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2008">Error 2008</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2009">Error 2009</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2010">Error 2010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2011">Error 2011</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2012">Error 2012</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2013">Error 2013</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2014">Error 2014</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2015">Error 2015</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2016">Error 2016</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2017">Error 2017</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2020">Error 2020</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2021">Error 2021</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2022">Error 2022</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2100">Error 2100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2101">Error 2101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2102">Error 2102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2103">Error 2103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2104">Error 2104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2105">Error 2105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2106">Error 2106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2107">Error 2107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-2108">Error 2108</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-custom-data">3XXX: Custom Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3000">Error 3000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3001">Error 3001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3002">Error 3002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3003">Error 3003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-3004">Error 3004</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#x-tenant">400X: Tenant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4001">Error 4001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4002">Error 4002</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-organization">4XXX: Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4520">Error 4520</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4600">Error 4600</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4601">Error 4601</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4602">Error 4602</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4603">Error 4603</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4604">Error 4604</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4605">Error 4605</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4606">Error 4606</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4608">Error 4608</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4610">Error 4610</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4612">Error 4612</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#id1">4614</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-4700">Error 4700</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-application">5XXX: Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5010">Error 5010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5100">Error 5100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5101">Error 5101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5102">Error 5102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5103">Error 5103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5104">Error 5104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5105">Error 5105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5106">Error 5106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5108">Error 5108</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5110">Error 5110</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5112">Error 5112</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5114">Error 5114</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5116">Error 5116</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5117">Error 5117</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5118">Error 5118</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5119">Error 5119</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5120">Error 5120</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5121">Error 5121</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5122">Error 5122</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-5200">Error 5200</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-directory">6XXX: Directory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6100">Error 6100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6101">Error 6101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6201">Error 6201</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6202">Error 6202</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-6203">Error 6203</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-account">7XXX: Account</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7100">Error 7100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7101">Error 7101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7102">Error 7102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7103">Error 7103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7104">Error 7104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7105">Error 7105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7106">Error 7106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7107">Error 7107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7200">Error 7200</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7201">Error 7201</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7202">Error 7202</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7205">Error 7205</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7206">Error 7206</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7301">Error 7301</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7500">Error 7500</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7501">Error 7501</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7502">Error 7502</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7503">Error 7503</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7504">Error 7504</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-7505">Error 7505</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-agent">9XXX: Agent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9000">Error 9000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9001">Error 9001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9002">Error 9002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9003">Error 9003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9004">Error 9004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9005">Error 9005</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-9006">Error 9006</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-oauth-errors">100XX: OAuth Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10010">Error 10010</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10011">Error 10011</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10012">Error 10012</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10013">Error 10013</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10014">Error 10014</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10015">Error 10015</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10016">Error 10016</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10017">Error 10017</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-saml-errors">101XX: SAML Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10100">Error 10100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10101">Error 10101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-10102">Error 10102</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-token-errors">110XX: Token Errors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11001">Error 11001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11002">Error 11002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11003">Error 11003</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11004">Error 11004</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-11005">Error 11005</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-id-site-jwt">120XX: ID Site JWT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-12001">Error 12001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-12002">Error 12002</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xx-smtp-server">130XX: SMTP Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13000">Error 13000</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13001">Error 13001</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13002">Error 13002</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13003">Error 13003</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="errors.html#xxx-multi-factor-authentication">13XXX: Multi-Factor Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13100">Error 13100</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13101">Error 13101</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13102">Error 13102</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13103">Error 13103</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13104">Error 13104</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13105">Error 13105</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13106">Error 13106</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13107">Error 13107</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13108">Error 13108</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13109">Error 13109</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13110">Error 13110</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13111">Error 13111</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13112">Error 13112</a></li>
<li class="toctree-l3"><a class="reference internal" href="errors.html#error-13113">Error 13113</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          

  

  
    <li class="toctree-l1">
      <a class="reference internal" href="/php/apidocs/">PHP API Reference</a>
    </li>
  


        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stormpath PHP Documentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>7. Using ID Site</li>
    <li class="wy-breadcrumbs-aside">
      
          
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-id-site">
<span id="idsite"></span><h1>7. Using ID Site<a class="headerlink" href="#using-id-site" title="Permalink to this headline"></a></h1>
<div class="section" id="what-is-an-id-site">
<h2>7.1. What is an ID Site?<a class="headerlink" href="#what-is-an-id-site" title="Permalink to this headline"></a></h2>
<p>Stormpath ID Site is a set of hosted and pre-built user interface screens that take care of common identity functions for your applications  log in, registration, and password reset. ID Site can be accessed via your own custom domain like <code class="docutils literal"><span class="pre">id.mydomain.com</span></code> and shared across multiple applications to create centralized authentication. It supports regular login to your Stormpath Directories, as well as Social and SAML login.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/id_site_screen.png"><img alt="ID Site Screenshot" src="_images/id_site_screen.png" /></a>
<p class="caption"><span class="caption-text"><em>An example ID Site</em></span></p>
</div>
<p>The screens and functionality of ID Site are completely customizable. You have full access to the source code of the ID Site screens so you can make simple changes like adding your own logo and changing CSS or more complex changes like adding fields, JavaScript code, screens, removing screens, and even changing how the screens behave.</p>
<div class="section" id="why-should-i-use-stormpath-id-site">
<h3>Why should I use Stormpath ID Site?<a class="headerlink" href="#why-should-i-use-stormpath-id-site" title="Permalink to this headline"></a></h3>
<p>Building, securing, and maintaining identity screens for your users is time consuming, full of security concerns, and often more complex than many developers estimate. Stormpath ID Site gives you and your development team peace of mind that you will have best in class user security quickly and easily, with very little code  minimizing risk to your project timeline.</p>
<p>Stormpath ID Site fully decouples your identity screens from your applications, making it incredibly easy to provide the same login / registration pages for multiple applications  achieving centralized user management and authentication with a clean and easy user experience.</p>
</div>
<div class="section" id="browser-support">
<h3>Browser Support<a class="headerlink" href="#browser-support" title="Permalink to this headline"></a></h3>
<p>ID Site will work in the following web browser environments:</p>
<ul class="simple">
<li>Chrome (all versions)</li>
<li>Internet Explorer 10+</li>
<li>Firefox 23+</li>
<li>Safari 8+</li>
<li>Android Browser, if Android version is 4.1 (Jellybean) or greater</li>
</ul>
</div>
</div>
<div class="section" id="how-does-id-site-work">
<h2>7.2. How does ID Site Work?<a class="headerlink" href="#how-does-id-site-work" title="Permalink to this headline"></a></h2>
<p>To demonstrate how ID Site works, we&#8217;ll use an example. Imagine you are building an application for managing Stormtrooper equipment  like awesome helmets and blasters. The application is &#8220;Imperial Exchange&#8221;, available at <code class="docutils literal"><span class="pre">https://imperialxchange.com/</span></code>, and it uses Stormpath ID Site for login and registration.</p>
<p>Once ImperialXchange.com is rendered by the browser, &#8220;Log In&#8221; and &#8220;Sign Up&#8221; links are available for the unauthenticated user. Clicking on these will call your server-side application at specific endpoints. For illustration, the &#8220;Log In&#8221; link will invoke <code class="docutils literal"><span class="pre">/login</span></code> and &#8220;Sign Up&#8221; will invoke <code class="docutils literal"><span class="pre">/register</span></code>. Your application will securely redirect the user to the ID Site along with a cryptographically signed JSON Web Token (JWT) that includes information like the Callback URI, the path to a specific ID Site page, and any State you think is important for your application.</p>
<p>On the ID Site, the user will enter their data and complete the appropriate action, like login. ID Site will automatically detect any Workflow or Social Login configurations set in Stormpath and show the appropriate buttons, messaging, and behavior.</p>
<p>After the user has logged-in successfully, they will be redirected back to your applications Callback URI. For illustration purposes, this could be <code class="docutils literal"><span class="pre">https://imperialxchange.com/idSiteResult</span></code>. When the ID Site redirects back to your application, it will pass a secure JWT that represents the account in Stormpath. Using the Stormpath SDK, your application will handle the request to <code class="docutils literal"><span class="pre">/idSiteResult</span></code>, validate that the JWT is correct, and return an <code class="docutils literal"><span class="pre">ID</span> <span class="pre">Site</span> <span class="pre">Account</span> <span class="pre">Result</span></code>. The <code class="docutils literal"><span class="pre">ID</span> <span class="pre">Site</span> <span class="pre">Account</span> <span class="pre">Result</span></code> will include the Stormpath Account object and additional information, such as any state that was passed by your application or whether or not the Account returned is newly created.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/id_site_flow.png"><img alt="ID Site Flow" src="_images/id_site_flow.png" /></a>
<p class="caption"><span class="caption-text"><em>The ID Site Flow</em></span></p>
</div>
</div>
<div class="section" id="idsite-set-up">
<span id="id-site-set-up"></span><h2>7.3. ID Site Set Up<a class="headerlink" href="#idsite-set-up" title="Permalink to this headline"></a></h2>
<p>For more information on this topic, please see the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/idsite.html#id-site-set-up">Admin Console Guide</a>.</p>
</div>
<div class="section" id="using-id-site-via-language">
<span id="idsite-with-rest"></span><h2>7.4. Using ID Site Via PHP<a class="headerlink" href="#using-id-site-via-language" title="Permalink to this headline"></a></h2>
<p>The Stormpath SDKs help developers quickly integrate communication from Stormpath&#8217;s ID Site to their application.</p>
<p>To use ID Site there are two flows that need to be implemented:</p>
<ol class="arabic simple">
<li>Getting a user to ID Site</li>
<li>Handling the Callback to your Application from ID Site</li>
</ol>
<p>So, let&#8217;s show you how to do exactly that!</p>
<div class="section" id="step-1-getting-a-user-to-id-site">
<span id="idsite-direct-user"></span><h3>Step 1: Getting a User to ID Site<a class="headerlink" href="#step-1-getting-a-user-to-id-site" title="Permalink to this headline"></a></h3>
<p>When a user wants to log into, or register for, your application, you will need to redirect them to your ID Site.</p>
<p>A typical set of steps in your application are as follows:</p>
<ol class="arabic simple">
<li>You render your application with a login button</li>
<li>The user clicks the login button which will send a request to your server</li>
<li>Your server will generate a JWT and include the valid information</li>
<li>Your server responds with an HTTP 302 which redirects the user to the ID Site SSO endpoint</li>
<li>Stormpath will redirect the user to your ID Site</li>
</ol>
<p>The PHP SDK has built-in functionality to generate a URL to redirect your users to for login.</p>
<p>To generate this URL, you need to first get access to your <code class="docutils literal"><span class="pre">Application</span></code> resource object:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$application</span> <span class="o">=</span> <span class="nv">$client</span>
                <span class="o">-&gt;</span><span class="na">dataStore</span>
                <span class="o">-&gt;</span><span class="na">getResource</span><span class="p">(</span>
                    <span class="s1">&#39;https://api.stormpath.com/v1/applications/16k5PC57Imx4nWXQXi74HO&#39;</span><span class="p">,</span>
                    <span class="nx">\Stormpath\Resource\Application</span><span class="o">::</span><span class="na">class</span>
                <span class="p">);</span>
</pre></div>
</div>
<p>Once you have your Account, you get access to a <code class="docutils literal"><span class="pre">createIdSiteUrl()</span></code> method.  This method is the core of the ID Site usage in the PHP SDK. It accepts one parameter, an options array.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Required?</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">callbackUri</span></code></td>
<td>Yes</td>
<td>The callback URI to use once the user takes an action on the ID Site. This must match a Authorized Callback URI on Application resource.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">path</span></code></td>
<td>No</td>
<td>The path on the ID Site that you want the user to land on. Use <code class="docutils literal"><span class="pre">/</span></code> for login page, <code class="docutils literal"><span class="pre">/#/register</span></code> for the sign up page, <code class="docutils literal"><span class="pre">/#/forgot</span></code> for the forgot password page, <code class="docutils literal"><span class="pre">/#/reset</span></code> for the password reset page.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>No</td>
<td>The state of the application that you need to pass through ID Site back to your application through the callback. It is up to the developer to serialize/deserialize this value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">organizationNameKey</span></code></td>
<td>No</td>
<td>The string representing the <code class="docutils literal"><span class="pre">nameKey</span></code> for an Organization that is an Account Store for your application. This is used for multi-tenant applications that use ID Site.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">showOrganizationField</span></code></td>
<td>No</td>
<td>A boolean representing if the &#8220;Organization&#8221; field should show on the forms that ID Site renders.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">useSubDomain</span></code></td>
<td>No</td>
<td>A boolean indicating whether the ID Site should be redirected to a subdomain based on an Organization nameKey.</td>
</tr>
</tbody>
</table>
<p>To use the <code class="docutils literal"><span class="pre">createIdSiteUrl()</span></code> method for login, you would need to first add the callback URI for your application. This callback URI is where ID Site is allowed to send the request back to and where you would handle the response. This will be explained in the next section.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$loginLink</span> <span class="o">=</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">createIdSiteUrl</span><span class="p">([</span>
    <span class="s1">&#39;callbackUri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;https://mysite.com/handleIdSiteCallback.php&#39;</span>
<span class="p">]);</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: &#39;</span> <span class="o">.</span> <span class="nv">$loginLink</span><span class="p">);</span> <span class="c1">// Or another form of redirect to generated URL</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The code above should be the only code for the login.  The <code class="docutils literal"><span class="pre">createIdSiteUrl()</span></code> method will set the issued at time.  These tokens do expire and will display errors if it is generated before the user clicks to login.</p>
</div>
</div>
<div class="section" id="step-2-handling-the-callback-to-your-application-from-id-site">
<h3>Step 2: Handling the Callback to your Application from ID Site<a class="headerlink" href="#step-2-handling-the-callback-to-your-application-from-id-site" title="Permalink to this headline"></a></h3>
<p>Once the user signs up or logs in to your application, they will be redirected back to your application&#8217;s configured Callback URI that was set in the JWT. In addition to the Callback URI, ID Site will include a <code class="docutils literal"><span class="pre">jwtResponse</span></code> parameter in the query. For example, if the specified Callback URI is <code class="docutils literal"><span class="pre">https://yourapp.com/dashboard</span></code> then the user will be redirected to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>https://yourapp.com/dashboard?jwtResponse={GENERATED_ID_SITE_ASSERTION_JWT}
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">jwtResponse</span></code> represents a JWT that provides a signed security assertion about who the user is and what they did on ID Site.</p>
<p>With the full URI that includes the <code class="docutils literal"><span class="pre">jwtResponse</span></code> query parameter, you will need to call the <code class="docutils literal"><span class="pre">handleIdSiteCallback()</span></code> method on the <code class="docutils literal"><span class="pre">Application</span></code> resource.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">handleIdSiteCallback</span><span class="p">(</span><span class="nv">$requestUri</span><span class="p">);</span>
</pre></div>
</div>
<p>This will result in a new <code class="docutils literal"><span class="pre">\StdClass</span></code> being returned with four properties:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">account</span></code></td>
<td>The Account resource that contains all information about the user who was just returned from ID Site.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">state</span></code></td>
<td>The state of your application, if you have chosen to have this passed back.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">isNew</span></code></td>
<td>If the Account is a new Account to the Application.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">status</span></code></td>
<td>The status of the request. Valid values for ID Site are <code class="docutils literal"><span class="pre">AUTHENTICATED</span></code>, <code class="docutils literal"><span class="pre">LOGOUT</span></code>, or <code class="docutils literal"><span class="pre">REGISTERED</span></code>.</td>
</tr>
</tbody>
</table>
<div class="section" id="exchanging-the-id-site-jwt-for-an-oauth-token">
<span id="idsite-jwt-to-oauth"></span><h4>Exchanging the ID Site JWT for an OAuth Token<a class="headerlink" href="#exchanging-the-id-site-jwt-for-an-oauth-token" title="Permalink to this headline"></a></h4>
<p>In some cases you may wish to exchange the ID Site assertion (JWT) for a Stormpath OAuth 2.0 token.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For background information, please see <a class="reference internal" href="auth_n.html#token-authn"><span>4.2. How Token-Based Authentication Works</span></a>.</p>
</div>
<p>In this situation, after the user has been authenticated via ID Site, a developer may want to control their authorization with an OAuth 2.0 Token. This is done by passing the JWT similar to the way we passed the user&#8217;s credentials as described in <a class="reference internal" href="auth_n.html#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>. The difference is that instead of using the <code class="docutils literal"><span class="pre">password</span></code> grant type and passing credentials, we will use the <code class="docutils literal"><span class="pre">stormpath_token</span></code> type and pass the JWT we got from ID Site.</p>
<p>Stormpath will validate the JWT (i.e. ensure that it has not been tampered with, is not expired, and the Account that it&#8217;s associated with is still valid) and then return an OAuth 2.0 Access Token:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$exchangeIdSiteTokenRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Stormpath\Oauth\ExchangeIdSiteTokenRequest</span><span class="p">(</span><span class="nv">$jwtResponse</span><span class="p">);</span>
<span class="nv">$auth</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Stormpath\Oauth\ExchangeIdSiteTokenAuthenticator</span><span class="p">(</span><span class="nx">app</span><span class="p">(</span><span class="s1">&#39;stormpath.application&#39;</span><span class="p">));</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">(</span><span class="nv">$exchangeIdSiteRequest</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nx">object</span><span class="p">(</span><span class="nx">Stormpath\Oauth\OauthGrantAuthenticationResult</span><span class="p">)</span>
<span class="k">private</span> <span class="s1">&#39;accessToken&#39;</span> <span class="o">=&gt;</span>
<span class="nx">object</span><span class="p">(</span><span class="nx">Stormpath\Resource\AccessToken</span><span class="p">)</span>
<span class="k">public</span> <span class="s1">&#39;href&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;https://api.stormpath.com/v1/accessTokens/2HQNpNVD124O8muiSpOMro&#39;</span>

<span class="k">private</span> <span class="s1">&#39;accessTokenString&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;eyJraWQiOiIxUE4zRlhJMFU3OUUyTUhDRjZYVVlH...&#39;</span>

<span class="k">private</span> <span class="s1">&#39;refreshToken&#39;</span> <span class="o">=&gt;</span>
<span class="nx">object</span><span class="p">(</span><span class="nx">Stormpath\Resource\RefreshToken</span><span class="p">)</span>
<span class="k">public</span> <span class="s1">&#39;href&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;https://api.stormpath.com/v1/accessTokens/2HQNpNVD124O8muiSpOMro&#39;</span>

<span class="k">private</span> <span class="s1">&#39;refreshTokenString&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;eyJraWQiOiIxUE4zRlhJMFU3OUUyTUhDRjZYVVlH...&#39;</span> <span class="c1">// JWT truncated for space</span>
<span class="k">private</span> <span class="s1">&#39;accessTokenHref&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;https://api.stormpath.com/v1/accessTokens/2HQNpNVD124O8muiSpOMro&#39;</span>
<span class="k">private</span> <span class="s1">&#39;tokenType&#39;</span> <span class="o">=&gt;</span> <span class="nx">string</span> <span class="s1">&#39;Bearer&#39;</span>
<span class="k">private</span> <span class="s1">&#39;expiresIn&#39;</span> <span class="o">=&gt;</span> <span class="nx">int</span> <span class="mi">1800</span>
</pre></div>
</div>
<p>For more information about Stormpath&#8217;s OAuth 2.0 tokens, please see <a class="reference internal" href="auth_n.html#generate-oauth-token"><span>Generating an OAuth 2.0 Access Token</span></a>.</p>
</div>
</div>
<div class="section" id="step-3-optional-logging-out-of-id-site">
<h3>Step 3: (Optional) Logging Out of ID Site<a class="headerlink" href="#step-3-optional-logging-out-of-id-site" title="Permalink to this headline"></a></h3>
<p>ID Site will keep a configurable session for authenticated users. When a user is sent from your application to ID Site, it will confirm that the session is still valid for the user. If it is, they will be automatically redirected to the <code class="docutils literal"><span class="pre">cb_uri</span></code>. This <code class="docutils literal"><span class="pre">cb_uri</span></code> can be the originating application or any application supported by a Stormpath SDK.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$application</span> <span class="o">=</span> <span class="nx">\Stormpath\Resource\Application</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;{APPLICATION_ID}&#39;</span><span class="p">);</span>
<span class="nv">$logoutLink</span> <span class="o">=</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">createIdSiteUrl</span><span class="p">([</span><span class="s1">&#39;logout&#39;</span><span class="o">=&gt;</span><span class="k">true</span><span class="p">,</span> <span class="s1">&#39;callbackUri&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;{CALLBACK_URI}&#39;</span><span class="p">]);</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location:&#39;</span><span class="o">.</span><span class="nv">$logoutLink</span><span class="p">);</span>  <span class="c1">//or any other form of redirect to the $loginLink you want to use.</span>
</pre></div>
</div>
<p>Once the user is logged out of ID Site, they are automatically redirected to the <code class="docutils literal"><span class="pre">cb_uri</span></code> which was specified in the JWT.</p>
<p>From here, you handle it the same as any other ID Site callback.  The difference here is that you should guarantee the status is <code class="docutils literal"><span class="pre">LOGOUT</span></code> from the returned object and then remove any stored cookies associated with the session.</p>
</div>
<div class="section" id="resetting-your-password-with-id-site">
<span id="idsite-password-reset"></span><h3>Resetting Your Password with ID Site<a class="headerlink" href="#resetting-your-password-with-id-site" title="Permalink to this headline"></a></h3>
<p>The Account Management chapter has an overview of <a class="reference internal" href="accnt_mgmt.html#password-reset-flow"><span>Password Reset</span></a> in Stormpath. In that flow, a user chooses to reset their password, then receives an email with a link to a page on your application that allows them to set a new password.</p>
<p>If you are using ID Site for login, then it stands to reason that you would want them to land on your ID Site for password reset as well. All you have to do is send the user to ID Site with a special path (<code class="docutils literal"><span class="pre">/#/reset</span></code>) and a claim containing the password reset token from the email link.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$location</span> <span class="o">=</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">createIdSiteUrl</span><span class="p">([</span>
  <span class="s1">&#39;path&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;/#/reset&#39;</span><span class="p">,</span>
  <span class="s1">&#39;sp_token&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;{{SP_TOKEN}}&#39;</span><span class="p">,</span>
  <span class="s1">&#39;callbackUri&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;https://mysite.com/handleIdSiteCallback.php&#39;</span>
<span class="p">]);</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location:&#39;</span> <span class="o">.</span> <span class="nv">$location</span><span class="p">);</span>  <span class="c1">//or any other form of redirect to the $loginLink you want to use.</span>
</pre></div>
</div>
<p>The above <code class="docutils literal"><span class="pre">{{SP_TOKEN}}</span></code> is the token that the user received from the forgot password email.</p>
</div>
</div>
<div class="section" id="using-id-site-for-multi-tenancy">
<span id="idsite-multitenancy"></span><h2>7.5. Using ID Site for Multi-tenancy<a class="headerlink" href="#using-id-site-for-multi-tenancy" title="Permalink to this headline"></a></h2>
<p>If you are <a class="reference internal" href="multitenancy.html#create-org"><span>using Organizations to model multi-tenancy</span></a>, then you will want to map these as Account Stores for your Application.</p>
<p>From that point, ID Site is able to handle either of the multi-tenant user routing methods described in <a class="reference internal" href="multitenancy.html#multitenancy-routing-users"><span>the Multi-tenancy Chapter</span></a>.</p>
<p>In the <code class="docutils literal"><span class="pre">options</span></code> array that can be passed in the <code class="docutils literal"><span class="pre">createIdSiteUri()</span></code>, there are a couple properties that can be used in this array to allow for multi-tenancy.</p>
<p><strong>Organization nameKey</strong></p>
<p><code class="docutils literal"><span class="pre">organizationNameKey</span></code>: Allows you to specify an Organization&#8217;s <code class="docutils literal"><span class="pre">namekey</span></code>. The user is sent to the ID Site for that Organization, and is forced to log in to that Organization.</p>
<p><strong>Show Organization Field</strong></p>
<p><code class="docutils literal"><span class="pre">showOrganizationField</span></code>: Toggles the &#8220;Organization&#8221; field on and off on ID Site. Used on its own, it will allow the user to specify the Organization that they would like to log in to.</p>
<div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="_images/id_site_sof_empty.png"><img alt="ID Site with sof toggled on" src="_images/id_site_sof_empty.png" /></a>
<p class="caption"><span class="caption-text"><em>ID Site with Organization field on and prepopulated</em></span></p>
</div>
<p>If combined with <code class="docutils literal"><span class="pre">organizationNameKey</span></code>, this will pre-populate that field with the Organization&#8217;s name.</p>
<div class="figure align-center" id="id12">
<a class="reference internal image-reference" href="_images/id_site_sof_prepop.png"><img alt="ID Site with sof and onk toggled on" src="_images/id_site_sof_prepop.png" /></a>
<p class="caption"><span class="caption-text"><em>ID Site with Organization field on and prepopulated</em></span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Stormpath will only show the field when you have at least one Organization mapped as an Account Store for your Application.</p>
</div>
<p><strong>Use Sub-Domain</strong></p>
<p><code class="docutils literal"><span class="pre">useSubDomain</span></code>: If combined with <code class="docutils literal"><span class="pre">organizationNameKey</span></code>, will redirect the user to an ID Site with the Organization&#8217;s <code class="docutils literal"><span class="pre">nameKey</span></code> as a sub-domain in its URL.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This functionality will only work with a custom domain that you&#8217;ve properly configured in ID Site as documented <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/idsite.html#setting-your-own-custom-domain-name-and-ssl-certificate">here</a>. The claim will not work with the default domain assigned by Stormpath.</p>
</div>
<p>For example, if your ID Site configuration is <code class="docutils literal"><span class="pre">id.mydomain.com</span></code> and the Organizations <code class="docutils literal"><span class="pre">nameKey</span></code> is <code class="docutils literal"><span class="pre">home-depot</span></code>, then the SSO endpoint will resolve the following URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>https://home-depot.id.mydomain.com/?jwt={GENERATED_JWT}
</pre></div>
</div>
<p>If you are using a custom domain, you must also make sure to put that domain in the list of Authorized Javascript Origin URLs. You can use the <code class="docutils literal"><span class="pre">*</span></code> wildcard for this. In the above example it would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>https://*.id.mydomain.com
</pre></div>
</div>
</div>
<div class="section" id="idsite-sso">
<span id="id-site-single-sign-on"></span><h2>7.6. ID Site &amp; Single Sign-On<a class="headerlink" href="#idsite-sso" title="Permalink to this headline"></a></h2>
<p>One of the areas where ID Site really shines is if you have multiple applications that need to support single sign-on. All you need to do is to ensure that all your Applications have the same Directory mapped as an Account Store, and any time a user in that Directory logs in to one Application via ID Site, they will be able be authenticated for all other Applications.</p>
<p>As an overview, the flow would look like this:</p>
<ol class="arabic simple">
<li>User goes to Application A while unauthenticated with that application and clicks on &#8220;Log in&#8221;.</li>
<li>User is redirected to ID Site.</li>
<li>User authenticates successfully on ID Site.</li>
<li>ID Site redirects the user back to Application A with an ID Site Assertion for Application A.</li>
<li>At this point you could (optionally) <a class="reference internal" href="#idsite-jwt-to-oauth"><span>exchange the ID Site JWT for an OAuth token</span></a>.</li>
<li>User now goes to Application B while unauthenticated with that application and clicks on &#8220;Log in&#8221;.</li>
<li>User is redirected to ID Site.</li>
<li>ID Site detects the user&#8217;s authenticated session and redirects them back to Application B with an ID Site Assertion for Application B.</li>
</ol>
</div>
<div class="section" id="idsite-hosting">
<span id="id-site-hosting-guide"></span><h2>7.7. ID Site Hosting Guide<a class="headerlink" href="#idsite-hosting" title="Permalink to this headline"></a></h2>
<p>For more information about hosting ID Site yourself, please see the <a class="reference external" href="https://docs.stormpath.com/console/product-guide/latest/idsite.html#hosting-id-site-yourself">Stormpath Admin Console Guide</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="REST API Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multitenancy.html" class="btn btn-neutral" title="6. Multi-Tenancy with Stormpath" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Stormpath, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/javascript_for_java.js"></script>
      <script type="text/javascript" src="_static/langpicker.js"></script>
      <script type="text/javascript" src="_static/scrollspy.js"></script>
      <script type="text/javascript" src="_static/gumshoe.min.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  

</body>
</html>