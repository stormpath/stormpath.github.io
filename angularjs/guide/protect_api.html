

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configure the Server &mdash; Stormpath AngularJS + Yeoman Guide 0.0.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Stormpath AngularJS + Yeoman Guide 0.0.2 documentation" href="index.html"/>
        <link rel="next" title="Configure the Angular App" href="configure_angular.html"/>
        <link rel="prev" title="Create a Stormpath Tenant" href="create_tenant.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Stormpath AngularJS + Yeoman Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-we-re-building">What We&#8217;re Building</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#example-project">Example Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#how-to-get-support">How to get Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="create_new_project.html">Creating a Fullstack Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="create_new_project.html#installing-node-grunt-bower-and-yeoman">Installing Node, Grunt, Bower and Yeoman</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_new_project.html#create-an-angular-fullstack-project">Create an Angular-Fullstack Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_new_project.html#install-the-stormpath-packages">Install the Stormpath Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_new_project.html#upgrade-express">Upgrade Express</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_new_project.html#git-tracking">Git Tracking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="create_tenant.html">Create a Stormpath Tenant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="create_tenant.html#sign-up-for-stormpath">Sign up for Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_tenant.html#create-an-api-key-pair">Create an API Key Pair</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_tenant.html#create-a-stormpath-application">Create a Stormpath Application</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Configure the Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-environment-variables">Setting Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#require-the-stormpath-module">Require the Stormpath Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reload-the-app">Reload the App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configure_angular.html">Configure the Angular App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configure_angular.html#add-stormpath-to-the-angular-application">Add Stormpath to the Angular Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure_angular.html#configure-the-ui-router-integration">Configure the UI Router Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="customize_menu.html">Customize the Menu</a><ul>
<li class="toctree-l2"><a class="reference internal" href="customize_menu.html#modify-navbar-html">Modify navbar.html</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="login.html">Create the Login Form</a><ul>
<li class="toctree-l2"><a class="reference internal" href="login.html#generate-the-login-route">Generate the /login Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#use-the-login-form-directive">Use the Login Form Directive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="register.html">Create the Registration Form</a><ul>
<li class="toctree-l2"><a class="reference internal" href="register.html#generate-the-register-route">Generate the /register Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#add-the-registration-form-directive">Add the Registration Form Directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#generate-the-verify-route">Generate the /verify Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#add-the-sptoken-parameter">Add the sptoken Parameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#use-the-email-verification-directive">Use the Email Verification Directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#configure-the-directory">Configure the Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#try-it-register-for-an-account">Try It, Register for an Account!</a></li>
<li class="toctree-l2"><a class="reference internal" href="register.html#customizing-the-form">Customizing the Form</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_profile.html">Create the Profile View</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user_profile.html#generate-the-profile-route">Generate the /profile Route</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_profile.html#force-authentication">Force Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_profile.html#create-the-view">Create the View</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_profile.html#try-it-out-see-your-profile">Try It Out, See Your Profile!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="password_reset.html">Password Reset Flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="password_reset.html#generate-the-routes">Generate the Routes</a></li>
<li class="toctree-l2"><a class="reference internal" href="password_reset.html#add-the-sptoken-parameter">Add the sptoken Parameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="password_reset.html#use-the-password-reset-directives">Use the Password Reset Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="password_reset.html#configure-the-directory">Configure the Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="password_reset.html#try-it-reset-your-password">Try It, Reset your Password!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="access_control.html">Access Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="access_control.html#ui-state-control">UI State Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="access_control.html#helper-directives">Helper Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="access_control.html#api-security">API Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wait_for_user.html">Waiting For User State</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wait_for_user.html#use-the-waitforuser-option">Use the waitForUser Option</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="coming_soon.html">Coming Soon!</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Stormpath AngularJS + Yeoman Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Configure the Server</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/protect_api.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="configure-the-server">
<span id="protect-api"></span><h1>Configure the Server<a class="headerlink" href="#configure-the-server" title="Permalink to this headline">¶</a></h1>
<p>In the previous section, <a class="reference internal" href="create_new_project.html#create-new-project"><em>Creating a Fullstack Project</em></a>, we created a simple
Express.js and installed the <a class="reference external" href="https://github.com/stormpath/express-stormpath">Stormpath Express Module</a>.  We are going to use that
SDK to secure the API endpoints in the Express server.</p>
<div class="section" id="setting-environment-variables">
<h2>Setting Environment Variables<a class="headerlink" href="#setting-environment-variables" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/stormpath/express-stormpath">Stormpath Express Module</a> needs the API Key and Application information that
we collected in the section <a class="reference internal" href="create_tenant.html#create-tenant"><em>Create a Stormpath Tenant</em></a>.  We will provide this
information to the SDK by exporting it to the environment.</p>
<p>You can manually export the values to the environment by using the <tt class="docutils literal"><span class="pre">export</span></tt>
or <tt class="docutils literal"><span class="pre">set</span></tt> commands in your terminal.</p>
<p><strong>Unix/Linux/Mac</strong>:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kr">export</span> <span class="nx">STORMPATH_CLIENT_APIKEY_ID</span><span class="o">=</span><span class="nx">xxxx</span>
<span class="kr">export</span> <span class="nx">STORMPATH_CLIENT_APIKEY_SECRET</span><span class="o">=</span><span class="nx">xxxx</span>
<span class="kr">export</span> <span class="nx">STORMPATH_APPLICATION_HREF</span><span class="o">=</span><span class="nx">xxxx</span>
</pre></div>
</div>
<p><strong>Windows</strong>:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">set</span> <span class="nx">STORMPATH_CLIENT_APIKEY_ID</span><span class="o">=</span><span class="nx">xxxx</span>
<span class="nx">set</span> <span class="nx">STORMPATH_CLIENT_APIKEY_SECRET</span><span class="o">=</span><span class="nx">xxxx</span>
<span class="nx">set</span> <span class="nx">STORMPATH_APPLICATION_HREF</span><span class="o">=</span><span class="nx">xxxx</span>
</pre></div>
</div>
</div>
<div class="section" id="require-the-stormpath-module">
<h2>Require the Stormpath Module<a class="headerlink" href="#require-the-stormpath-module" title="Permalink to this headline">¶</a></h2>
<p>Open the file <tt class="docutils literal"><span class="pre">server/app.js</span></tt>.  This file is the entry point for our API
server, it will run the server.</p>
<p>We want to initialize the Stormpath middleware and add it before our API
declaration, so that the API will be automatically protected.</p>
<p>First things first, you need to require the SDK - place this at the top of the
file, under the other require statements:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">ExpressStormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>We&#8217;re also going to use the <tt class="docutils literal"><span class="pre">path</span></tt>, so you should require that as well:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Then you want to create an instance of the Stormpath middleware.  You can pass
options, but in our case, we are just going to make a simple call and use all
the default options.  Add this line after the <tt class="docutils literal"><span class="pre">var</span> <span class="pre">app</span> <span class="pre">=</span> <span class="pre">express();</span></tt> statement:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">ExpressStormpath</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">,{</span>
  <span class="nx">website</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">web</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">spaRoot</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span><span class="s1">&#39;client&#39;</span><span class="p">,</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}));</span>
</pre></div>
</div>
<p>That block of code will attach Stormpath to your Express application, and let
Stormpath know where the root of your Angular application is (the folder
where all of the Angular assets live)</p>
<p>Open the file <tt class="docutils literal"><span class="pre">server/routes.js</span></tt>.</p>
<p>This file is attaching some routes to the Express application that is setup in
<tt class="docutils literal"><span class="pre">server/app.js</span></tt>.  You&#8217;ll want to require <tt class="docutils literal"><span class="pre">express-stormpath</span></tt> again, and then
use it to secure your API:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">ExpressStormpath</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-stormpath&#39;</span><span class="p">);</span>

<span class="c1">// ..</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/things&#39;</span><span class="p">,</span> <span class="nx">ExpressStormpath</span><span class="p">.</span><span class="nx">loginRequired</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./api/thing&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="reload-the-app">
<h2>Reload the App<a class="headerlink" href="#reload-the-app" title="Permalink to this headline">¶</a></h2>
<p>Restart the server by running <tt class="docutils literal"><span class="pre">grunt</span> <span class="pre">serve</span></tt> again.  You should now see that
the features are no longer listed - this is because the endpoint fails to load
with a <tt class="docutils literal"><span class="pre">401</span> <span class="pre">Unauthorized</span></tt> - you can see this by looking inside the web console
in your browser:</p>
<img alt="_images/features-unauthorized.png" src="_images/features-unauthorized.png" />
<p>Our API is now protected from unauthorized, anonymous access.  In the next two
sections, we will show you how to create a registration form and a login form.
At that point, you will be able to login and have access to the API.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configure_angular.html" class="btn btn-neutral float-right" title="Configure the Angular App">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_tenant.html" class="btn btn-neutral" title="Create a Stormpath Tenant"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>