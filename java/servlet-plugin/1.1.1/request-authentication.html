

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HTTP Request Authentication &mdash; Stormpath Java Servlet Plugin 1.1.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Stormpath Java Servlet Plugin 1.1.1 documentation" href="index.html"/>
        <link rel="next" title="Request Context" href="request.html"/>
        <link rel="prev" title="Logout" href="logout.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  
  <script src="https://cdn.optimizely.com/js/225847041.js"></script>

  
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '986262161469311');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=986262161469311&ev=PageView&noscript=1"
  /></noscript>
</head>

<body class="wy-body-for-nav" role="document">

  
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NQZZFW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NQZZFW');</script>

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Stormpath Java Servlet Plugin
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-stormpath">What is Stormpath?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-the-project">What is the Stormpath Java Servlet Plugin?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#who-should-use-stormpath">Who should use Stormpath?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#get-an-api-key">Get an API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#add-the-stormpath-java-servlet-plugin">Add the Stormpath Java Servlet Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#try-it">Try it!</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#no-config">No Config?</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#web-xml">web.xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#stormpath-properties">stormpath.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#stormpath-client">Stormpath Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#stormpath-application">Stormpath Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#filters">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#uris">URIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="registration.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#form-fields">Form Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#i18n">i18n</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#email-verification">Email Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#events">Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="login.html">Login</a><ul>
<li class="toctree-l2"><a class="reference internal" href="login.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#security-notice">Security Notice</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#i18n">i18n</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#authentication-state">Authentication State</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="social.html">Social Login</a><ul>
<li class="toctree-l2"><a class="reference internal" href="social.html#facebook-login">Facebook Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="social.html#google-login">Google Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="social.html#linkedin-login">LinkedIn Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="social.html#json-api">JSON API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="forgot-password.html">Forgot Password</a><ul>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#configure-the-workflow">Configure the Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#try-it">Try it!</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#forgot-uri">Forgot URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#forgot-next-uri">Forgot Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#change-password-uri">Change Password URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#change-password-next-uri">Change Password Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#i18n">i18n</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logout.html">Logout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="logout.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="logout.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="logout.html#events">Events</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HTTP Request Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#http-basic-authentication">HTTP Basic Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#token-authentication">Token Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-key-authentication">API Key Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Request Context</a><ul>
<li class="toctree-l2"><a class="reference internal" href="request.html#current-user-account">Current User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html#stormpath-application">Stormpath Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html#stormpath-client">Stormpath Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="access-control.html">Access Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="access-control.html#authentication">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="access-control.html#exclusions">Exclusions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization (i18n)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#languages">Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#request-locale">Request Locale</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#jsp-tag-library">JSP Tag Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#i18n-properties">i18n.properties</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a><ul>
<li class="toctree-l2"><a class="reference internal" href="events.html#requesteventlistener">RequestEventListener</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html#id2">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html#listener-best-practices">Listener Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="caching.html#in-process-cache">In-Process Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html#disable-caching">Disable Caching</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="idsite.html">ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#how-does-it-work">How Does It Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#enable-id-site">Enable ID Site</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#configure-your-application">Configure Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#try-it">Try It!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Custom Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views.html#jsp-views">JSP Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#css">CSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#internationalization-i18n">Internationalization (i18n)</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#change-a-default-view">Change a Default View</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#view-template">View Template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix/web-stormpath-properties.html">web.stormpath.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/i18n-properties.html">i18n.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/stormpath-css.html">stormpath.css</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Stormpath Java Servlet Plugin</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>HTTP Request Authentication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <blockquote>
<div></div></blockquote>
<div class="section" id="http-request-authentication">
<span id="request-authentication"></span><h1>HTTP Request Authentication<a class="headerlink" href="#http-request-authentication" title="Permalink to this headline">¶</a></h1>
<p>In addition to supporting a traditional server-side rendered <a class="reference internal" href="login.html#login"><span class="std std-ref">login</span></a> form, the Stormpath Java Servlet Plugin also supports various HTTP request authentication schemes out of the box.  By default, this includes:</p>
<ul class="simple">
<li>HTTP Basic Authentication</li>
<li>Password-based Bearer Token Authentication for Javascript clients and Single Page Applications (SPA) and mobile clients</li>
<li>API Key authentication for machine clients (other servers or code libraries) that execute on behalf of a user account.</li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#http-basic-authentication" id="id2">HTTP Basic Authentication</a></li>
<li><a class="reference internal" href="#token-authentication" id="id3">Token Authentication</a><ul>
<li><a class="reference internal" href="#get-a-token" id="id4">Get a Token</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-key-authentication" id="id5">API Key Authentication</a><ul>
<li><a class="reference internal" href="#determining-api-key-authentication" id="id6">Determining API Key Authentication</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="http-basic-authentication">
<h2><a class="toc-backref" href="#id2">HTTP Basic Authentication</a><a class="headerlink" href="#http-basic-authentication" title="Permalink to this headline">¶</a></h2>
<p>Any HTTP request that uses the <a class="reference external" href="http://tools.ietf.org/html/rfc2617#section-2">HTTP Basic Authentication</a> protocol will be authenticated automatically.</p>
<p>For example, using curl:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl -u LOGIN:PASSWORD http://localhost:8080/
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">LOGIN</span></code> is the Account <code class="docutils literal"><span class="pre">username</span></code> <em>or</em> <code class="docutils literal"><span class="pre">email</span></code> address.</li>
<li><code class="docutils literal"><span class="pre">PASSWORD</span></code> is the Account password</li>
</ul>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>HTTPS Required</p>
<p class="last">HTTP Basic authentication sends the <em>raw</em> user password over the network.  Basic Authentication should only be used over HTTPS connections and never over standard HTTP.</p>
</div>
</div>
<div class="section" id="token-authentication">
<h2><a class="toc-backref" href="#id3">Token Authentication</a><a class="headerlink" href="#token-authentication" title="Permalink to this headline">¶</a></h2>
<p>Token Authentication, also called &#8216;Bearer Token Authentication&#8217;, is a convenient authentication mechanism for user interfaces that are not based on traditional server-side rendered pages, for example, Javascript clients or Single Page Applications (SPAs).</p>
<p>Many times, these clients communicate with your application via a REST API and need to authenticate every request.  (Bearer) Token Authentication helps solve this challenge.</p>
<p>A common use case is as follows:</p>
<ol class="arabic">
<li><p class="first">A rich client (JS/HTML/CSS) is loaded in a user&#8217;s browser or a mobile application starts.</p>
</li>
<li><p class="first">The client-side UI collects the user&#8217;s username (or email address) and password, for example via a form.</p>
</li>
<li><p class="first">The client-side UI submits the username/email and password pair to your server-side web application, typically as an AJAX HTTPS request.</p>
</li>
<li><p class="first">The Stormpath Java Servlet Plugin will ensure the client is allowed to make the request and then authenticates the submitted credentials.</p>
</li>
<li><p class="first">If the authentication is successful, a &#8216;bearer token&#8217; will be returned in the HTTP response to the Javascript application.</p>
</li>
<li><p class="first">The client-side UI will send this bearer token over HTTPS on every future request, either in a cookie, or the request&#8217;s <code class="docutils literal"><span class="pre">Authorization</span></code> header, or both.  For example:</p>
<div class="highlight-rest"><div class="highlight"><pre><span></span>Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NTI0ODhlZ ... etc ...
</pre></div>
</div>
</li>
</ol>
<p>Under the hood, the Stormpath Java Servlet Plugin implements this behavior according to the OAuth 2 specification.  It implements the entire OAuth 2 &#8216;password grant&#8217; flow for you -  you don&#8217;t have to implement any of this logic at all!</p>
<p>There is an added benefit to this design: you don&#8217;t need server-side sessions to retain user identity state.  Server-stateless applications can often scale better than those with sessions since state does not need to be shared or clustered across server nodes.</p>
<div class="section" id="get-a-token">
<h3><a class="toc-backref" href="#id4">Get a Token</a><a class="headerlink" href="#get-a-token" title="Permalink to this headline">¶</a></h3>
<p>An http client or user agent (or Single Page Application) must first authenticate to receive an authentication Token.  To do this, send a form <code class="docutils literal"><span class="pre">POST</span></code> request (i.e. a <code class="docutils literal"><span class="pre">Content-Type</span></code> of <code class="docutils literal"><span class="pre">application/x-www-form-urlencoded</span></code>) to <code class="docutils literal"><span class="pre">/oauth/token</span></code>.</p>
<div class="section" id="curl">
<h4>cURL<a class="headerlink" href="#curl" title="Permalink to this headline">¶</a></h4>
<p>For example with cURL:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl -X POST --data <span class="s1">&#39;grant_type=password&amp;username=ACCOUNT_USERNAME&amp;password=ACCOUNT_PASSWORD&#39;</span> <span class="se">\</span>
     -H <span class="s1">&#39;Origin: http://localhost:8080&#39;</span> http://localhost:8080/oauth/token
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">ACCOUNT_USERNAME</span></code> is the username or email address of an account that may login to your application</li>
<li><code class="docutils literal"><span class="pre">ACCOUNT_PASSWORD</span></code> is the account&#8217;s password</li>
</ul>
<p>Tip: In the <code class="docutils literal"><span class="pre">--data</span></code> argument value, don&#8217;t forget to URL-encode special characters.  For example, if specifying an email, you would specify <code class="docutils literal"><span class="pre">foo%40bar.com</span></code> (correct) instead of <code class="docutils literal"><span class="pre">foo&#64;bar.com</span></code> (incorrect).</p>
<p>The response body will be an OAuth 2 response, for example:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
  <span class="nt">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NTI0ODhlZi00NWU4LTQ1NTMtOTRiNS0xMTM2NTY2ZGFhOTIiLCJpYXQiOjE0MjE3ODQ3NjYsInN1YiI6Imh0dHBzOi8vYXBpLnN0b3JtcGF0aC5jb20vdjEvYWNjb3VudHMvNDE5MndEaEx6ejFjVnFLdk44b1p4NyIsImV4cCI6MTQyMTc4ODM2Nn0._I4wlDRML6GfgZEL_qjmTDVh0a-qfP20CB7v7IgFwAc&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">access_token</span></code> value is the Bearer Token to send back on future requests in the <code class="docutils literal"><span class="pre">Authorization</span></code> header.  For example, assuming the above:</p>
<div class="highlight-rest"><div class="highlight"><pre><span></span>Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NTI0ODhlZi00NWU4LTQ1NTMtOTRiNS0xMTM2NTY2ZGFhOTIiLCJpYXQiOjE0MjE3ODQ3NjYsInN1YiI6Imh0dHBzOi8vYXBpLnN0b3JtcGF0aC5jb20vdjEvYWNjb3VudHMvNDE5MndEaEx6ejFjVnFLdk44b1p4NyIsImV4cCI6MTQyMTc4ODM2Nn0._I4wlDRML6GfgZEL_qjmTDVh0a-qfP20CB7v7IgFwAc
</pre></div>
</div>
<p>For example, with cURL (the value is shortened for brevity):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl -H <span class="s1">&#39;Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0NTI0ODhlZ...&#39;</span> http://localhost:8080
</pre></div>
</div>
<p>that the actual <code class="docutils literal"><span class="pre">Authorization</span></code> header value is the string literal <code class="docutils literal"><span class="pre">Bearer</span></code>, followed by a space character, followed by the actual token value string.</p>
</div>
<div class="section" id="html-form-and-ajax">
<h4>HTML Form and AJAX<a class="headerlink" href="#html-form-and-ajax" title="Permalink to this headline">¶</a></h4>
<p>You can also do the same thing in a browser with a form and ajax:</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ajaxLoginForm&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;${pageContext.request.contextPath}/oauth/token&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;username&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">autofocus</span><span class="o">=</span><span class="s">&quot;autofocus&quot;</span> <span class="na">required</span><span class="o">=</span><span class="s">&quot;required&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">required</span><span class="o">=</span><span class="s">&quot;required&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;grant_type&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Log In<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Here is an example JQuery snippet that will process the form submission (ideally this is defined after the form, e.g. at the bottom of the page):</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>

  <span class="kd">var</span> <span class="nx">frm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ajaxLoginForm&#39;</span><span class="p">);</span>

  <span class="nx">frm</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ev</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">frm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">),</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">frm</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">),</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">frm</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(),</span>

      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&quot;${pageContext.request.contextPath}/dashboard&quot;</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">jqXHR</span><span class="p">,</span> <span class="nx">statusString</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;login attempt failed.  Please try again.&#39;</span><span class="p">);</span>
      <span class="p">}</span>

    <span class="p">});</span>

    <span class="nx">ev</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

  <span class="p">});</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>The Bearer Token will be saved as a secure, http-only cookie and sent back to the server on all future requests.  The Starter knows how to look for this cookie to authenticate the request.</p>
<p>Or, if you prefer, your JavaScript code can inspect the HTTP response body and get the <code class="docutils literal"><span class="pre">access_token</span></code> value and then set the <code class="docutils literal"><span class="pre">Authorization</span></code> header with the value on future requests.  For example:</p>
<div class="highlight-rest"><div class="highlight"><pre><span></span>Authorization: Bearer ACCESS_TOKEN_VALUE
</pre></div>
</div>
<p>Note that the actual <code class="docutils literal"><span class="pre">Authorization</span></code> header value is the string literal <code class="docutils literal"><span class="pre">Bearer</span></code>, followed by a space character, followed by the actual token value string.</p>
</div>
<div class="section" id="origin-or-referer-required">
<h4>Origin or Referer Required<a class="headerlink" href="#origin-or-referer-required" title="Permalink to this headline">¶</a></h4>
<p>Requests to obtain a Bearer Token must have an <code class="docutils literal"><span class="pre">Origin</span></code> or <code class="docutils literal"><span class="pre">Referer</span></code> header (Origin is preferred) and these header values must match one or more configured &#8216;base URLs&#8217;.</p>
<p>By default, requests will be allowed if the JavaScript client is loaded from the same base URL as your web application (specifically, the client-requested host has the same base URL as what is the browser sets in the <code class="docutils literal"><span class="pre">Origin</span></code> and <code class="docutils literal"><span class="pre">Referer</span></code> header values).</p>
<p>If you want to specify additional hosts that are permitted to run JavaScript that may access your server, you can specify a configuration property:</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">stormpath.web.login.token.authorizedJavaScriptOriginUris</span> <span class="o">=</span> <span class="s">http://localhost https://localhost http://localhost:8080 https://localhost:8080</span>
</pre></div>
</div>
<p>The value is a whitespace-delimited list of base URLS.  Each base URL value must be formatted as follows:</p>
<ul class="simple">
<li>The request scheme (<code class="docutils literal"><span class="pre">http</span></code> or <code class="docutils literal"><span class="pre">https</span></code>), followed by:</li>
<li>The protocol separator, i.e. <code class="docutils literal"><span class="pre">://</span></code>, followed by:</li>
<li>The allowed origin host IP or host name</li>
<li>If a port must be specified:<ul>
<li>The port separator, i.e. <code class="docutils literal"><span class="pre">:</span></code>, followed by:</li>
<li>The port number</li>
</ul>
</li>
</ul>
<p>No additional information such as a URI path or query may be specified.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Any Browser JavaScript client launched from a URL that matches one of the specified base URIs may communicate with your web application.  Only specify additional web host URLs that you trust to communicate with your web application.</p>
</div>
</div>
<div class="section" id="https-required">
<h4>HTTPS Required<a class="headerlink" href="#https-required" title="Permalink to this headline">¶</a></h4>
<p>It is <em>not safe</em> to request a new token over standard HTTP connections and is explicitly forbidden to do so by the OAuth specification.  Therefore, requests to <code class="docutils literal"><span class="pre">/oauth/token</span></code> must be over an HTTPS connection, otherwise the request is rejected.</p>
<p>A convenience allowance for localhost development is enabled however: the HTTPS requirement assertion does not apply if the client and server are both on localhost to allow for convenience while developing and testing.</p>
<p>This is enabled via the following configuration property:</p>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">stormpath.web.oauth2.authorizer.secure.resolver</span> <span class="o">=</span> <span class="s">com.stormpath.sdk.servlet.config.SecureResolverFactory</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">com.stormpath.sdk.servlet.config.SecureResolverFactory</span></code> returns a <code class="docutils literal"><span class="pre">Resolver&lt;Boolean&gt;</span></code> instance that will return true or false based on the inbound request.</p>
<p>The default implementation returns a <code class="docutils literal"><span class="pre">com.stormpath.sdk.servlet.util.SecureRequiredExceptForLocalhostResolver</span></code> instance, which, as the name implies, requires HTTPS for all requests except those that are sent from and to localhost.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">If you change this configuration value to specify your own <code class="docutils literal"><span class="pre">com.stormpath.sdk.servlet.http.Resolver&lt;Boolean&gt;</span></code> implementation, please be aware that the OAuth 2 specification <em>requires</em> HTTPS.  If your implementation returns <code class="docutils literal"><span class="pre">false</span></code> at any time when you deploy your application to production, your web application <em>will</em> be vulnerable to identity hijacking attacks.</p>
</div>
</div>
</div>
</div>
<div class="section" id="api-key-authentication">
<h2><a class="toc-backref" href="#id5">API Key Authentication</a><a class="headerlink" href="#api-key-authentication" title="Permalink to this headline">¶</a></h2>
<p>Any account that may login to your application that also has one or more API Keys may use those API Keys to authenticate requests to your web application using HTTP Basic Authentication.  For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl -u ACCOUNT_API_KEY_ID:ACCOUNT_API_KEY_SECRET http://localhost:8080/
</pre></div>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>HTTPS Required</p>
<p class="last">HTTP Basic authentication sends the <em>raw</em> credentials over the network.  Basic Authentication should only be used over HTTPS connections and never over standard HTTP.</p>
</div>
<div class="section" id="determining-api-key-authentication">
<h3><a class="toc-backref" href="#id6">Determining API Key Authentication</a><a class="headerlink" href="#determining-api-key-authentication" title="Permalink to this headline">¶</a></h3>
<p>If a request is authenticated, and you want to know if the authentication was based on an API Key, you can check a request attribute.  For example:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getRemoteUser</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//request is authenticated</span>

    <span class="n">ApiKey</span> <span class="n">apiKey</span> <span class="o">=</span> <span class="o">(</span><span class="n">ApiKey</span><span class="o">)</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">ApiKey</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">apiKey</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//request was authenticated by an API Key</span>

    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

       <span class="c1">//request was not authenticated by an API Key</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="request.html" class="btn btn-neutral float-right" title="Request Context" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="logout.html" class="btn btn-neutral" title="Logout" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Stormpath, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>